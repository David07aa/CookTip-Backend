<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ä¿¡ç™»å½•æ¥å£æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #07c160;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #07c160;
        }
        button {
            background: #07c160;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #06ad56;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .success {
            border-color: #07c160;
            background: #f0f9ff;
        }
        .error {
            border-color: #fa5151;
            background: #fff0f0;
        }
        .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        .status-ok {
            background: #07c160;
            color: white;
        }
        .status-fail {
            background: #fa5151;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¾®ä¿¡ç™»å½•æ¥å£æµ‹è¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h3>1. æµ‹è¯•åˆ†ç±»æ¥å£ï¼ˆéªŒè¯ API åŸºç¡€è¿æ¥ï¼‰</h3>
            <p>å…ˆæµ‹è¯•ä¸€ä¸ªå·²çŸ¥æ­£å¸¸çš„æ¥å£ï¼Œç¡®è®¤ Vercel æœåŠ¡æ­£å¸¸</p>
            <button onclick="testCategories()">æµ‹è¯• /api/categories</button>
            <div id="categories-result"></div>
        </div>

        <div class="test-section">
            <h3>2. æµ‹è¯•å¾®ä¿¡ç™»å½•æ¥å£ï¼ˆä¸»è¦æµ‹è¯•ï¼‰</h3>
            <p>æµ‹è¯•å¾®ä¿¡ç™»å½•æ¥å£æ˜¯å¦å¯ä»¥è®¿é—®ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿ codeï¼‰</p>
            <button onclick="testWechatLogin()">æµ‹è¯• /api/auth/wechat</button>
            <div id="wechat-result"></div>
        </div>

        <div class="test-section">
            <h3>3. æµ‹è¯•æ‰€æœ‰ API æ¥å£</h3>
            <p>éå†æµ‹è¯•æ‰€æœ‰æ¥å£çš„å¯è®¿é—®æ€§</p>
            <button onclick="testAllAPIs()">æµ‹è¯•æ‰€æœ‰æ¥å£</button>
            <div id="all-result"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://cooktip-backend.vercel.app/api';

        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
            element.textContent = message;
        }

        async function testCategories() {
            const resultId = 'categories-result';
            showResult(resultId, 'â³ æ­£åœ¨æµ‹è¯•...', true);

            try {
                const response = await fetch(`${BASE_URL}/categories`);
                const data = await response.json();
                
                const message = `âœ… çŠ¶æ€ç : ${response.status}

å“åº”æ•°æ®:
${JSON.stringify(data, null, 2)}`;
                
                showResult(resultId, message, response.ok);
            } catch (error) {
                showResult(resultId, `âŒ è¯·æ±‚å¤±è´¥:\n${error.message}`, false);
            }
        }

        async function testWechatLogin() {
            const resultId = 'wechat-result';
            showResult(resultId, 'â³ æ­£åœ¨æµ‹è¯•...', true);

            try {
                const response = await fetch(`${BASE_URL}/auth/wechat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: 'test_code_12345',
                        nickName: 'æµ‹è¯•ç”¨æˆ·',
                        avatar: 'https://example.com/avatar.jpg'
                    })
                });

                const data = await response.json();
                
                let message = `çŠ¶æ€ç : ${response.status}

å“åº”æ•°æ®:
${JSON.stringify(data, null, 2)}

`;

                if (response.status === 404) {
                    message += `\nâŒ 404 é”™è¯¯ï¼šæ¥å£æœªæ‰¾åˆ°
å¯èƒ½åŸå› ï¼š
1. Vercel CDN ç¼“å­˜æœªæ›´æ–°ï¼ˆç­‰å¾… 5-10 åˆ†é’Ÿï¼‰
2. è·¯ç”±é…ç½®é—®é¢˜
3. æ–‡ä»¶æœªæ­£ç¡®éƒ¨ç½²`;
                } else if (response.status === 401 || response.status === 400) {
                    message += `\nâœ… æ¥å£å­˜åœ¨ï¼è™½ç„¶è¿”å›é”™è¯¯ï¼ˆ${response.status}ï¼‰ï¼Œä½†è¿™æ˜¯æ­£å¸¸çš„ï¼Œ
å› ä¸ºä½¿ç”¨çš„æ˜¯æµ‹è¯• codeã€‚çœŸå®çš„ wx.login() è·å–çš„ code åº”è¯¥å¯ä»¥æˆåŠŸã€‚`;
                } else if (response.status === 200) {
                    message += `\nâœ… ç™»å½•æˆåŠŸï¼ï¼ˆä¸åº”è¯¥å‡ºç°ï¼Œé™¤éæµ‹è¯• code æ°å¥½æœ‰æ•ˆï¼‰`;
                } else if (response.status === 500) {
                    message += `\nâš ï¸ æœåŠ¡å™¨é”™è¯¯ï¼šæ¥å£å­˜åœ¨ä½†æ‰§è¡Œå¤±è´¥ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®`;
                }
                
                showResult(resultId, message, response.status !== 404);
            } catch (error) {
                showResult(resultId, `âŒ è¯·æ±‚å¤±è´¥:\n${error.message}`, false);
            }
        }

        async function testAllAPIs() {
            const resultId = 'all-result';
            showResult(resultId, 'â³ æ­£åœ¨æµ‹è¯•æ‰€æœ‰æ¥å£...', true);

            const apis = [
                { method: 'GET', path: '/categories', name: 'åˆ†ç±»åˆ—è¡¨' },
                { method: 'GET', path: '/recipes?page=1&limit=1', name: 'é£Ÿè°±åˆ—è¡¨' },
                { method: 'GET', path: '/search?keyword=é¸¡&page=1&pageSize=1', name: 'æœç´¢æ¥å£' },
                { method: 'POST', path: '/auth/wechat', name: 'å¾®ä¿¡ç™»å½•', body: { code: 'test' } },
                { method: 'GET', path: '/user/info', name: 'ç”¨æˆ·ä¿¡æ¯' },
                { method: 'GET', path: '/favorites', name: 'æ”¶è—åˆ—è¡¨' },
                { method: 'GET', path: '/likes', name: 'ç‚¹èµåˆ—è¡¨' }
            ];

            let results = 'æµ‹è¯•ç»“æœ:\n\n';

            for (const api of apis) {
                try {
                    const options = {
                        method: api.method,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    };

                    if (api.body) {
                        options.body = JSON.stringify(api.body);
                    }

                    const response = await fetch(`${BASE_URL}${api.path}`, options);
                    const statusClass = response.status === 404 ? 'âŒ' : 'âœ…';
                    results += `${statusClass} ${api.name} (${api.method} ${api.path}): ${response.status}\n`;
                } catch (error) {
                    results += `âŒ ${api.name}: è¯·æ±‚å¤±è´¥ - ${error.message}\n`;
                }
            }

            showResult(resultId, results, true);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
        };
    </script>
</body>
</html>

