# 🔍 检查云托管后端日志

## 步骤1：查看云托管日志

1. 登录腾讯云控制台
2. 进入 **云托管** → **服务列表** → **CookTip-Backend**
3. 点击 **日志** 标签
4. 查看最近1分钟的日志（过滤时间：2025-10-16 14:17:00 附近）

---

## 步骤2：查找关键日志

在日志中搜索以下关键字：

### ✅ 成功接收请求的日志
```
POST /api/v1/auth/wx-login
```

### 🔍 请求体日志
```
wechatLoginDto
code
```

### ❌ 错误日志
```
401
Unauthorized
微信登录失败
```

---

## 步骤3：查看具体参数

请找到类似以下的日志：

```
[Nest] INFO [AuthService] 微信登录请求:
{
  code: "0e36ay1w3awQP53uT22w3JPvq716ay1M",  ← 检查这个
  nickname: "微信用户",
  avatar: "https://..."
}
```

或者错误日志：

```
[Nest] ERROR [AuthService] 微信code2session失败:
{
  errcode: 40013,
  errmsg: "invalid appid"
}
```

---

## 步骤4：截图并发送

请截图以下内容发给我：

1. ✅ **完整的请求日志**（包含请求体）
2. ❌ **错误日志**（包含错误详情）
3. 🔧 **环境变量日志**（如果有的话）

---

## 可能的问题和解决方案

### 问题1：后端收到空的code
**日志**：`code: undefined` 或 `code must be a string`

**解决**：
- 云函数未正确转发参数
- 需要检查云函数日志

### 问题2：微信AppID/Secret错误
**日志**：`errcode: 40013, errmsg: "invalid appid"`

**解决**：
1. 打开腾讯云控制台
2. 云托管 → 环境变量
3. 确认 `WX_APPID` 和 `WX_SECRET` 正确
4. 重启服务

### 问题3：微信code已使用
**日志**：`errcode: 40029, errmsg: "code been used"`

**解决**：
- 微信code只能使用一次
- 重新点击登录按钮

### 问题4：环境变量未生效
**日志**：`WX_APPID: undefined`

**解决**：
1. 配置环境变量后需要重启服务
2. 云托管 → 服务详情 → 重启

---

## 快速测试

在云托管后端日志中，应该能看到：

```
✅ 收到微信登录请求
📦 请求体: { code: "0e36ay1...", nickname: "微信用户", ... }
🔑 调用微信code2session接口
✅ 微信认证成功: { openid: "...", session_key: "..." }
✅ 用户登录/注册成功
🎫 生成JWT token
```

如果在某一步失败，请把具体的错误日志发给我！

