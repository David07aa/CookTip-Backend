# 🚨 立即查看云托管后端日志

## 问题现状

✅ **后端健康**: 服务正常运行  
❌ **微信登录**: 返回401错误 - "微信登录失败，请重试"

这是一个**通用错误消息**，具体原因需要查看后端日志！

---

## 📋 立即操作步骤

### 步骤1：登录腾讯云控制台

1. 打开：https://console.cloud.tencent.com/
2. 进入：**云托管** → **服务列表**
3. 找到：**CookTip-Backend** 服务

### 步骤2：查看日志

1. 点击服务名称进入详情页
2. 点击上方的 **"日志"** 标签
3. **时间范围**：选择最近 **5分钟**
4. **日志级别**：选择 **"全部"**

### 步骤3：查找关键日志

在日志搜索框中，按顺序搜索以下关键字：

#### 🔍 搜索1: "code2Session"
```
🔐 微信登录 - code2Session 开始
```

应该能看到：
```
🔐 微信登录 - code2Session 开始
  - Code 长度: 23
  - AppID 存在: true (wx1234...)  ← 检查这里！
  - Secret 存在: true (已配置)    ← 检查这里！
```

#### 🔍 搜索2: "微信"
查看是否有以下日志：

**✅ 成功日志**：
```
📡 调用微信 API: https://api.weixin.qq.com/sns/jscode2session
📥 微信 API 响应: {"openid":"...", "session_key":"..."}
✅ 获取 openid 成功
```

**❌ 错误日志**：
```
❌ 微信配置缺失: AppID 或 Secret 未配置
```
或
```
❌ 微信返回错误码: 40013 invalid appid
```
或
```
❌ 微信登录异常: Network Error
```

---

## 🎯 根据日志判断问题

### 情况1：AppID 存在: false 或 Secret 存在: false

**原因**：环境变量未配置或未生效

**解决**：
1. 云托管 → **环境变量** 标签
2. 添加/修改：
   ```
   WX_APPID = wx...（你的小程序AppID）
   WX_SECRET = ...（你的小程序Secret）
   ```
3. **重启服务**（非常重要！）
4. 等待1-2分钟后重新测试

### 情况2：微信返回错误码 40013 (invalid appid)

**原因**：AppID 填写错误

**解决**：
1. 打开微信公众平台：https://mp.weixin.qq.com/
2. 登录你的小程序
3. 开发管理 → 开发设置 → 开发者ID
4. 复制正确的 **AppID** 和 **AppSecret**
5. 更新云托管环境变量
6. 重启服务

### 情况3：微信返回错误码 40029 (code been used)

**原因**：**环境变量配置正确**，只是测试code无效

**解决**：
- ✅ **后端配置正确！**
- ✅ **前端使用真实微信code即可成功登录！**

### 情况4：微信登录异常: Network Error

**原因**：云托管无法访问微信API

**解决**：
1. 检查云托管网络配置
2. 等待几分钟后重试
3. 联系腾讯云技术支持

---

## 📸 请截图发给我

请截图以下内容：

1. **日志搜索 "code2Session" 的结果**
   - 特别关注：AppID 存在、Secret 存在
2. **完整的错误日志**
   - 包含 ❌ 符号的日志行
3. **环境变量配置截图**
   - 云托管 → 环境变量标签

---

## ⚡ 快速自助检查清单

在查看日志之前，先快速检查：

- [ ] 云托管环境变量中是否有 `WX_APPID`？
- [ ] 云托管环境变量中是否有 `WX_SECRET`？
- [ ] 配置环境变量后是否**重启了服务**？
- [ ] AppID 和 Secret 是否从**小程序后台**正确复制？
- [ ] AppID 是否以 `wx` 开头？

---

## 🔄 如果看不到日志

如果云托管日志为空或看不到相关日志：

1. **重新触发登录**：
   - 在小程序中点击登录按钮
   - 立即刷新云托管日志页面

2. **调整日志级别**：
   - 确保选择了 "全部" 级别
   - 扩大时间范围到 "最近1小时"

3. **检查服务状态**：
   - 云托管 → 服务详情
   - 确认服务状态为 "运行中"

---

**现在请立即查看云托管后端日志，并告诉我看到了什么！** 🚀

