# å›¾ç‰‡åŠ è½½é—®é¢˜å¿«é€Ÿä¿®å¤æŒ‡å— âš¡

## ğŸ¯ é—®é¢˜æ¦‚è¿°

**å½“å‰é”™è¯¯**ï¼š
```
no such file or directory: E:\å‰ç«¯é¡¹ç›®æ–‡æ¡£\é¡¹ç›®æ–‡ä»¶å¤¹\CookTip\images\empty\no-search.png
```

**é—®é¢˜åŸå› **ï¼šå‰ç«¯ä»£ç ä½¿ç”¨äº†**æœ¬åœ°ç»å¯¹è·¯å¾„**ï¼Œå°ç¨‹åºæ— æ³•è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚

**å·²ç¡®è®¤ä¿¡æ¯**ï¼š
- âœ… å›¾ç‰‡å­˜å‚¨ä½ç½®ï¼šè…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ï¼ˆå—äº¬ï¼‰
- âœ… COSåŸŸåï¼š`https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com`
- âœ… downloadFileåŸŸåå·²é…ç½®

---

## âš¡ ç«‹å³ä¿®å¤ï¼ˆ3æ­¥å®Œæˆï¼‰

### æ­¥éª¤1ï¼šé…ç½®å°ç¨‹åºåˆæ³•åŸŸåï¼ˆ2åˆ†é’Ÿï¼‰

1. ç™»å½• [å¾®ä¿¡å°ç¨‹åºåå°](https://mp.weixin.qq.com)
2. è¿›å…¥ï¼š**å¼€å‘ç®¡ç†** â†’ **å¼€å‘è®¾ç½®** â†’ **æœåŠ¡å™¨åŸŸå**
3. åœ¨ **downloadFileåˆæ³•åŸŸå** ä¸­æ·»åŠ ï¼š
   ```
   https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com
   ```
4. ç‚¹å‡»ä¿å­˜ï¼Œç­‰å¾…3-5åˆ†é’Ÿç”Ÿæ•ˆ

---

### æ­¥éª¤2ï¼šå¤åˆ¶CDNé…ç½®æ–‡ä»¶åˆ°å‰ç«¯é¡¹ç›®ï¼ˆ1åˆ†é’Ÿï¼‰

#### 2.1 å¤åˆ¶æ–‡ä»¶
å°† `miniprogram-utils/cdn.js` å¤åˆ¶åˆ°å‰ç«¯é¡¹ç›®çš„ä»¥ä¸‹ä½ç½®ä¹‹ä¸€ï¼š
- `utils/cdn.js` ï¼ˆæ¨èï¼‰
- `config/cdn.js`
- `common/cdn.js`

#### 2.2 éªŒè¯æ–‡ä»¶å†…å®¹
æ‰“å¼€å¤åˆ¶çš„æ–‡ä»¶ï¼Œç¡®è®¤ `COS_BASE_URL` é…ç½®æ­£ç¡®ï¼š
```javascript
const COS_BASE_URL = 'https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com';
```

---

### æ­¥éª¤3ï¼šä¿®å¤å‰ç«¯ä»£ç ï¼ˆ5åˆ†é’Ÿï¼‰

#### 3.1 æ‰¾åˆ°æŠ¥é”™çš„ä»£ç ä½ç½®

æœç´¢å‰ç«¯é¡¹ç›®ä¸­çš„å…³é”®è¯ï¼š
```
E:\å‰ç«¯é¡¹ç›®æ–‡æ¡£\é¡¹ç›®æ–‡ä»¶å¤¹\CookTip\images\empty\no-search.png
```

æˆ–æœç´¢ï¼š
```javascript
no-search.png
```

#### 3.2 ä¿®æ”¹ä»£ç 

**âŒ åŸå§‹ä»£ç ï¼ˆé”™è¯¯ï¼‰**ï¼š
```javascript
const placeholderImage = 'E:\\å‰ç«¯é¡¹ç›®æ–‡æ¡£\\é¡¹ç›®æ–‡ä»¶å¤¹\\CookTip\\images\\empty\\no-search.png';
```

**âœ… ä¿®å¤åä»£ç **ï¼š
```javascript
import { getPlaceholder } from '@/utils/cdn';  // æˆ– '@/config/cdn'

const placeholderImage = getPlaceholder('noSearch');
```

#### 3.3 ä¿®å¤è§†é¢‘å°é¢åŠ è½½

æ‰¾åˆ°åŠ è½½é£Ÿè°±æ•°æ®çš„ä»£ç ï¼Œæ·»åŠ å›¾ç‰‡URLå¤„ç†ï¼š

**âŒ ä¿®æ”¹å‰**ï¼š
```javascript
api.getRecipeList({ page: 1, limit: 10 }).then(res => {
  this.setData({ recipes: res.data });
});
```

**âœ… ä¿®æ”¹å**ï¼š
```javascript
import { processRecipeList } from '@/utils/cdn';

api.getRecipeList({ page: 1, limit: 10 }).then(res => {
  // å¤„ç†å›¾ç‰‡URL
  const recipes = processRecipeList(res.data);
  this.setData({ recipes });
});
```

---

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹ä»£ç 

### ç¤ºä¾‹1ï¼šæœç´¢é¡µé¢ä¿®å¤

**pages/search/search.js**ï¼š
```javascript
import { getPlaceholder } from '@/utils/cdn';
import { processRecipeList } from '@/utils/cdn';
import api from '@/utils/api';

Page({
  data: {
    keyword: '',
    searchResults: [],
    loading: false,
    // âœ… ä½¿ç”¨CDNé…ç½®çš„å ä½å›¾
    placeholderImage: getPlaceholder('noSearch')
  },
  
  /**
   * æœç´¢é£Ÿè°±
   */
  async searchRecipes(keyword) {
    try {
      this.setData({ loading: true });
      
      const response = await api.searchRecipes({ 
        keyword,
        page: 1,
        limit: 20 
      });
      
      // âœ… å¤„ç†è¿”å›æ•°æ®ä¸­çš„å›¾ç‰‡URL
      const searchResults = processRecipeList(response.data);
      
      this.setData({ 
        searchResults,
        loading: false 
      });
      
    } catch (error) {
      console.error('æœç´¢å¤±è´¥:', error);
      this.setData({ loading: false });
      wx.showToast({ title: 'æœç´¢å¤±è´¥', icon: 'none' });
    }
  }
});
```

**pages/search/search.wxml**ï¼š
```xml
<view class="search-page">
  <!-- æœç´¢æ¡† -->
  <input 
    class="search-input" 
    value="{{keyword}}" 
    placeholder="æœç´¢é£Ÿè°±"
    bindinput="onInput"
  />
  
  <!-- æœç´¢ç»“æœ -->
  <view class="results" wx:if="{{searchResults.length > 0}}">
    <view class="recipe-item" wx:for="{{searchResults}}" wx:key="id">
      <image 
        class="cover" 
        src="{{item.cover}}" 
        mode="aspectFill"
        binderror="onImageError"
        data-index="{{index}}"
      />
      <text class="title">{{item.title}}</text>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ - ä½¿ç”¨å ä½å›¾ -->
  <view class="empty" wx:if="{{!loading && searchResults.length === 0 && keyword}}">
    <image class="placeholder" src="{{placeholderImage}}" mode="aspectFit" />
    <text class="tip">æœªæ‰¾åˆ°ç›¸å…³é£Ÿè°±</text>
  </view>
</view>
```

---

### ç¤ºä¾‹2ï¼šé£Ÿè°±åˆ—è¡¨ä¿®å¤

**pages/index/index.js**ï¼š
```javascript
import { processRecipeList, getDefaultImage } from '@/utils/cdn';
import api from '@/utils/api';

Page({
  data: {
    recipes: [],
    loading: false
  },
  
  onLoad() {
    this.loadRecipes();
  },
  
  /**
   * åŠ è½½é£Ÿè°±åˆ—è¡¨
   */
  async loadRecipes() {
    try {
      this.setData({ loading: true });
      
      const response = await api.getRecipeList({
        page: 1,
        limit: 10,
        sort: 'recommended'
      });
      
      // âœ… å¤„ç†è¿”å›æ•°æ®ä¸­çš„å›¾ç‰‡URL
      const recipes = processRecipeList(response.data);
      
      this.setData({ 
        recipes,
        loading: false 
      });
      
    } catch (error) {
      console.error('åŠ è½½é£Ÿè°±å¤±è´¥:', error);
      this.setData({ loading: false });
      wx.showToast({ title: 'åŠ è½½å¤±è´¥', icon: 'none' });
    }
  },
  
  /**
   * å›¾ç‰‡åŠ è½½å¤±è´¥å¤„ç†
   */
  onImageError(e) {
    const { index, type } = e.currentTarget.dataset;
    const imageType = type || 'cover';
    const defaultImage = getDefaultImage(
      imageType === 'videoCover' ? 'videoCover' : 'recipeCover'
    );
    
    console.warn(`å›¾ç‰‡åŠ è½½å¤±è´¥ [ç´¢å¼•:${index}]:`, e.detail);
    
    // æ›¿æ¢ä¸ºé»˜è®¤å›¾ç‰‡
    const key = `recipes[${index}].${imageType}`;
    this.setData({
      [key]: defaultImage
    });
  }
});
```

**pages/index/index.wxml**ï¼š
```xml
<view class="recipe-list">
  <view class="recipe-card" wx:for="{{recipes}}" wx:key="id">
    <!-- å°é¢å›¾ -->
    <image 
      class="cover"
      src="{{item.cover}}" 
      mode="aspectFill"
      binderror="onImageError"
      data-index="{{index}}"
      data-type="cover"
    />
    
    <!-- è§†é¢‘å°é¢ï¼ˆå¦‚æœæœ‰è§†é¢‘ï¼‰ -->
    <image 
      wx:if="{{item.videoCover}}"
      class="video-cover"
      src="{{item.videoCover}}" 
      mode="aspectFill"
      binderror="onImageError"
      data-index="{{index}}"
      data-type="videoCover"
    />
    
    <view class="info">
      <text class="title">{{item.title}}</text>
      <text class="desc">{{item.description}}</text>
    </view>
  </view>
</view>
```

---

### ç¤ºä¾‹3ï¼šç”¨æˆ·å¤´åƒä¿®å¤

**pages/profile/profile.js**ï¼š
```javascript
import { processUserImages } from '@/utils/cdn';
import api from '@/utils/api';

Page({
  data: {
    userInfo: {}
  },
  
  onLoad() {
    this.loadUserInfo();
  },
  
  async loadUserInfo() {
    try {
      const response = await api.getUserInfo();
      
      // âœ… å¤„ç†ç”¨æˆ·å¤´åƒURL
      const userInfo = processUserImages(response.data);
      
      this.setData({ userInfo });
      
    } catch (error) {
      console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
    }
  }
});
```

---

## ğŸ”§ ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœCOSä¸­æ²¡æœ‰å ä½å›¾ï¼‰

å¦‚æœæ‚¨çš„COSå¯¹è±¡å­˜å‚¨ä¸­è¿˜æ²¡æœ‰ä¸Šä¼ å ä½å›¾å’Œé»˜è®¤å›¾ï¼Œå¯ä»¥å…ˆä½¿ç”¨åœ¨çº¿å ä½å›¾æœåŠ¡ï¼š

### ä¿®æ”¹ `utils/cdn.js`ï¼š

```javascript
// ä¸´æ—¶ä½¿ç”¨åœ¨çº¿å ä½å›¾æœåŠ¡
const CDN_CONFIG = {
  baseUrl: COS_BASE_URL,
  
  // âœ… ä½¿ç”¨åœ¨çº¿å ä½å›¾ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
  placeholders: {
    noSearch: 'https://via.placeholder.com/400x300/f5f5f5/999999?text=æš‚æ— æœç´¢ç»“æœ',
    noData: 'https://via.placeholder.com/400x300/f5f5f5/999999?text=æš‚æ— æ•°æ®',
    noRecipe: 'https://via.placeholder.com/400x300/f5f5f5/999999?text=æš‚æ— é£Ÿè°±',
    noComment: 'https://via.placeholder.com/400x300/f5f5f5/999999?text=æš‚æ— è¯„è®º',
  },
  
  defaults: {
    avatar: 'https://via.placeholder.com/100x100/4CAF50/ffffff?text=ç”¨æˆ·',
    recipeCover: 'https://via.placeholder.com/600x400/FF9800/ffffff?text=é£Ÿè°±å°é¢',
    videoCover: 'https://via.placeholder.com/600x400/2196F3/ffffff?text=è§†é¢‘å°é¢',
    categoryIcon: 'https://via.placeholder.com/80x80/9C27B0/ffffff?text=åˆ†ç±»',
  },
  
  // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜
};
```

### âš ï¸ æ³¨æ„ï¼š
ä½¿ç”¨åœ¨çº¿å ä½å›¾æœåŠ¡æ—¶ï¼Œéœ€è¦åœ¨å°ç¨‹åºåå°çš„ **downloadFileåˆæ³•åŸŸå** ä¸­æ·»åŠ ï¼š
```
https://via.placeholder.com
```

---

## âœ… éªŒè¯ä¿®å¤

### 1. é‡å¯å°ç¨‹åºå¼€å‘è€…å·¥å…·
- å®Œå…¨å…³é—­å¼€å‘è€…å·¥å…·
- é‡æ–°æ‰“å¼€é¡¹ç›®
- ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®

### 2. æµ‹è¯•å›¾ç‰‡åŠ è½½
æ‰“å¼€å°ç¨‹åºæ§åˆ¶å°ï¼Œè¿è¡Œä»¥ä¸‹ä»£ç éªŒè¯ï¼š

```javascript
const { getCdnUrl, getPlaceholder } = require('@/utils/cdn');

console.log('=== CDNé…ç½®æµ‹è¯• ===');
console.log('COSåŸºç¡€URL:', getCdnUrl('/'));
console.log('æ— æœç´¢å ä½å›¾:', getPlaceholder('noSearch'));
console.log('é»˜è®¤é£Ÿè°±å°é¢:', getDefaultImage('recipeCover'));
```

**é¢„æœŸè¾“å‡º**ï¼š
```
=== CDNé…ç½®æµ‹è¯• ===
COSåŸºç¡€URL: https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/
æ— æœç´¢å ä½å›¾: https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/images/empty/no-search.png
é»˜è®¤é£Ÿè°±å°é¢: https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/images/default/recipe-cover.png
```

### 3. æ£€æŸ¥ç½‘ç»œè¯·æ±‚
åœ¨å¼€å‘è€…å·¥å…·çš„ **Network** é¢æ¿ä¸­ï¼ŒæŸ¥çœ‹å›¾ç‰‡è¯·æ±‚æ˜¯å¦æˆåŠŸï¼š
- âœ… çŠ¶æ€ç  200ï¼šå›¾ç‰‡åŠ è½½æˆåŠŸ
- âŒ çŠ¶æ€ç  404ï¼šå›¾ç‰‡ä¸å­˜åœ¨ï¼ˆéœ€è¦ä¸Šä¼ åˆ°COSï¼‰
- âŒ çŠ¶æ€ç  403ï¼šCOSæƒé™é…ç½®é—®é¢˜

---

## ğŸ¯ æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ­¥éª¤åï¼Œé—®é¢˜åº”è¯¥è§£å†³ï¼š

- [ ] å·²åœ¨å°ç¨‹åºåå°é…ç½® downloadFile åˆæ³•åŸŸå
- [ ] å·²å¤åˆ¶ `cdn.js` åˆ°å‰ç«¯é¡¹ç›®
- [ ] å·²ä¿®æ”¹æ‰€æœ‰ä½¿ç”¨æœ¬åœ°è·¯å¾„çš„ä»£ç 
- [ ] å·²åœ¨å›¾ç‰‡ç»„ä»¶ä¸Šæ·»åŠ  `binderror` é”™è¯¯å¤„ç†
- [ ] å·²ä½¿ç”¨ `processRecipeList` å¤„ç†é£Ÿè°±æ•°æ®
- [ ] å·²é‡å¯å¼€å‘è€…å·¥å…·å¹¶æµ‹è¯•
- [ ] å›¾ç‰‡å’Œè§†é¢‘å°é¢æ­£å¸¸æ˜¾ç¤º

---

## ğŸ“ ä»ç„¶æœ‰é—®é¢˜ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œåä»ç„¶æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. **é”™è¯¯ä¿¡æ¯**ï¼šå®Œæ•´çš„æ§åˆ¶å°é”™è¯¯æ—¥å¿—
2. **ç½‘ç»œè¯·æ±‚**ï¼šå¼€å‘è€…å·¥å…· Network é¢æ¿çš„æˆªå›¾
3. **å›¾ç‰‡URLç¤ºä¾‹**ï¼šåç«¯APIè¿”å›çš„å®é™…å›¾ç‰‡URL
4. **é…ç½®æˆªå›¾**ï¼šå°ç¨‹åºåå°çš„æœåŠ¡å™¨åŸŸåé…ç½®

æˆ‘ä¼šç»§ç»­ååŠ©æ‚¨æ’æŸ¥ï¼

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†ä¿®å¤æ–¹æ¡ˆï¼š`å¯¹è±¡å­˜å‚¨å›¾ç‰‡ä¿®å¤å®Œæ•´æ–¹æ¡ˆ.md`
- CDNé…ç½®æ–‡ä»¶ï¼š`miniprogram-utils/cdn.js`
- äº‘å‡½æ•°éƒ¨ç½²ï¼š`äº‘å‡½æ•°éƒ¨ç½²å®Œæ•´æŒ‡å—.md`

