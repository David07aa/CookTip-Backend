# CookTip å‰ç«¯å¯¹æ¥å®Œæ•´æ–‡æ¡£

**ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-17  
**é€‚ç”¨å¹³å°**: å¾®ä¿¡å°ç¨‹åº  
**åç«¯ç‰ˆæœ¬**: NestJS v10.x

---

## ğŸ“‹ ç›®å½•

- [1. å¿«é€Ÿå¼€å§‹](#1-å¿«é€Ÿå¼€å§‹)
- [2. ç™»å½•æ–¹å¼æ¦‚è§ˆ](#2-ç™»å½•æ–¹å¼æ¦‚è§ˆ)
- [3. UIè®¾è®¡å»ºè®®](#3-uiè®¾è®¡å»ºè®®)
- [4. APIæ¥å£è¯¦è§£](#4-apiæ¥å£è¯¦è§£)
- [5. å®Œæ•´ä»£ç ç¤ºä¾‹](#5-å®Œæ•´ä»£ç ç¤ºä¾‹)
- [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
- [7. å¸¸è§é—®é¢˜](#7-å¸¸è§é—®é¢˜)

---

## 1. å¿«é€Ÿå¼€å§‹

### 1.1 ç¯å¢ƒé…ç½®

```json
// miniprogram/app.json
{
  "cloud": true,
  "plugins": {},
  "sitemapLocation": "sitemap.json"
}
```

### 1.2 API åŸºç¡€ä¿¡æ¯

```javascript
// config.js
export const API_CONFIG = {
  baseURL: 'https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1',
  timeout: 10000,
  cloudFunction: 'api-proxy' // äº‘å‡½æ•°åç§°
};

export const CDN_BASE = 'https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com';
```

**é‡è¦è¯´æ˜**ï¼š
- ğŸ”” **é€šè¿‡äº‘å‡½æ•°è°ƒç”¨æ—¶ï¼Œè·¯å¾„ä¸éœ€è¦åŠ  `/api/v1` å‰ç¼€**ï¼Œäº‘å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ 
- ğŸ”” **ç›´æ¥HTTPè°ƒç”¨æ—¶ï¼Œéœ€è¦å®Œæ•´è·¯å¾„**ï¼ˆåŒ…å« `/api/v1`ï¼‰
- ä¾‹å¦‚ï¼š
  - âœ… äº‘å‡½æ•°è°ƒç”¨ï¼š`path: '/auth/login'` 
  - âœ… HTTPè°ƒç”¨ï¼š`https://xxx.com/api/v1/auth/login`

---

## 2. ç™»å½•æ–¹å¼æ¦‚è§ˆ

### 2.1 æ”¯æŒçš„ç™»å½•æ–¹å¼

| ç™»å½•æ–¹å¼ | æ¥å£ | æ˜¯å¦éœ€è¦å¯†ç  | é€‚ç”¨åœºæ™¯ | ä¼˜å…ˆçº§ |
|---------|------|------------|---------|--------|
| **å¾®ä¿¡ä¸€é”®ç™»å½•** | `/auth/wechat-login` | âŒ | é¦–æ¬¡ä½¿ç”¨ï¼Œå¿«é€Ÿæ³¨å†Œ | â­â­â­â­â­ |
| **ç”¨æˆ·åå¯†ç ** | `/auth/login` | âœ… | å·²æ³¨å†Œç”¨æˆ· | â­â­â­â­ |
| **é‚®ç®±å¯†ç ** | `/auth/login` | âœ… | å·²ç»‘å®šé‚®ç®±ç”¨æˆ· | â­â­â­ |
| **æ‰‹æœºå·å¯†ç ** | `/auth/login` | âœ… | å·²ç»‘å®šæ‰‹æœºç”¨æˆ· | â­â­â­ |

### 2.2 ç™»å½•æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç”¨æˆ·æ‰“å¼€å°ç¨‹åº                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ æ˜¯å¦æœ‰Token? â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚      â”‚
    å¦   â”‚      â”‚   æ˜¯
         â”‚      â””â”€â”€â”€â”€â”€â”€â†’ ç›´æ¥è¿›å…¥é¦–é¡µ
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç™»å½•é¡µé¢ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚        â”‚        â”‚
    â†“         â†“        â†“        â†“
å¾®ä¿¡ç™»å½•  ç”¨æˆ·å   é‚®ç®±    æ‰‹æœºå·
(æ¨è)    å¯†ç     å¯†ç      å¯†ç 
```

---

## 3. UIè®¾è®¡å»ºè®®

### 3.1 ç™»å½•é¡µé¢è®¾è®¡ï¼ˆå¤šTabï¼‰

#### æ–¹æ¡ˆä¸€ï¼šTabåˆ‡æ¢å¼ï¼ˆæ¨èï¼‰â­â­â­â­â­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CookTip ç¾é£Ÿèœè°±            â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚å¾®ä¿¡ç™»å½•â”‚  â”‚è´¦å·ç™»å½•â”‚  â”‚æ³¨å†Œè´¦å·â”‚  â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”â”â”â”â”·â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚                     â”‚        â”‚
â”‚    â”‚      [å¾®ä¿¡å›¾æ ‡]      â”‚        â”‚
â”‚    â”‚                     â”‚        â”‚
â”‚    â”‚   å¾®ä¿¡ä¸€é”®ç™»å½•æ³¨å†Œ    â”‚        â”‚
â”‚    â”‚                     â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚    å®‰å…¨ä¾¿æ·ï¼Œæ— éœ€è®°å¿†å¯†ç             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è´¦å·ç™»å½•Tab

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CookTip ç¾é£Ÿèœè°±            â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚å¾®ä¿¡ç™»å½•â”‚  â”‚è´¦å·ç™»å½•â”‚  â”‚æ³¨å†Œè´¦å·â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”·â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                     â”‚
â”‚  è´¦å·ï¼šâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚       â”‚ ç”¨æˆ·å/é‚®ç®±/æ‰‹æœºå·    â”‚    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚  å¯†ç ï¼šâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚       â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢            â”‚    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚  [ ] è®°ä½æˆ‘        å¿˜è®°å¯†ç ï¼Ÿ      â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚      ç™» å½•          â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚         è¿˜æ²¡æœ‰è´¦å·ï¼Ÿå»æ³¨å†Œ           â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ³¨å†Œè´¦å·Tab

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CookTip ç¾é£Ÿèœè°±            â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚å¾®ä¿¡ç™»å½•â”‚  â”‚è´¦å·ç™»å½•â”‚  â”‚æ³¨å†Œè´¦å·â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”·â”â”â”â” â”‚
â”‚                                     â”‚
â”‚  ç”¨æˆ·åï¼šâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚         â”‚ 3-50ä¸ªå­—ç¬¦          â”‚  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  å¯†ç ï¼š  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚         â”‚ è‡³å°‘6ä½ï¼Œå«å¤§å°å†™æ•°å­— â”‚  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  é‚®ç®±ï¼š  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  (å¯é€‰) â”‚ example@email.com   â”‚  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  æ‰‹æœºå·ï¼šâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  (å¯é€‰) â”‚ 13800138000         â”‚  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚      æ³¨ å†Œ          â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚        å·²æœ‰è´¦å·ï¼Ÿå»ç™»å½•             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä¸ªäººä¸­å¿ƒ - è´¦å·ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  è´¦å·ä¸å®‰å…¨                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ç™»å½•æ–¹å¼                            â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ ç”¨æˆ·å                      â”‚ â”‚
â”‚  â”‚    johndoe                    â”‚ â”‚
â”‚  â”‚                      ä¸»è´¦å· âœ“ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“§ é‚®ç®±                        â”‚ â”‚
â”‚  â”‚    john@example.com           â”‚ â”‚
â”‚  â”‚                      å·²éªŒè¯ âœ“ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“± æ‰‹æœºå·                      â”‚ â”‚
â”‚  â”‚    138****8000                â”‚ â”‚
â”‚  â”‚                      å¾…éªŒè¯ âš  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”‘ ä¿®æ”¹å¯†ç               â†’   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â• ç»‘å®šæ–°è´¦å·            â†’   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ç»‘å®šè´¦å·å¼¹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç»‘å®šæ–°è´¦å·                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  é€‰æ‹©ç±»å‹ï¼š                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”           â”‚
â”‚  â”‚é‚®ç®± â”‚  â”‚æ‰‹æœº â”‚  â”‚ç”¨æˆ·åâ”‚           â”‚
â”‚  â””â”€â”¬â”€â”€â”˜  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜           â”‚
â”‚ â”â”â”â”·â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                     â”‚
â”‚  é‚®ç®±åœ°å€ï¼šâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚           â”‚ è¾“å…¥é‚®ç®±åœ°å€         â”‚ â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  éªŒè¯ç ï¼š  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚           â”‚ 6ä½éªŒè¯ç  â”‚ [è·å–éªŒè¯ç ]â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚ å–æ¶ˆ â”‚        â”‚ ç»‘å®š â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 é¢œè‰²å’Œå›¾æ ‡å»ºè®®

```css
/* ä¸»é¢˜è‰² */
--primary-color: #FF6B35;      /* ä¸»è‰²è°ƒï¼ˆæ©™çº¢è‰²ï¼‰*/
--success-color: #07C160;      /* æˆåŠŸï¼ˆç»¿è‰²ï¼‰*/
--warning-color: #FF976A;      /* è­¦å‘Šï¼ˆæµ…æ©™è‰²ï¼‰*/
--danger-color: #FA5151;       /* å±é™©ï¼ˆçº¢è‰²ï¼‰*/
--text-primary: #333333;       /* ä¸»æ–‡æœ¬ */
--text-secondary: #999999;     /* æ¬¡è¦æ–‡æœ¬ */
--border-color: #EEEEEE;       /* è¾¹æ¡†é¢œè‰² */
--bg-color: #F7F8FA;           /* èƒŒæ™¯é¢œè‰² */

/* ç™»å½•æŒ‰é’®æ ·å¼ */
.btn-wechat {
  background: linear-gradient(135deg, #07C160 0%, #06AE56 100%);
  color: white;
}

.btn-account {
  background: linear-gradient(135deg, #FF6B35 0%, #FF5722 100%);
  color: white;
}

.btn-register {
  background: linear-gradient(135deg, #576574 0%, #3D4752 100%);
  color: white;
}
```

### 3.5 é¡µé¢è·¯ç”±è®¾è®¡

```javascript
// pages ç›®å½•ç»“æ„
pages/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ login/            // ç™»å½•é¡µï¼ˆåŒ…å«3ä¸ªTabï¼‰
â”‚   â”‚   â”œâ”€â”€ index.wxml
â”‚   â”‚   â”œâ”€â”€ index.wxss
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ register/         // æ³¨å†Œé¡µï¼ˆå¦‚æœéœ€è¦ç‹¬ç«‹é¡µé¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ index.wxml
â”‚   â”‚   â”œâ”€â”€ index.wxss
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ bind-account/     // ç»‘å®šè´¦å·é¡µ
â”‚       â”œâ”€â”€ index.wxml
â”‚       â”œâ”€â”€ index.wxss
â”‚       â””â”€â”€ index.js
â”œâ”€â”€ account/
â”‚   â”œâ”€â”€ security/         // è´¦å·å®‰å…¨
â”‚   â”‚   â”œâ”€â”€ index.wxml
â”‚   â”‚   â”œâ”€â”€ index.wxss
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ credentials/      // å‡­è¯ç®¡ç†
â”‚       â”œâ”€â”€ index.wxml
â”‚       â”œâ”€â”€ index.wxss
â”‚       â””â”€â”€ index.js
â””â”€â”€ profile/              // ä¸ªäººä¸­å¿ƒ
    â”œâ”€â”€ index.wxml
    â”œâ”€â”€ index.wxss
    â””â”€â”€ index.js
```

---

## 4. APIæ¥å£è¯¦è§£

### 4.1 å¾®ä¿¡ä¸€é”®ç™»å½•

#### æ¥å£ä¿¡æ¯
```
POST /auth/wechat-login
æ— éœ€ Token
```

#### å‰ç«¯å®ç°
```javascript
// pages/auth/login/index.js
async wechatLogin() {
  try {
    wx.showLoading({ title: 'ç™»å½•ä¸­...' });
    
    // 1. è·å–å¾®ä¿¡ code
    const { code } = await wx.login();
    
    // 2. è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    const userInfo = await this.getUserProfile();
    
    // 3. è°ƒç”¨åç«¯æ¥å£
    const result = await wx.cloud.callFunction({
      name: 'api-proxy',
      data: {
        method: 'POST',
        path: '/auth/wechat-login',
        body: {
          code: code,
          nickname: userInfo?.nickName,
          avatar: userInfo?.avatarUrl
        }
      }
    });
    
    // 4. ä¿å­˜ Token
    const { access_token, user } = result.result.data;
    wx.setStorageSync('token', access_token);
    wx.setStorageSync('userInfo', user);
    
    // 5. è·³è½¬åˆ°é¦–é¡µ
    wx.switchTab({ url: '/pages/index/index' });
    
    wx.hideLoading();
    wx.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' });
    
  } catch (error) {
    wx.hideLoading();
    wx.showToast({ 
      title: error.message || 'ç™»å½•å¤±è´¥', 
      icon: 'none' 
    });
  }
},

// è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦ç”¨æˆ·æˆæƒï¼‰
async getUserProfile() {
  return new Promise((resolve) => {
    wx.getUserProfile({
      desc: 'ç”¨äºå®Œå–„ç”¨æˆ·èµ„æ–™',
      success: (res) => resolve(res.userInfo),
      fail: () => resolve(null) // ç”¨æˆ·æ‹’ç»ä¹Ÿç»§ç»­ç™»å½•
    });
  });
}
```

### 4.2 ç”¨æˆ·åå¯†ç ç™»å½•

#### æ¥å£ä¿¡æ¯
```
POST /auth/login
æ— éœ€ Token
é™æµï¼š1åˆ†é’Ÿ5æ¬¡
```

#### å‰ç«¯å®ç°
```javascript
// pages/auth/login/index.js
data: {
  account: '',    // ç”¨æˆ·å/é‚®ç®±/æ‰‹æœºå·
  password: '',
  rememberMe: false
},

async accountLogin() {
  // 1. è¡¨å•éªŒè¯
  if (!this.data.account) {
    wx.showToast({ title: 'è¯·è¾“å…¥è´¦å·', icon: 'none' });
    return;
  }
  
  if (!this.data.password) {
    wx.showToast({ title: 'è¯·è¾“å…¥å¯†ç ', icon: 'none' });
    return;
  }
  
  try {
    wx.showLoading({ title: 'ç™»å½•ä¸­...' });
    
    // 2. è°ƒç”¨ç™»å½•æ¥å£
    const result = await wx.cloud.callFunction({
      name: 'api-proxy',
      data: {
        method: 'POST',
        path: '/auth/login',
        body: {
          account: this.data.account,
          password: this.data.password
        }
      }
    });
    
    // 3. å¤„ç†å“åº”
    if (result.result.code === 200) {
      const { access_token, user } = result.result.data;
      
      // ä¿å­˜ Token
      wx.setStorageSync('token', access_token);
      wx.setStorageSync('userInfo', user);
      
      // è®°ä½è´¦å·
      if (this.data.rememberMe) {
        wx.setStorageSync('savedAccount', this.data.account);
      }
      
      wx.switchTab({ url: '/pages/index/index' });
      wx.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' });
    }
    
  } catch (error) {
    wx.showToast({ 
      title: error.message || 'ç™»å½•å¤±è´¥', 
      icon: 'none' 
    });
  } finally {
    wx.hideLoading();
  }
}
```

### 4.3 ç”¨æˆ·æ³¨å†Œ

#### æ¥å£ä¿¡æ¯
```
POST /auth/register
æ— éœ€ Token
é™æµï¼š1åˆ†é’Ÿ3æ¬¡
```

#### å‰ç«¯å®ç°
```javascript
// pages/auth/register/index.js
data: {
  username: '',
  password: '',
  confirmPassword: '',
  email: '',
  phone: '',
  nickname: ''
},

async register() {
  // 1. è¡¨å•éªŒè¯
  if (!this.validateForm()) return;
  
  try {
    wx.showLoading({ title: 'æ³¨å†Œä¸­...' });
    
    const result = await wx.cloud.callFunction({
      name: 'api-proxy',
      data: {
        method: 'POST',
        path: '/auth/register',
        body: {
          username: this.data.username,
          password: this.data.password,
          email: this.data.email || undefined,
          phone: this.data.phone || undefined,
          nickname: this.data.nickname || undefined
        }
      }
    });
    
    if (result.result.code === 201) {
      const { access_token, user } = result.result.data;
      
      wx.setStorageSync('token', access_token);
      wx.setStorageSync('userInfo', user);
      
      wx.showToast({ title: 'æ³¨å†ŒæˆåŠŸ', icon: 'success' });
      
      setTimeout(() => {
        wx.switchTab({ url: '/pages/index/index' });
      }, 1500);
    }
    
  } catch (error) {
    const msg = error.message || 'æ³¨å†Œå¤±è´¥';
    wx.showToast({ title: msg, icon: 'none', duration: 2000 });
  } finally {
    wx.hideLoading();
  }
},

validateForm() {
  const { username, password, confirmPassword, email, phone } = this.data;
  
  // ç”¨æˆ·åéªŒè¯
  if (!username) {
    wx.showToast({ title: 'è¯·è¾“å…¥ç”¨æˆ·å', icon: 'none' });
    return false;
  }
  if (!/^[a-zA-Z0-9_-]{3,50}$/.test(username)) {
    wx.showToast({ 
      title: 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œæ¨ªçº¿',
      icon: 'none',
      duration: 2000
    });
    return false;
  }
  
  // å¯†ç éªŒè¯
  if (!password) {
    wx.showToast({ title: 'è¯·è¾“å…¥å¯†ç ', icon: 'none' });
    return false;
  }
  if (password.length < 6) {
    wx.showToast({ title: 'å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦', icon: 'none' });
    return false;
  }
  if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(password)) {
    wx.showToast({ 
      title: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—',
      icon: 'none',
      duration: 2000
    });
    return false;
  }
  
  // ç¡®è®¤å¯†ç 
  if (password !== confirmPassword) {
    wx.showToast({ title: 'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´', icon: 'none' });
    return false;
  }
  
  // é‚®ç®±éªŒè¯ï¼ˆå¯é€‰ï¼‰
  if (email && !/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test(email)) {
    wx.showToast({ title: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®', icon: 'none' });
    return false;
  }
  
  // æ‰‹æœºå·éªŒè¯ï¼ˆå¯é€‰ï¼‰
  if (phone && !/^1[3-9]\d{9}$/.test(phone)) {
    wx.showToast({ title: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®', icon: 'none' });
    return false;
  }
  
  return true;
}
```

### 4.4 è·å–ç”¨æˆ·å‡­è¯åˆ—è¡¨

#### æ¥å£ä¿¡æ¯
```
GET /auth/credentials
éœ€è¦ Token
```

#### å‰ç«¯å®ç°
```javascript
// pages/account/security/index.js
async loadCredentials() {
  try {
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });
    
    const token = wx.getStorageSync('token');
    
    const result = await wx.cloud.callFunction({
      name: 'api-proxy',
      data: {
        method: 'GET',
        path: '/auth/credentials',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    });
    
    if (result.result.code === 200) {
      this.setData({
        credentials: result.result.data.credentials
      });
    }
    
  } catch (error) {
    wx.showToast({ 
      title: 'åŠ è½½å¤±è´¥', 
      icon: 'none' 
    });
  } finally {
    wx.hideLoading();
  }
}
```

### 4.5 ç»‘å®šæ–°è´¦å·

#### æ¥å£ä¿¡æ¯
```
POST /auth/bind-account
éœ€è¦ Token
```

#### å‰ç«¯å®ç°
```javascript
// pages/account/bind/index.js
data: {
  type: 'email',  // email | phone | username
  account: '',
  verificationCode: ''
},

async bindAccount() {
  if (!this.data.account) {
    wx.showToast({ title: 'è¯·è¾“å…¥è´¦å·', icon: 'none' });
    return;
  }
  
  try {
    wx.showLoading({ title: 'ç»‘å®šä¸­...' });
    
    const token = wx.getStorageSync('token');
    
    const result = await wx.cloud.callFunction({
      name: 'api-proxy',
      data: {
        method: 'POST',
        path: '/auth/bind-account',
        headers: {
          'Authorization': `Bearer ${token}`
        },
        body: {
          type: this.data.type,
          account: this.data.account,
          verificationCode: this.data.verificationCode
        }
      }
    });
    
    if (result.result.code === 200) {
      wx.showToast({ title: 'ç»‘å®šæˆåŠŸ', icon: 'success' });
      setTimeout(() => {
        wx.navigateBack();
      }, 1500);
    }
    
  } catch (error) {
    wx.showToast({ 
      title: error.message || 'ç»‘å®šå¤±è´¥', 
      icon: 'none' 
    });
  } finally {
    wx.hideLoading();
  }
}
```

### 4.6 è§£ç»‘è´¦å·

#### æ¥å£ä¿¡æ¯
```
DELETE /auth/credentials/:id
éœ€è¦ Token
```

#### å‰ç«¯å®ç°
```javascript
async unbindAccount(credentialId) {
  // ç¡®è®¤å¯¹è¯æ¡†
  const confirmed = await this.showConfirm('ç¡®å®šè¦è§£ç»‘è¯¥è´¦å·å—ï¼Ÿ');
  if (!confirmed) return;
  
  try {
    wx.showLoading({ title: 'è§£ç»‘ä¸­...' });
    
    const token = wx.getStorageSync('token');
    
    const result = await wx.cloud.callFunction({
      name: 'api-proxy',
      data: {
        method: 'DELETE',
        path: `/auth/credentials/${credentialId}`,
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    });
    
    if (result.result.code === 200) {
      wx.showToast({ title: 'è§£ç»‘æˆåŠŸ', icon: 'success' });
      this.loadCredentials(); // åˆ·æ–°åˆ—è¡¨
    }
    
  } catch (error) {
    wx.showToast({ 
      title: error.message || 'è§£ç»‘å¤±è´¥', 
      icon: 'none' 
    });
  } finally {
    wx.hideLoading();
  }
},

showConfirm(content) {
  return new Promise((resolve) => {
    wx.showModal({
      title: 'æç¤º',
      content,
      success: (res) => resolve(res.confirm)
    });
  });
}
```

### 4.7 ä¿®æ”¹å¯†ç 

#### æ¥å£ä¿¡æ¯
```
POST /auth/set-password
éœ€è¦ Token
```

#### å‰ç«¯å®ç°
```javascript
// pages/account/change-password/index.js
data: {
  newPassword: '',
  confirmPassword: ''
},

async changePassword() {
  const { newPassword, confirmPassword } = this.data;
  
  // éªŒè¯
  if (!newPassword) {
    wx.showToast({ title: 'è¯·è¾“å…¥æ–°å¯†ç ', icon: 'none' });
    return;
  }
  
  if (newPassword.length < 6) {
    wx.showToast({ title: 'å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦', icon: 'none' });
    return;
  }
  
  if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(newPassword)) {
    wx.showToast({ 
      title: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—',
      icon: 'none',
      duration: 2000
    });
    return;
  }
  
  if (newPassword !== confirmPassword) {
    wx.showToast({ title: 'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´', icon: 'none' });
    return;
  }
  
  try {
    wx.showLoading({ title: 'ä¿®æ”¹ä¸­...' });
    
    const token = wx.getStorageSync('token');
    
    const result = await wx.cloud.callFunction({
      name: 'api-proxy',
      data: {
        method: 'POST',
        path: '/auth/set-password',
        headers: {
          'Authorization': `Bearer ${token}`
        },
        body: {
          password: newPassword
        }
      }
    });
    
    if (result.result.code === 200) {
      wx.showToast({ title: 'ä¿®æ”¹æˆåŠŸ', icon: 'success' });
      setTimeout(() => {
        wx.navigateBack();
      }, 1500);
    }
    
  } catch (error) {
    wx.showToast({ 
      title: error.message || 'ä¿®æ”¹å¤±è´¥', 
      icon: 'none' 
    });
  } finally {
    wx.hideLoading();
  }
}
```

---

## 5. å®Œæ•´ä»£ç ç¤ºä¾‹

### 5.1 ç™»å½•é¡µé¢å®Œæ•´ä»£ç 

#### index.wxml
```xml
<!-- pages/auth/login/index.wxml -->
<view class="login-container">
  <!-- é¡¶éƒ¨Logo -->
  <view class="header">
    <image class="logo" src="/images/logo.png" mode="aspectFit" />
    <text class="app-name">CookTip ç¾é£Ÿèœè°±</text>
    <text class="slogan">å‘ç°ç¾é£Ÿï¼Œäº«å—ç”Ÿæ´»</text>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 0 ? 'active' : ''}}"
      bindtap="switchTab"
      data-index="0"
    >
      å¾®ä¿¡ç™»å½•
    </view>
    <view 
      class="tab-item {{activeTab === 1 ? 'active' : ''}}"
      bindtap="switchTab"
      data-index="1"
    >
      è´¦å·ç™»å½•
    </view>
    <view 
      class="tab-item {{activeTab === 2 ? 'active' : ''}}"
      bindtap="switchTab"
      data-index="2"
    >
      æ³¨å†Œè´¦å·
    </view>
  </view>

  <!-- Tabå†…å®¹ -->
  <view class="tab-content">
    <!-- å¾®ä¿¡ç™»å½• -->
    <view class="tab-panel" wx:if="{{activeTab === 0}}">
      <view class="wechat-login">
        <image class="wechat-icon" src="/images/wechat.png" />
        <text class="wechat-text">å¾®ä¿¡ä¸€é”®ç™»å½•æ³¨å†Œ</text>
        <button 
          class="btn btn-wechat" 
          bindtap="wechatLogin"
        >
          ç«‹å³ç™»å½•
        </button>
        <text class="tips">å®‰å…¨ä¾¿æ·ï¼Œæ— éœ€è®°å¿†å¯†ç </text>
      </view>
    </view>

    <!-- è´¦å·ç™»å½• -->
    <view class="tab-panel" wx:if="{{activeTab === 1}}">
      <view class="form">
        <view class="form-item">
          <text class="label">è´¦å·</text>
          <input 
            class="input" 
            placeholder="ç”¨æˆ·å/é‚®ç®±/æ‰‹æœºå·"
            value="{{account}}"
            bindinput="onAccountInput"
          />
        </view>
        <view class="form-item">
          <text class="label">å¯†ç </text>
          <input 
            class="input" 
            type="password"
            placeholder="è¯·è¾“å…¥å¯†ç "
            value="{{password}}"
            bindinput="onPasswordInput"
          />
        </view>
        <view class="form-options">
          <label class="checkbox">
            <checkbox checked="{{rememberMe}}" bindtap="toggleRemember" />
            è®°ä½æˆ‘
          </label>
          <text class="link">å¿˜è®°å¯†ç ï¼Ÿ</text>
        </view>
        <button class="btn btn-account" bindtap="accountLogin">
          ç™»å½•
        </button>
      </view>
    </view>

    <!-- æ³¨å†Œè´¦å· -->
    <view class="tab-panel" wx:if="{{activeTab === 2}}">
      <view class="form">
        <view class="form-item">
          <text class="label">ç”¨æˆ·å *</text>
          <input 
            class="input" 
            placeholder="3-50ä¸ªå­—ç¬¦"
            value="{{registerForm.username}}"
            data-field="username"
            bindinput="onRegisterInput"
          />
        </view>
        <view class="form-item">
          <text class="label">å¯†ç  *</text>
          <input 
            class="input" 
            type="password"
            placeholder="è‡³å°‘6ä½ï¼Œå«å¤§å°å†™æ•°å­—"
            value="{{registerForm.password}}"
            data-field="password"
            bindinput="onRegisterInput"
          />
        </view>
        <view class="form-item">
          <text class="label">ç¡®è®¤å¯†ç  *</text>
          <input 
            class="input" 
            type="password"
            placeholder="å†æ¬¡è¾“å…¥å¯†ç "
            value="{{registerForm.confirmPassword}}"
            data-field="confirmPassword"
            bindinput="onRegisterInput"
          />
        </view>
        <view class="form-item">
          <text class="label">é‚®ç®±</text>
          <input 
            class="input" 
            placeholder="é€‰å¡«"
            value="{{registerForm.email}}"
            data-field="email"
            bindinput="onRegisterInput"
          />
        </view>
        <view class="form-item">
          <text class="label">æ‰‹æœºå·</text>
          <input 
            class="input" 
            placeholder="é€‰å¡«"
            value="{{registerForm.phone}}"
            data-field="phone"
            bindinput="onRegisterInput"
          />
        </view>
        <button class="btn btn-register" bindtap="register">
          æ³¨å†Œ
        </button>
      </view>
    </view>
  </view>
</view>
```

#### index.js
```javascript
// pages/auth/login/index.js
Page({
  data: {
    activeTab: 0,
    account: '',
    password: '',
    rememberMe: false,
    registerForm: {
      username: '',
      password: '',
      confirmPassword: '',
      email: '',
      phone: ''
    }
  },

  onLoad() {
    // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
    const token = wx.getStorageSync('token');
    if (token) {
      wx.switchTab({ url: '/pages/index/index' });
      return;
    }

    // è¯»å–è®°ä½çš„è´¦å·
    const savedAccount = wx.getStorageSync('savedAccount');
    if (savedAccount) {
      this.setData({ 
        account: savedAccount,
        rememberMe: true
      });
    }
  },

  // åˆ‡æ¢Tab
  switchTab(e) {
    const index = e.currentTarget.dataset.index;
    this.setData({ activeTab: index });
  },

  // è¾“å…¥å¤„ç†
  onAccountInput(e) {
    this.setData({ account: e.detail.value });
  },

  onPasswordInput(e) {
    this.setData({ password: e.detail.value });
  },

  toggleRemember() {
    this.setData({ rememberMe: !this.data.rememberMe });
  },

  onRegisterInput(e) {
    const field = e.currentTarget.dataset.field;
    this.setData({
      [`registerForm.${field}`]: e.detail.value
    });
  },

  // å¾®ä¿¡ç™»å½•
  async wechatLogin() {
    try {
      wx.showLoading({ title: 'ç™»å½•ä¸­...' });

      const { code } = await wx.login();
      const userInfo = await this.getUserProfile();

      const result = await wx.cloud.callFunction({
        name: 'api-proxy',
        data: {
          method: 'POST',
          path: '/auth/wechat-login',
          body: {
            code,
            nickname: userInfo?.nickName,
            avatar: userInfo?.avatarUrl
          }
        }
      });

      if (result.result.code === 200) {
        const { access_token, user } = result.result.data;
        wx.setStorageSync('token', access_token);
        wx.setStorageSync('userInfo', user);

        wx.switchTab({ url: '/pages/index/index' });
        wx.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' });
      }

    } catch (error) {
      wx.showToast({ 
        title: error.message || 'ç™»å½•å¤±è´¥', 
        icon: 'none' 
      });
    } finally {
      wx.hideLoading();
    }
  },

  // è´¦å·ç™»å½•
  async accountLogin() {
    if (!this.data.account) {
      wx.showToast({ title: 'è¯·è¾“å…¥è´¦å·', icon: 'none' });
      return;
    }

    if (!this.data.password) {
      wx.showToast({ title: 'è¯·è¾“å…¥å¯†ç ', icon: 'none' });
      return;
    }

    try {
      wx.showLoading({ title: 'ç™»å½•ä¸­...' });

      const result = await wx.cloud.callFunction({
        name: 'api-proxy',
        data: {
          method: 'POST',
          path: '/auth/login',
          body: {
            account: this.data.account,
            password: this.data.password
          }
        }
      });

      if (result.result.code === 200) {
        const { access_token, user } = result.result.data;
        wx.setStorageSync('token', access_token);
        wx.setStorageSync('userInfo', user);

        if (this.data.rememberMe) {
          wx.setStorageSync('savedAccount', this.data.account);
        } else {
          wx.removeStorageSync('savedAccount');
        }

        wx.switchTab({ url: '/pages/index/index' });
        wx.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' });
      }

    } catch (error) {
      wx.showToast({ 
        title: error.message || 'ç™»å½•å¤±è´¥', 
        icon: 'none' 
      });
    } finally {
      wx.hideLoading();
    }
  },

  // æ³¨å†Œ
  async register() {
    const form = this.data.registerForm;

    // è¡¨å•éªŒè¯
    if (!this.validateRegisterForm(form)) return;

    try {
      wx.showLoading({ title: 'æ³¨å†Œä¸­...' });

      const result = await wx.cloud.callFunction({
        name: 'api-proxy',
        data: {
          method: 'POST',
          path: '/auth/register',
          body: {
            username: form.username,
            password: form.password,
            email: form.email || undefined,
            phone: form.phone || undefined
          }
        }
      });

      if (result.result.code === 201) {
        const { access_token, user } = result.result.data;
        wx.setStorageSync('token', access_token);
        wx.setStorageSync('userInfo', user);

        wx.showToast({ title: 'æ³¨å†ŒæˆåŠŸ', icon: 'success' });
        setTimeout(() => {
          wx.switchTab({ url: '/pages/index/index' });
        }, 1500);
      }

    } catch (error) {
      wx.showToast({ 
        title: error.message || 'æ³¨å†Œå¤±è´¥', 
        icon: 'none',
        duration: 2000
      });
    } finally {
      wx.hideLoading();
    }
  },

  // è¡¨å•éªŒè¯
  validateRegisterForm(form) {
    if (!form.username) {
      wx.showToast({ title: 'è¯·è¾“å…¥ç”¨æˆ·å', icon: 'none' });
      return false;
    }

    if (!/^[a-zA-Z0-9_-]{3,50}$/.test(form.username)) {
      wx.showToast({ 
        title: 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œæ¨ªçº¿',
        icon: 'none',
        duration: 2000
      });
      return false;
    }

    if (!form.password || form.password.length < 6) {
      wx.showToast({ title: 'å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦', icon: 'none' });
      return false;
    }

    if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(form.password)) {
      wx.showToast({ 
        title: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—',
        icon: 'none',
        duration: 2000
      });
      return false;
    }

    if (form.password !== form.confirmPassword) {
      wx.showToast({ title: 'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´', icon: 'none' });
      return false;
    }

    if (form.email && !/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test(form.email)) {
      wx.showToast({ title: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®', icon: 'none' });
      return false;
    }

    if (form.phone && !/^1[3-9]\d{9}$/.test(form.phone)) {
      wx.showToast({ title: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®', icon: 'none' });
      return false;
    }

    return true;
  },

  // è·å–ç”¨æˆ·ä¿¡æ¯
  getUserProfile() {
    return new Promise((resolve) => {
      wx.getUserProfile({
        desc: 'ç”¨äºå®Œå–„ç”¨æˆ·èµ„æ–™',
        success: (res) => resolve(res.userInfo),
        fail: () => resolve(null)
      });
    });
  }
});
```

#### index.wxss
```css
/* pages/auth/login/index.wxss */
.login-container {
  min-height: 100vh;
  background: linear-gradient(180deg, #FF6B35 0%, #FFFFFF 40%);
  padding: 60rpx 40rpx;
}

.header {
  text-align: center;
  margin-bottom: 80rpx;
}

.logo {
  width: 160rpx;
  height: 160rpx;
  margin-bottom: 24rpx;
}

.app-name {
  display: block;
  font-size: 48rpx;
  font-weight: bold;
  color: white;
  margin-bottom: 16rpx;
}

.slogan {
  display: block;
  font-size: 28rpx;
  color: rgba(255, 255, 255, 0.9);
}

/* Tabæ ·å¼ */
.tabs {
  display: flex;
  background: white;
  border-radius: 16rpx 16rpx 0 0;
  overflow: hidden;
}

.tab-item {
  flex: 1;
  text-align: center;
  padding: 32rpx 0;
  font-size: 30rpx;
  color: #999;
  position: relative;
}

.tab-item.active {
  color: #FF6B35;
  font-weight: bold;
}

.tab-item.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 60rpx;
  height: 6rpx;
  background: #FF6B35;
  border-radius: 3rpx;
}

/* Tabå†…å®¹ */
.tab-content {
  background: white;
  border-radius: 0 0 16rpx 16rpx;
  padding: 60rpx 40rpx;
  min-height: 600rpx;
}

/* å¾®ä¿¡ç™»å½•æ ·å¼ */
.wechat-login {
  text-align: center;
  padding: 60rpx 0;
}

.wechat-icon {
  width: 160rpx;
  height: 160rpx;
  margin-bottom: 40rpx;
}

.wechat-text {
  display: block;
  font-size: 32rpx;
  color: #333;
  margin-bottom: 60rpx;
}

.tips {
  display: block;
  margin-top: 24rpx;
  font-size: 24rpx;
  color: #999;
}

/* è¡¨å•æ ·å¼ */
.form {
  padding: 20rpx 0;
}

.form-item {
  margin-bottom: 40rpx;
}

.label {
  display: block;
  font-size: 28rpx;
  color: #333;
  margin-bottom: 16rpx;
}

.input {
  width: 100%;
  height: 88rpx;
  padding: 0 24rpx;
  background: #F7F8FA;
  border-radius: 12rpx;
  font-size: 28rpx;
}

.form-options {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40rpx;
  font-size: 26rpx;
}

.checkbox {
  color: #666;
}

.link {
  color: #FF6B35;
}

/* æŒ‰é’®æ ·å¼ */
.btn {
  width: 100%;
  height: 88rpx;
  line-height: 88rpx;
  border-radius: 44rpx;
  font-size: 32rpx;
  font-weight: bold;
  border: none;
}

.btn-wechat {
  background: linear-gradient(135deg, #07C160 0%, #06AE56 100%);
  color: white;
}

.btn-account {
  background: linear-gradient(135deg, #FF6B35 0%, #FF5722 100%);
  color: white;
}

.btn-register {
  background: linear-gradient(135deg, #576574 0%, #3D4752 100%);
  color: white;
}

.btn::after {
  border: none;
}
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 Token ç®¡ç†

```javascript
// utils/auth.js
class AuthManager {
  // ä¿å­˜ Token
  static saveToken(token) {
    wx.setStorageSync('token', token);
    wx.setStorageSync('tokenTime', Date.now());
  }

  // è·å– Token
  static getToken() {
    return wx.getStorageSync('token');
  }

  // æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸï¼ˆ7å¤©ï¼‰
  static isTokenExpired() {
    const tokenTime = wx.getStorageSync('tokenTime');
    if (!tokenTime) return true;
    
    const days = (Date.now() - tokenTime) / (1000 * 60 * 60 * 24);
    return days > 7;
  }

  // æ¸…é™¤ Token
  static clearToken() {
    wx.removeStorageSync('token');
    wx.removeStorageSync('tokenTime');
    wx.removeStorageSync('userInfo');
  }

  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  static checkLogin() {
    const token = this.getToken();
    if (!token || this.isTokenExpired()) {
      this.clearToken();
      wx.redirectTo({ url: '/pages/auth/login/index' });
      return false;
    }
    return true;
  }
}

module.exports = AuthManager;
```

### 6.2 API è¯·æ±‚å°è£…

```javascript
// utils/request.js
const AuthManager = require('./auth');

class Request {
  static async call(options) {
    const { method, path, body, headers = {}, needAuth = true } = options;

    // æ·»åŠ  Token
    if (needAuth) {
      const token = AuthManager.getToken();
      if (!token) {
        wx.redirectTo({ url: '/pages/auth/login/index' });
        throw new Error('è¯·å…ˆç™»å½•');
      }
      headers.Authorization = `Bearer ${token}`;
    }

    try {
      const result = await wx.cloud.callFunction({
        name: 'api-proxy',
        data: {
          method,
          path,
          body,
          headers
        }
      });

      // Token è¿‡æœŸå¤„ç†
      if (result.result.code === 401) {
        AuthManager.clearToken();
        wx.redirectTo({ url: '/pages/auth/login/index' });
        throw new Error('ç™»å½•å·²è¿‡æœŸ');
      }

      return result.result;

    } catch (error) {
      console.error('APIè¯·æ±‚å¤±è´¥:', error);
      throw error;
    }
  }

  // GET è¯·æ±‚
  static get(path, needAuth = true) {
    return this.call({ method: 'GET', path, needAuth });
  }

  // POST è¯·æ±‚
  static post(path, body, needAuth = true) {
    return this.call({ method: 'POST', path, body, needAuth });
  }

  // PUT è¯·æ±‚
  static put(path, body, needAuth = true) {
    return this.call({ method: 'PUT', path, body, needAuth });
  }

  // DELETE è¯·æ±‚
  static delete(path, needAuth = true) {
    return this.call({ method: 'DELETE', path, needAuth });
  }
}

module.exports = Request;
```

### 6.3 ä½¿ç”¨ç¤ºä¾‹

```javascript
// pages/some-page/index.js
const Request = require('../../utils/request');
const AuthManager = require('../../utils/auth');

Page({
  onLoad() {
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    if (!AuthManager.checkLogin()) return;
    
    this.loadData();
  },

  async loadData() {
    try {
      const result = await Request.get('/recipes');
      if (result.code === 200) {
        this.setData({ recipes: result.data.items });
      }
    } catch (error) {
      wx.showToast({ title: 'åŠ è½½å¤±è´¥', icon: 'none' });
    }
  }
});
```

### 6.4 å…¨å±€ç™»å½•æ‹¦æˆª

```javascript
// app.js
const AuthManager = require('./utils/auth');

App({
  onLaunch() {
    // åˆå§‹åŒ–äº‘å¼€å‘
    wx.cloud.init({
      env: 'your-env-id',
      traceUser: true
    });
  },

  onShow() {
    // æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ
    if (AuthManager.isTokenExpired()) {
      const pages = getCurrentPages();
      const currentPage = pages[pages.length - 1];
      
      // éç™»å½•é¡µæ‰è·³è½¬
      if (!currentPage.route.includes('auth/login')) {
        AuthManager.clearToken();
        wx.redirectTo({ url: '/pages/auth/login/index' });
      }
    }
  }
});
```

---

## 7. å¸¸è§é—®é¢˜

### Q1: æ‰€æœ‰ç™»å½•æ¥å£è¿”å› 404 é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Cannot POST /auth/wechat-login (404 Not Found)
Cannot POST /auth/login (404 Not Found)
```

**åŸå› **ï¼šäº‘å‡½æ•°æ²¡æœ‰æœ€æ–°çš„ä»£ç ï¼ˆç¼ºå°‘è‡ªåŠ¨æ·»åŠ  `/api/v1` å‰ç¼€çš„é€»è¾‘ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰**
   ```powershell
   # Windows
   .\scripts\deploy-api-proxy.ps1
   
   # Mac/Linux
   bash scripts/deploy-api-proxy.sh
   ```

2. **æ‰‹åŠ¨éƒ¨ç½²**
   - æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
   - æ‰¾åˆ° `cloudfunctions/api-proxy` æ–‡ä»¶å¤¹
   - å³é”® â†’ **ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–**
   - ç­‰å¾… 1-2 åˆ†é’Ÿç”Ÿæ•ˆ

3. **éªŒè¯ä¿®å¤**
   ```javascript
   // åœ¨å°ç¨‹åºæ§åˆ¶å°æµ‹è¯•
   wx.cloud.callFunction({
     name: 'api-proxy',
     data: {
       method: 'GET',
       path: '/health'  // ä¸éœ€è¦ /api/v1 å‰ç¼€
     }
   }).then(res => console.log('âœ… ä¿®å¤æˆåŠŸ', res))
   ```

ğŸ“š **è¯¦ç»†æ–‡æ¡£**: `ä¿®å¤404é”™è¯¯-éƒ¨ç½²æŒ‡å—.md`

---

### Q2: ç”¨æˆ·å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ

**A:** ç›®å‰æš‚ä¸æ”¯æŒå¯†ç é‡ç½®åŠŸèƒ½ã€‚å»ºè®®ï¼š
1. å¦‚æœç»‘å®šäº†å¾®ä¿¡ï¼Œå¯ä»¥ä½¿ç”¨å¾®ä¿¡ç™»å½•
2. è”ç³»å®¢æœé‡ç½®å¯†ç 
3. åç»­ç‰ˆæœ¬ä¼šæ·»åŠ é‚®ç®±/æ‰‹æœºå·éªŒè¯ç é‡ç½®åŠŸèƒ½

### Q3: ä¸€ä¸ªå¾®ä¿¡å·å¯ä»¥ç»‘å®šå¤šä¸ªè´¦å·å—ï¼Ÿ

**A:** ä¸å¯ä»¥ã€‚ä¸€ä¸ªå¾®ä¿¡ OpenID åªèƒ½å¯¹åº”ä¸€ä¸ªç”¨æˆ·è´¦å·ã€‚ä½†ä¸€ä¸ªç”¨æˆ·è´¦å·å¯ä»¥ç»‘å®šå¤šç§ç™»å½•æ–¹å¼ï¼ˆç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºå·ï¼‰ã€‚

---

### Q4: å¦‚ä½•å®ç°è‡ªåŠ¨ç™»å½•ï¼Ÿ

**A:** Token æœ‰æ•ˆæœŸä¸º 7 å¤©ï¼Œåªéœ€åœ¨ `app.onLaunch()` æ—¶æ£€æŸ¥ Token æ˜¯å¦æœ‰æ•ˆå³å¯ï¼š

```javascript
// app.js
onLaunch() {
  const token = wx.getStorageSync('token');
  if (token && !AuthManager.isTokenExpired()) {
    // Token æœ‰æ•ˆï¼Œè‡ªåŠ¨ç™»å½•
    this.globalData.isLoggedIn = true;
  }
}
```

### Q5: å¦‚ä½•å¤„ç† Token è¿‡æœŸï¼Ÿ

**A:** åœ¨ API è¯·æ±‚å°è£…ä¸­ç»Ÿä¸€å¤„ç† 401 é”™è¯¯ï¼š

```javascript
if (result.code === 401) {
  AuthManager.clearToken();
  wx.redirectTo({ url: '/pages/auth/login/index' });
}
```

### Q6: å¾®ä¿¡ç™»å½•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** å¸¸è§åŸå› ï¼š
1. æ£€æŸ¥å°ç¨‹åº AppID å’Œ AppSecret é…ç½®
2. ç¡®ä¿åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
3. æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—
4. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

### Q7: å¦‚ä½•åœ¨å¼€å‘æ—¶æµ‹è¯•ä¸åŒç™»å½•æ–¹å¼ï¼Ÿ

**A:** å»ºè®®æµç¨‹ï¼š
1. å…ˆæµ‹è¯•å¾®ä¿¡ç™»å½•ï¼ˆæœ€å¸¸ç”¨ï¼‰
2. æ³¨å†Œä¸€ä¸ªæµ‹è¯•è´¦å·
3. æµ‹è¯•ç”¨æˆ·å/é‚®ç®±/æ‰‹æœºå·ç™»å½•
4. æµ‹è¯•è´¦å·ç»‘å®šåŠŸèƒ½

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡æ¡£
- **é¡¹ç›®æ¶æ„æ–‡æ¡£.md** - åç«¯æ¶æ„è¯´æ˜
- **åç«¯APIå¼€å‘æ–‡æ¡£.md** - å®Œæ•´ API å‚è€ƒ
- **äº‘å‡½æ•°éƒ¨ç½²å®Œæ•´æŒ‡å—.md** - äº‘å‡½æ•°éƒ¨ç½²

### API åœ°å€
- **ç”Ÿäº§ç¯å¢ƒ**: `https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1`
- **Swagger æ–‡æ¡£**: `/api/docs`

### è”ç³»æ–¹å¼
- GitHub: [CookTip-Backend](https://github.com/David07aa/CookTip-Backend)
- Email: 3509204288@qq.com

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0 (2025-10-17)
- âœ… æ–°å¢ç”¨æˆ·åå¯†ç ç™»å½•
- âœ… æ–°å¢ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- âœ… æ–°å¢è´¦å·ç»‘å®šåŠŸèƒ½
- âœ… æ”¯æŒé‚®ç®±/æ‰‹æœºå·ç™»å½•
- âœ… ä¼˜åŒ– UI è®¾è®¡
- âœ… å®Œå–„å®‰å…¨æœºåˆ¶

### v1.0
- âœ… å¾®ä¿¡ç™»å½•
- âœ… åŸºç¡€ API åŠŸèƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2025-10-17  
**ç»´æŠ¤è€…**: CookTip å¼€å‘å›¢é˜Ÿ

ğŸ‰ **ç¥å¼€å‘é¡ºåˆ©ï¼**

