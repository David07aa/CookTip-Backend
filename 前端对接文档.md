# 🎉 CookTip 后端 API 前端对接文档

## 📊 项目状态

✅ **后端部署完成**  
✅ **数据库迁移完成** (MySQL → PostgreSQL)  
✅ **老乡鸡菜谱导入完成** (198个菜谱)  
✅ **API 接口测试通过**  
✅ **准备前端对接**

---

## 🌐 API 基础信息

**Base URL：** `https://cooktip-backend.vercel.app`  
**数据库：** Vercel Postgres (Neon)  
**数据总量：** 198 个老乡鸡经典菜谱  
**认证方式：** JWT (部分接口需要)

---

## 📡 核心 API 接口

### 1. 食谱相关

#### 获取食谱列表
```http
GET /api/recipes?page=1&limit=10
```

**查询参数：**
- `page` (可选): 页码，默认1
- `limit` (可选): 每页数量，默认10
- `category` (可选): 分类筛选
- `difficulty` (可选): 难度筛选 (简单/中等/困难)
- `health` (可选): health=check 用于健康检查

**响应示例：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "list": [
      {
        "id": "uuid",
        "title": "宫保鸡丁",
        "category": "炒菜",
        "difficulty": "中等",
        "cookTime": 30,
        "coverImage": "url",
        "introduction": "经典川菜...",
        "likes": 0,
        "collects": 0,
        "viewCount": 0
      }
    ],
    "pagination": {
      "total": 198,
      "page": 1,
      "pageSize": 10,
      "pages": 20
    }
  }
}
```

#### 获取食谱详情
```http
GET /api/recipes/{id}
```

**响应示例：**
```json
{
  "code": 200,
  "data": {
    "id": "uuid",
    "title": "宫保鸡丁",
    "introduction": "经典川菜...",
    "category": "炒菜",
    "difficulty": "中等",
    "cookTime": 30,
    "ingredients": [
      {
        "name": "鸡胸肉",
        "amount": "200g"
      }
    ],
    "steps": [
      {
        "order": 1,
        "content": "鸡胸肉切丁...",
        "image": "url"
      }
    ],
    "nutrition": {
      "calories": "350kcal",
      "protein": "25g"
    },
    "tips": "小贴士内容",
    "likes": 0,
    "collects": 0,
    "viewCount": 0
  }
}
```

---

### 2. 搜索接口

#### 搜索食谱
```http
GET /api/search?keyword=鸡&page=1&pageSize=10
```

**查询参数：**
- `keyword` (必需): 搜索关键词
- `page` (可选): 页码
- `pageSize` (可选): 每页数量

**响应格式：** 与食谱列表相同

---

### 3. 分类接口

#### 获取所有分类
```http
GET /api/categories
```

**响应示例：**
```json
{
  "code": 200,
  "data": [
    "炒菜",
    "凉菜",
    "汤",
    "主食",
    "小吃",
    "甜品"
  ]
}
```

---

### 4. 用户相关 (需要认证)

#### 微信登录
```http
POST /api/auth/login
Content-Type: application/json

{
  "code": "微信登录code"
}
```

**响应示例：**
```json
{
  "code": 200,
  "data": {
    "token": "jwt-token",
    "user": {
      "id": "uuid",
      "nickName": "用户昵称",
      "avatar": "头像URL"
    }
  }
}
```

#### 获取用户信息
```http
GET /api/user/info
Authorization: Bearer {token}
```

---

### 5. 收藏相关 (需要认证)

#### 获取收藏列表
```http
GET /api/favorites?page=1&limit=10
Authorization: Bearer {token}
```

#### 添加/取消收藏
```http
POST /api/favorites
Authorization: Bearer {token}
Content-Type: application/json

{
  "recipeId": "uuid"
}
```

---

### 6. 点赞相关 (需要认证)

#### 点赞/取消点赞
```http
POST /api/likes
Authorization: Bearer {token}
Content-Type: application/json

{
  "recipeId": "uuid"
}
```

---

### 7. 评论相关 (需要认证)

#### 获取评论列表
```http
GET /api/comments?recipeId={id}&page=1&limit=10
```

#### 添加评论
```http
POST /api/comments
Authorization: Bearer {token}
Content-Type: application/json

{
  "recipeId": "uuid",
  "content": "评论内容",
  "rating": 5,
  "images": ["url1", "url2"]
}
```

---

## 🔐 认证说明

需要认证的接口需要在请求头中添加 JWT token：

```javascript
fetch('https://cooktip-backend.vercel.app/api/user/info', {
  headers: {
    'Authorization': 'Bearer ' + token,
    'Content-Type': 'application/json'
  }
})
```

---

## 💻 前端示例代码

### Vue 3 示例

```javascript
// api/recipes.js
import axios from 'axios'

const BASE_URL = 'https://cooktip-backend.vercel.app'

// 获取食谱列表
export const getRecipes = (params) => {
  return axios.get(`${BASE_URL}/api/recipes`, { params })
}

// 获取食谱详情
export const getRecipeDetail = (id) => {
  return axios.get(`${BASE_URL}/api/recipes/${id}`)
}

// 搜索食谱
export const searchRecipes = (keyword, page = 1) => {
  return axios.get(`${BASE_URL}/api/search`, {
    params: { keyword, page, pageSize: 10 }
  })
}

// 使用示例
async function loadRecipes() {
  try {
    const response = await getRecipes({ page: 1, limit: 10 })
    console.log('食谱列表:', response.data.data.list)
  } catch (error) {
    console.error('获取失败:', error)
  }
}
```

### 微信小程序示例

```javascript
// utils/api.js
const BASE_URL = 'https://cooktip-backend.vercel.app'

// 获取食谱列表
export function getRecipes(params) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: `${BASE_URL}/api/recipes`,
      data: params,
      success: (res) => resolve(res.data),
      fail: reject
    })
  })
}

// 使用示例
async function loadRecipes() {
  try {
    const data = await getRecipes({ page: 1, limit: 10 })
    console.log('食谱总数:', data.data.pagination.total)
    console.log('食谱列表:', data.data.list)
  } catch (error) {
    console.error('获取失败:', error)
  }
}
```

---

## 🎨 数据字段说明

### 食谱对象 (Recipe)

| 字段 | 类型 | 说明 |
|-----|------|------|
| `id` | string | UUID |
| `title` | string | 菜谱标题 |
| `introduction` | string | 菜谱简介 |
| `category` | string | 分类 |
| `difficulty` | string | 难度 (简单/中等/困难) |
| `cookTime` | number | 烹饪时间(分钟) |
| `coverImage` | string | 封面图URL |
| `ingredients` | array | 原料列表 |
| `steps` | array | 步骤列表 |
| `nutrition` | object | 营养信息 |
| `tips` | string | 小贴士 |
| `likes` | number | 点赞数 |
| `collects` | number | 收藏数 |
| `viewCount` | number | 浏览次数 |

### 原料对象 (Ingredient)

| 字段 | 类型 | 说明 |
|-----|------|------|
| `name` | string | 原料名称 |
| `amount` | string | 用量 |
| `note` | string | 备注 (可选) |

### 步骤对象 (Step)

| 字段 | 类型 | 说明 |
|-----|------|------|
| `order` | number | 步骤序号 |
| `content` | string | 步骤内容 |
| `image` | string | 步骤图片 (可选) |
| `time` | number | 所需时间(分钟, 可选) |

---

## ⚠️ 注意事项

### 速率限制
- Vercel Hobby 计划有速率限制
- 建议前端添加防抖/节流
- 避免短时间内大量请求

### CORS
- 已配置跨域支持
- 支持所有来源的请求

### 错误处理
```javascript
// 统一错误处理示例
axios.interceptors.response.use(
  response => response,
  error => {
    if (error.response) {
      switch (error.response.status) {
        case 401:
          // 未授权，跳转登录
          break
        case 404:
          // 资源不存在
          break
        case 429:
          // 请求过于频繁
          console.warn('请求过于频繁，请稍后再试')
          break
        case 500:
          // 服务器错误
          break
      }
    }
    return Promise.reject(error)
  }
)
```

---

## 📝 TODO 清单

前端开发建议步骤：

- [ ] 1. 配置 API 基础URL和请求拦截器
- [ ] 2. 实现食谱列表页面
- [ ] 3. 实现食谱详情页面
- [ ] 4. 实现搜索功能
- [ ] 5. 实现分类筛选
- [ ] 6. 实现微信登录
- [ ] 7. 实现收藏功能
- [ ] 8. 实现点赞功能
- [ ] 9. 实现评论功能
- [ ] 10. 性能优化和错误处理

---

## 🚀 快速测试

**健康检查：**
```bash
curl https://cooktip-backend.vercel.app/api/recipes?health=check
```

**获取食谱列表：**
```bash
curl https://cooktip-backend.vercel.app/api/recipes?page=1&limit=5
```

**搜索食谱：**
```bash
curl "https://cooktip-backend.vercel.app/api/search?keyword=鸡"
```

---

## 📞 技术支持

- **API文档版本：** v1.0
- **最后更新：** 2025-10-02
- **菜谱数据来源：** 老乡鸡官方菜谱 (198个)

---

## 🎉 后续计划

1. ✅ 后端API部署
2. ✅ 数据库迁移和优化
3. ✅ 老乡鸡菜谱导入
4. 🔄 前端开发对接 (进行中)
5. ⏳ 用户测试和反馈
6. ⏳ 性能优化和扩展

---

**祝开发顺利！** 🚀

