# 前端营养成分显示指南

## 📊 营养成分数据结构

### 后端返回的数据格式

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 4,
    "title": "红烧排骨",
    "servings": 4,
    "nutrition": {
      "calories": "450kcal",
      "protein": "32g",
      "fat": "28g",
      "carbs": "15g"
    }
    // ... 其他字段
  }
}
```

### 营养成分字段说明

| 字段名 | 中文名 | 示例值 | 说明 |
|--------|--------|--------|------|
| `calories` | 热量 | `"450kcal"` | 每份的热量 |
| `protein` | 蛋白质 | `"32g"` | 每份的蛋白质含量 |
| `fat` | 脂肪 | `"28g"` | 每份的脂肪含量 |
| `carbs` | 碳水化合物 | `"15g"` | 每份的碳水化合物含量 |

## 🎨 前端显示示例

### 微信小程序 WXML

```xml
<!-- 营养成分卡片 -->
<view class="nutrition-card" wx:if="{{recipe.nutrition}}">
  <view class="card-title">营养成分（每份）</view>
  
  <view class="nutrition-grid">
    <!-- 热量 -->
    <view class="nutrition-item">
      <view class="nutrition-label">热量</view>
      <view class="nutrition-value">{{recipe.nutrition.calories || '-'}}</view>
    </view>
    
    <!-- 蛋白质 -->
    <view class="nutrition-item">
      <view class="nutrition-label">蛋白质</view>
      <view class="nutrition-value">{{recipe.nutrition.protein || '-'}}</view>
    </view>
    
    <!-- 脂肪 -->
    <view class="nutrition-item">
      <view class="nutrition-label">脂肪</view>
      <view class="nutrition-value">{{recipe.nutrition.fat || '-'}}</view>
    </view>
    
    <!-- 碳水 -->
    <view class="nutrition-item">
      <view class="nutrition-label">碳水</view>
      <view class="nutrition-value">{{recipe.nutrition.carbs || '-'}}</view>
    </view>
  </view>
  
  <view class="nutrition-note" wx:if="{{recipe.servings}}">
    * 以上为 {{recipe.servings}} 人份的营养成分
  </view>
</view>

<!-- 如果没有营养成分数据，显示提示 -->
<view class="no-nutrition" wx:else>
  <text>暂无营养成分数据</text>
</view>
```

### 微信小程序 WXSS

```css
/* 营养成分卡片样式 */
.nutrition-card {
  background: #fff;
  border-radius: 16rpx;
  padding: 32rpx;
  margin: 24rpx 0;
  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);
}

.card-title {
  font-size: 32rpx;
  font-weight: 600;
  color: #333;
  margin-bottom: 24rpx;
}

.nutrition-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24rpx;
}

.nutrition-item {
  background: #f8f9fa;
  border-radius: 12rpx;
  padding: 24rpx;
  text-align: center;
}

.nutrition-label {
  font-size: 24rpx;
  color: #999;
  margin-bottom: 8rpx;
}

.nutrition-value {
  font-size: 36rpx;
  font-weight: 600;
  color: #ff6b6b;
}

.nutrition-note {
  font-size: 24rpx;
  color: #999;
  margin-top: 16rpx;
  text-align: center;
}

.no-nutrition {
  padding: 48rpx;
  text-align: center;
  color: #999;
  font-size: 28rpx;
}
```

### 微信小程序 JS

```javascript
Page({
  data: {
    recipe: null
  },

  onLoad(options) {
    const recipeId = options.id;
    this.loadRecipeDetail(recipeId);
  },

  async loadRecipeDetail(recipeId) {
    try {
      wx.showLoading({ title: '加载中...' });
      
      const res = await wx.request({
        url: `https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/recipes/${recipeId}`,
        method: 'GET'
      });

      if (res.data.code === 200) {
        this.setData({
          recipe: res.data.data
        });
        
        // 调试：打印营养成分数据
        console.log('营养成分:', res.data.data.nutrition);
        
        // 检查是否有营养成分
        if (!res.data.data.nutrition) {
          console.warn('该食谱没有营养成分数据');
        }
      } else {
        wx.showToast({
          title: '加载失败',
          icon: 'none'
        });
      }
    } catch (error) {
      console.error('加载食谱详情失败:', error);
      wx.showToast({
        title: '网络错误',
        icon: 'none'
      });
    } finally {
      wx.hideLoading();
    }
  }
});
```

## 🔍 问题排查步骤

### 1. 检查 API 返回数据

在小程序开发者工具的 Console 中查看：

```javascript
// 加载食谱详情后，打印完整数据
console.log('食谱详情:', recipe);
console.log('营养成分:', recipe.nutrition);
```

**期望结果**：
```javascript
{
  calories: "450kcal",
  protein: "32g",
  fat: "28g",
  carbs: "15g"
}
```

### 2. 检查数据绑定

确保在 WXML 中正确使用了 `nutrition` 字段：

```xml
<!-- ✅ 正确 -->
<text>{{recipe.nutrition.calories}}</text>

<!-- ❌ 错误 -->
<text>{{recipe.nutritionInfo.calories}}</text>
<text>{{recipe.nutrient.calories}}</text>
```

### 3. 检查条件渲染

确保使用了 `wx:if` 来判断数据是否存在：

```xml
<!-- ✅ 正确 -->
<view wx:if="{{recipe.nutrition}}">
  {{recipe.nutrition.calories}}
</view>

<!-- ❌ 错误（没有判断，会报错） -->
<view>
  {{recipe.nutrition.calories}}
</view>
```

### 4. 检查 API 地址

确保使用的是云托管地址：

```javascript
// ✅ 正确（云托管地址）
const API_BASE = 'https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com';

// ❌ 错误（旧地址或本地地址）
const API_BASE = 'http://localhost:3000';
```

## 📱 完整的营养成分展示组件

### components/nutrition-card/nutrition-card.wxml

```xml
<view class="nutrition-card" wx:if="{{nutrition}}">
  <view class="card-header">
    <view class="card-title">营养成分</view>
    <view class="servings-info" wx:if="{{servings}}">{{servings}}人份</view>
  </view>
  
  <view class="nutrition-list">
    <view class="nutrition-row">
      <view class="nutrition-item primary">
        <text class="label">热量</text>
        <text class="value">{{nutrition.calories || '-'}}</text>
      </view>
    </view>
    
    <view class="nutrition-row">
      <view class="nutrition-item">
        <text class="label">蛋白质</text>
        <text class="value">{{nutrition.protein || '-'}}</text>
      </view>
      
      <view class="nutrition-item">
        <text class="label">脂肪</text>
        <text class="value">{{nutrition.fat || '-'}}</text>
      </view>
      
      <view class="nutrition-item">
        <text class="label">碳水</text>
        <text class="value">{{nutrition.carbs || '-'}}</text>
      </view>
    </view>
  </view>
</view>
```

### components/nutrition-card/nutrition-card.js

```javascript
Component({
  properties: {
    nutrition: {
      type: Object,
      value: null
    },
    servings: {
      type: Number,
      value: 1
    }
  }
});
```

### 使用组件

```xml
<!-- 在食谱详情页面中使用 -->
<nutrition-card 
  nutrition="{{recipe.nutrition}}" 
  servings="{{recipe.servings}}"
/>
```

## 🎯 当前所有食谱的营养成分数据

| 食谱ID | 标题 | 热量 | 蛋白质 | 脂肪 | 碳水 | 份数 |
|--------|------|------|--------|------|------|------|
| 4 | 红烧排骨 | 450kcal | 32g | 28g | 15g | 4人份 |
| 5 | 戚风蛋糕 | 220kcal | 6g | 12g | 22g | 8人份 |
| 6 | 番茄炒蛋 | 180kcal | 12g | 10g | 8g | 2人份 |
| 7 | 抹茶拿铁 | 150kcal | 7g | 5g | 20g | 1人份 |
| 8 | 宫保鸡丁 | 380kcal | 28g | 18g | 25g | 3人份 |

## 💡 常见问题

### Q1: 为什么前端显示不出营养成分？
**A**: 检查以下几点：
1. API 请求是否成功（检查 Network）
2. 数据字段名是否正确（`nutrition` 不是 `nutritionInfo`）
3. 是否使用了 `wx:if` 条件渲染
4. 是否使用了云托管地址而不是本地地址

### Q2: 如何在列表页显示热量？
**A**: 
```xml
<text>{{item.nutrition ? item.nutrition.calories : '未知'}}</text>
```

### Q3: 营养成分数据是每份还是总量？
**A**: 后端返回的是 **每份** 的营养成分，请配合 `servings` 字段显示总份数。

---

**如果前端还是看不到营养成分，请提供前端代码的截图或代码片段，我可以帮你定位问题！** 🔍

