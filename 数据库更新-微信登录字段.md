# 数据库更新 - 添加微信登录字段

## ⚠️ 重要说明

由于 Vercel Hobby 计划限制（最多 12 个 Serverless Functions），已删除 `/api/migrate/add-wechat-fields` 接口。

请手动执行以下 SQL 来更新数据库结构。

---

## 🗄️ 执行步骤

### 方式一：在 Neon 控制台执行（推荐）

1. 访问 [Neon Console](https://console.neon.tech/)
2. 选择你的项目和数据库
3. 点击 "SQL Editor"
4. 复制并执行以下 SQL：

```sql
-- 添加 session_key 字段
ALTER TABLE users 
ADD COLUMN IF NOT EXISTS session_key VARCHAR(100);

-- 添加 union_id 字段
ALTER TABLE users 
ADD COLUMN IF NOT EXISTS union_id VARCHAR(100);

-- 为 union_id 添加索引
CREATE INDEX IF NOT EXISTS idx_users_union_id ON users(union_id);
```

5. 点击 "Run" 执行

### 方式二：使用 SQL 文件

执行项目中的 `scripts/add-wechat-fields.sql` 文件。

---

## ✅ 验证

执行以下 SQL 验证字段是否添加成功：

```sql
SELECT column_name, data_type, is_nullable
FROM information_schema.columns 
WHERE table_name = 'users' 
AND column_name IN ('openid', 'session_key', 'union_id')
ORDER BY column_name;
```

**预期结果**：

| column_name | data_type | is_nullable |
|-------------|-----------|-------------|
| openid | character varying | NO |
| session_key | character varying | YES |
| union_id | character varying | YES |

---

## 📋 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `openid` | VARCHAR(100) | 微信 OpenID（已存在） |
| `session_key` | VARCHAR(100) | 微信 Session Key（新增） |
| `union_id` | VARCHAR(100) | 微信 UnionID（新增，可选） |

---

## 🚀 更新完成后

执行完 SQL 后，微信登录功能即可正常使用。

测试接口：
```
POST https://cooktip-backend.vercel.app/api/auth/wechat
```

详细使用方法请查看 `微信登录开发文档.md`。

---

**创建时间**: 2025-10-02  
**状态**: 待执行

