# æ•°æ®åº“æ›´æ–° - æ·»åŠ å¾®ä¿¡ç™»å½•å­—æ®µ

## âš ï¸ é‡è¦è¯´æ˜

ç”±äº Vercel Hobby è®¡åˆ’é™åˆ¶ï¼ˆæœ€å¤š 12 ä¸ª Serverless Functionsï¼‰ï¼Œå·²åˆ é™¤ `/api/migrate/add-wechat-fields` æ¥å£ã€‚

è¯·æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹ SQL æ¥æ›´æ–°æ•°æ®åº“ç»“æ„ã€‚

---

## ğŸ—„ï¸ æ‰§è¡Œæ­¥éª¤

### æ–¹å¼ä¸€ï¼šåœ¨ Neon æ§åˆ¶å°æ‰§è¡Œï¼ˆæ¨èï¼‰

1. è®¿é—® [Neon Console](https://console.neon.tech/)
2. é€‰æ‹©ä½ çš„é¡¹ç›®å’Œæ•°æ®åº“
3. ç‚¹å‡» "SQL Editor"
4. å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- æ·»åŠ  session_key å­—æ®µ
ALTER TABLE users 
ADD COLUMN IF NOT EXISTS session_key VARCHAR(100);

-- æ·»åŠ  union_id å­—æ®µ
ALTER TABLE users 
ADD COLUMN IF NOT EXISTS union_id VARCHAR(100);

-- ä¸º union_id æ·»åŠ ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_users_union_id ON users(union_id);
```

5. ç‚¹å‡» "Run" æ‰§è¡Œ

### æ–¹å¼äºŒï¼šä½¿ç”¨ SQL æ–‡ä»¶

æ‰§è¡Œé¡¹ç›®ä¸­çš„ `scripts/add-wechat-fields.sql` æ–‡ä»¶ã€‚

---

## âœ… éªŒè¯

æ‰§è¡Œä»¥ä¸‹ SQL éªŒè¯å­—æ®µæ˜¯å¦æ·»åŠ æˆåŠŸï¼š

```sql
SELECT column_name, data_type, is_nullable
FROM information_schema.columns 
WHERE table_name = 'users' 
AND column_name IN ('openid', 'session_key', 'union_id')
ORDER BY column_name;
```

**é¢„æœŸç»“æœ**ï¼š

| column_name | data_type | is_nullable |
|-------------|-----------|-------------|
| openid | character varying | NO |
| session_key | character varying | YES |
| union_id | character varying | YES |

---

## ğŸ“‹ å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `openid` | VARCHAR(100) | å¾®ä¿¡ OpenIDï¼ˆå·²å­˜åœ¨ï¼‰ |
| `session_key` | VARCHAR(100) | å¾®ä¿¡ Session Keyï¼ˆæ–°å¢ï¼‰ |
| `union_id` | VARCHAR(100) | å¾®ä¿¡ UnionIDï¼ˆæ–°å¢ï¼Œå¯é€‰ï¼‰ |

---

## ğŸš€ æ›´æ–°å®Œæˆå

æ‰§è¡Œå®Œ SQL åï¼Œå¾®ä¿¡ç™»å½•åŠŸèƒ½å³å¯æ­£å¸¸ä½¿ç”¨ã€‚

æµ‹è¯•æ¥å£ï¼š
```
POST https://cooktip-backend.vercel.app/api/auth/wechat
```

è¯¦ç»†ä½¿ç”¨æ–¹æ³•è¯·æŸ¥çœ‹ `å¾®ä¿¡ç™»å½•å¼€å‘æ–‡æ¡£.md`ã€‚

---

**åˆ›å»ºæ—¶é—´**: 2025-10-02  
**çŠ¶æ€**: å¾…æ‰§è¡Œ

