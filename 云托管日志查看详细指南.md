# ğŸ” äº‘æ‰˜ç®¡æ—¥å¿—æŸ¥çœ‹è¯¦ç»†æŒ‡å—ï¼ˆè¯Šæ–­ 500 é”™è¯¯ï¼‰

**ç›®çš„**: æŸ¥çœ‹äº‘æ‰˜ç®¡çš„è¯¦ç»†é”™è¯¯æ—¥å¿—ï¼Œå®šä½æœç´¢åŠŸèƒ½ 500 é”™è¯¯çš„æ ¹æœ¬åŸå› 

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

å·²æ·»åŠ çš„å¢å¼ºåŠŸèƒ½ï¼ˆCommit: `ed9231e`ï¼‰ï¼š

1. âœ… **å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨** (`AllExceptionsFilter`)
   - æ•è·æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸
   - è®°å½•å®Œæ•´çš„é”™è¯¯å †æ ˆ
   - è¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

2. âœ… **æ—¥å¿—æ‹¦æˆªå™¨** (`LoggingInterceptor`)
   - è®°å½•æ¯ä¸ªè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯
   - è®°å½•å“åº”æ—¶é—´
   - è®°å½•é”™è¯¯è¯¦æƒ…

3. âœ… **å¢å¼ºçš„æ—¥å¿—çº§åˆ«**
   - `error`, `warn`, `log`, `debug`, `verbose`
   - å®Œæ•´çš„å †æ ˆè·Ÿè¸ª

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šç­‰å¾…éƒ¨ç½²å®Œæˆ

### 1. æ£€æŸ¥éƒ¨ç½²çŠ¶æ€

1. **ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°**
   - è®¿é—®: https://console.cloud.tencent.com/

2. **è¿›å…¥äº‘æ‰˜ç®¡**
   - å·¦ä¾§èœå•: **äº‘äº§å“** â†’ **Serverless** â†’ **äº‘æ‰˜ç®¡**

3. **æŸ¥çœ‹æœåŠ¡çŠ¶æ€**
   - é€‰æ‹©ä½ çš„ç¯å¢ƒï¼ˆå¦‚ `yjsp-ytg`ï¼‰
   - æŸ¥çœ‹æœåŠ¡åˆ—è¡¨
   - æ‰¾åˆ° `CookTip-Backend` æœåŠ¡

4. **ç¡®è®¤éƒ¨ç½²çŠ¶æ€**
   - âœ… **è¿è¡Œä¸­** - ç»¿è‰²ï¼Œå¯ä»¥ç»§ç»­
   - â³ **éƒ¨ç½²ä¸­** - é»„è‰²ï¼Œç­‰å¾… 3-5 åˆ†é’Ÿ
   - âŒ **å¤±è´¥** - çº¢è‰²ï¼ŒæŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

---

## ğŸ“Š ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹å®æ—¶æ—¥å¿—

### æ–¹æ³• Aï¼šé€šè¿‡æ§åˆ¶å°æŸ¥çœ‹ï¼ˆæ¨èï¼‰

#### 1. è¿›å…¥æ—¥å¿—æŸ¥è¯¢

1. **ç‚¹å‡»æœåŠ¡åç§°**
   - è¿›å…¥ `CookTip-Backend` æœåŠ¡è¯¦æƒ…

2. **ç‚¹å‡»"æ—¥å¿—"æ ‡ç­¾é¡µ**
   - åœ¨é¡¶éƒ¨å¯¼èˆªæ æ‰¾åˆ°"æ—¥å¿—"

3. **é€‰æ‹©æ—¥å¿—ç±»å‹**
   - **åº”ç”¨æ—¥å¿—**: æŸ¥çœ‹ä»£ç è¾“å‡ºçš„ console.log/error
   - **è®¿é—®æ—¥å¿—**: æŸ¥çœ‹ HTTP è¯·æ±‚è®°å½•

#### 2. ç­›é€‰é”™è¯¯æ—¥å¿—

**å…³é”®æœç´¢è¯**:
```
[SearchService] Search recipes error
[SearchController] Search error
AllExceptionsFilter
LoggingInterceptor
TypeError
Error:
```

**ç­›é€‰æ¡ä»¶**:
- **æ—¶é—´èŒƒå›´**: æœ€è¿‘ 1 å°æ—¶
- **æ—¥å¿—çº§åˆ«**: ERROR
- **å…³é”®è¯**: ä¸Šè¿°ä»»ä¸€æœç´¢è¯

#### 3. æŸ¥æ‰¾å…·ä½“é”™è¯¯ä¿¡æ¯

**é¢„æœŸçœ‹åˆ°çš„æ—¥å¿—æ ¼å¼**:

```
[LoggingInterceptor] â†’ GET /api/v1/search/recipes?keyword=é¸¡
[SearchController] Received request: {keyword: "é¸¡", page: 1, limit: 10}
[SearchService] Search recipes error: TypeError: Cannot read property 'tags' of undefined
    at SearchService.searchRecipes (/app/dist/modules/search/search.service.js:75:28)
    at SearchController.searchRecipes (/app/dist/modules/search/search.controller.js:45:15)
    ...
[AllExceptionsFilter] [GET] /api/v1/search/recipes?keyword=é¸¡ - Status: 500
```

---

### æ–¹æ³• Bï¼šé€šè¿‡ CLI æŸ¥çœ‹ï¼ˆé«˜çº§ï¼‰

å¦‚æœæ§åˆ¶å°ä¸å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨è…¾è®¯äº‘ CLIï¼š

```bash
# å®‰è£… CLI
npm install -g @cloudbase/cli

# ç™»å½•
tcb login

# æŸ¥çœ‹æ—¥å¿—
tcb fn log <å‡½æ•°å> --limit 100
```

---

## ğŸ” ç¬¬ä¸‰æ­¥ï¼šåˆ†æé”™è¯¯æ—¥å¿—

### å¸¸è§é”™è¯¯æ¨¡å¼

#### 1. **TypeORM æŸ¥è¯¢é”™è¯¯**

```
QueryFailedError: ER_BAD_FIELD_ERROR: Unknown column 'recipe.tags' in 'field list'
```

**åŸå› **: æ•°æ®åº“è¡¨ç»“æ„ä¸ä»£ç ä¸åŒ¹é…

**è§£å†³**: æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦æœ‰ `tags` åˆ—

---

#### 2. **JSON åºåˆ—åŒ–é”™è¯¯**

```
TypeError: Cannot convert undefined or null to object
  at Object.keys (<anonymous>)
  at SearchService.searchRecipes
```

**åŸå› **: JSON å­—æ®µåŒ…å«æ— æ•ˆæ•°æ®

**è§£å†³**: å·²é€šè¿‡æ˜¾å¼ select æ’é™¤ JSON å­—æ®µ

---

#### 3. **æ•°æ®åº“è¿æ¥é”™è¯¯**

```
Error: connect ETIMEDOUT
  at TCPConnectWrap.afterConnect
```

**åŸå› **: æ•°æ®åº“è¿æ¥è¶…æ—¶

**è§£å†³**: æ£€æŸ¥æ•°æ®åº“ç½‘ç»œé…ç½®

---

#### 4. **ç©ºå€¼å¼•ç”¨é”™è¯¯**

```
TypeError: Cannot read property 'nickname' of null
  at SearchService.searchRecipes
```

**åŸå› **: `recipe.user` ä¸º null

**è§£å†³**: å·²æ·»åŠ ç©ºå€¼æ£€æŸ¥

---

## ğŸ“¸ ç¬¬å››æ­¥ï¼šæˆªå›¾å¹¶åé¦ˆ

### éœ€è¦æä¾›çš„ä¿¡æ¯

å¦‚æœè¿˜æ˜¯ 500 é”™è¯¯ï¼Œè¯·æˆªå›¾ä»¥ä¸‹å†…å®¹ï¼š

1. **å®Œæ•´çš„é”™è¯¯å †æ ˆ**
   ```
   [AllExceptionsFilter] [GET] /api/v1/search/recipes?keyword=é¸¡ - Status: 500
   é”™è¯¯è¯¦æƒ…: ...
   å †æ ˆè·Ÿè¸ª: ...
   ```

2. **è¯·æ±‚å‚æ•°**
   ```
   [SearchController] Received request: {
     keyword: "é¸¡",
     page: 1,
     limit: 10
   }
   ```

3. **éƒ¨ç½²çŠ¶æ€**
   - æœåŠ¡çŠ¶æ€: è¿è¡Œä¸­ / éƒ¨ç½²ä¸­ / å¤±è´¥
   - æœ€æ–°éƒ¨ç½²æ—¶é—´
   - Commit ID

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: æ‰¾ä¸åˆ°æ—¥å¿—ï¼Ÿ

**A**: ç¡®è®¤æ—¥å¿—æŸ¥è¯¢çš„æ—¶é—´èŒƒå›´
- æ‰©å¤§æ—¶é—´èŒƒå›´åˆ°"æœ€è¿‘ 24 å°æ—¶"
- æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
- å°è¯•åˆ·æ–°é¡µé¢

### Q2: æ—¥å¿—å¤ªå¤šï¼Œçœ‹ä¸è¿‡æ¥ï¼Ÿ

**A**: ä½¿ç”¨å…³é”®è¯è¿‡æ»¤
```
é”™è¯¯å…³é”®è¯: error OR Error OR Exception OR failed
æœç´¢å…³é”®è¯: SearchService OR SearchController
```

### Q3: éƒ¨ç½²ä¸€ç›´å¤„äº"éƒ¨ç½²ä¸­"çŠ¶æ€ï¼Ÿ

**A**: å¯èƒ½çš„åŸå› 
1. Docker é•œåƒæ„å»ºå¤±è´¥
2. èµ„æºä¸è¶³
3. ç½‘ç»œé—®é¢˜

**è§£å†³**: æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ï¼Œæ£€æŸ¥æ„å»ºå¤±è´¥åŸå› 

---

## ğŸ¯ æµ‹è¯•æ–°çš„æ—¥å¿—åŠŸèƒ½

### æµ‹è¯•ç«¯ç‚¹

è®¿é—®ä»¥ä¸‹æµ‹è¯•ç«¯ç‚¹ç¡®è®¤æœåŠ¡æ­£å¸¸ï¼š

```
GET https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/search/test
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "Search service is running",
  "data": {
    "timestamp": "2025-10-30T...",
    "service": "healthy"
  }
}
```

### æµ‹è¯•æœç´¢

```
GET https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/search/recipes?keyword=é¸¡
```

**æ£€æŸ¥æ—¥å¿—**:
```
[LoggingInterceptor] â†’ GET /api/v1/search/recipes?keyword=é¸¡
[SearchController] Received request: {...}
[SearchService] Search recipes...
[LoggingInterceptor] â† GET /api/v1/search/recipes 200 - 150ms
```

---

## ğŸ“‹ æ“ä½œæ¸…å•

- [ ] 1. ç­‰å¾…äº‘æ‰˜ç®¡éƒ¨ç½²å®Œæˆï¼ˆ3-5 åˆ†é’Ÿï¼‰
- [ ] 2. è¿›å…¥äº‘æ‰˜ç®¡æ§åˆ¶å°
- [ ] 3. æ‰“å¼€æ—¥å¿—æŸ¥è¯¢é¡µé¢
- [ ] 4. ç­›é€‰é”™è¯¯æ—¥å¿—ï¼ˆå…³é”®è¯: `SearchService`, `error`ï¼‰
- [ ] 5. æµ‹è¯•æœç´¢ç«¯ç‚¹
- [ ] 6. æˆªå›¾å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
- [ ] 7. åé¦ˆé”™è¯¯æ—¥å¿—

---

## ğŸ”„ ä¸‹ä¸€æ­¥

**å¦‚æœä»ç„¶ 500 é”™è¯¯**ï¼Œè¯·æä¾›ï¼š

1. ğŸ“¸ äº‘æ‰˜ç®¡æ—¥å¿—æˆªå›¾ï¼ˆå®Œæ•´çš„é”™è¯¯å †æ ˆï¼‰
2. ğŸ–¥ï¸ æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
3. ğŸ” æœç´¢å…³é”®è¯
4. â° æµ‹è¯•æ—¶é—´

æˆ‘ä¼šæ ¹æ®è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ç»§ç»­æ·±åº¦è°ƒè¯•ï¼

---

**ç­‰å¾… 3-5 åˆ†é’Ÿåï¼Œè¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æŸ¥çœ‹æ—¥å¿—ï¼** ğŸ”

