# é£Ÿè°±å°é¢æ¥å£å¯¹æ¥æ–‡æ¡£

> ğŸ“… æ›´æ–°æ—¶é—´ï¼š2025-10-08  
> ğŸŒ API åŸºç¡€åœ°å€ï¼š`https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1`  
> ğŸ“š åœ¨çº¿æ–‡æ¡£ï¼š`https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/docs`

---

## ğŸ“‹ ç›®å½•

- [1. åŠŸèƒ½è¯´æ˜](#1-åŠŸèƒ½è¯´æ˜)
- [2. ä¸Šä¼ å°é¢å›¾ç‰‡](#2-ä¸Šä¼ å°é¢å›¾ç‰‡)
- [3. åˆ›å»ºé£Ÿè°±æ—¶è®¾ç½®å°é¢](#3-åˆ›å»ºé£Ÿè°±æ—¶è®¾ç½®å°é¢)
- [4. æ›´æ–°é£Ÿè°±å°é¢](#4-æ›´æ–°é£Ÿè°±å°é¢)
- [5. è·å–é£Ÿè°±å°é¢](#5-è·å–é£Ÿè°±å°é¢)
- [6. å®Œæ•´ç¤ºä¾‹ä»£ç ](#6-å®Œæ•´ç¤ºä¾‹ä»£ç )
- [7. å¸¸è§é—®é¢˜](#7-å¸¸è§é—®é¢˜)

---

## 1. åŠŸèƒ½è¯´æ˜

### 1.1 å°é¢å­—æ®µ

æ¯ä¸ªé£Ÿè°±éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ **`cover_image`** å­—æ®µç”¨äºå­˜å‚¨å°é¢å›¾ç‰‡URLã€‚

**å­—æ®µè¯´æ˜**ï¼š
- **å­—æ®µå**ï¼š`cover_image`
- **ç±»å‹**ï¼šå­—ç¬¦ä¸²ï¼ˆURLï¼‰
- **æ˜¯å¦å¿…å¡«**ï¼šå¦ï¼ˆå¯é€‰ï¼Œä½†å¼ºçƒˆæ¨èï¼‰
- **æœ€å¤§é•¿åº¦**ï¼š255 å­—ç¬¦
- **ç¤ºä¾‹å€¼**ï¼š`"https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/recipe-cover-123.jpg"`

### 1.2 ä½¿ç”¨æµç¨‹

```
æ­¥éª¤1: ç”¨æˆ·é€‰æ‹©å›¾ç‰‡
  â†“
æ­¥éª¤2: ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨ (POST /upload/image)
  â†“
æ­¥éª¤3: è·å–å›¾ç‰‡URL
  â†“
æ­¥éª¤4: åˆ›å»º/æ›´æ–°é£Ÿè°±æ—¶ä¼ å…¥URL (POST/PUT /recipes)
  â†“
æ­¥éª¤5: åˆ—è¡¨/è¯¦æƒ…æ¥å£è¿”å›å°é¢URL
```

---

## 2. ä¸Šä¼ å°é¢å›¾ç‰‡

### 2.1 æ¥å£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ¥å£åœ°å€** | `POST /upload/image` |
| **å®Œæ•´URL** | `https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/upload/image` |
| **è¯·æ±‚æ–¹å¼** | `POST` |
| **Content-Type** | `multipart/form-data` |
| **æ˜¯å¦éœ€è¦è®¤è¯** | âœ… æ˜¯ï¼ˆéœ€è¦ Tokenï¼‰ |

### 2.2 è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|--------|------|---------|------|
| `file` | File | æ˜¯ | å›¾ç‰‡æ–‡ä»¶ |

**è¯·æ±‚å¤´**ï¼š
```http
Authorization: Bearer {access_token}
Content-Type: multipart/form-data
```

### 2.3 æ–‡ä»¶é™åˆ¶

| é™åˆ¶é¡¹ | è¯´æ˜ |
|--------|------|
| **æ”¯æŒæ ¼å¼** | JPGã€JPEGã€PNGã€GIFã€WebP |
| **æ–‡ä»¶å¤§å°** | æœ€å¤§ 5MB |
| **å»ºè®®å°ºå¯¸** | å®½åº¦ 750px - 1200pxï¼Œé«˜åº¦ 500px - 800px |
| **å»ºè®®æ¯”ä¾‹** | 3:2 æˆ– 4:3 |

### 2.4 å“åº”æ•°æ®

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "url": "https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/recipe-cover-1234567890.jpg",
    "filename": "recipe-cover-1234567890.jpg",
    "size": 102400,
    "mimetype": "image/jpeg"
  }
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "code": 400,
  "message": "æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶",
  "error": "æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 5MB"
}
```

### 2.5 å°ç¨‹åºç¤ºä¾‹ä»£ç 

```javascript
/**
 * ä¸Šä¼ é£Ÿè°±å°é¢å›¾ç‰‡
 */
uploadCoverImage() {
  // 1. é€‰æ‹©å›¾ç‰‡
  wx.chooseImage({
    count: 1,                      // åªé€‰æ‹©1å¼ 
    sizeType: ['compressed'],      // ä½¿ç”¨å‹ç¼©å›¾
    sourceType: ['album', 'camera'], // å¯ä»ç›¸å†Œæˆ–ç›¸æœºé€‰æ‹©
    success: (res) => {
      const tempFilePath = res.tempFilePaths[0];
      
      // 2. ä¸Šä¼ å›¾ç‰‡
      this.uploadToServer(tempFilePath);
    },
    fail: (err) => {
      console.error('é€‰æ‹©å›¾ç‰‡å¤±è´¥:', err);
      wx.showToast({
        title: 'é€‰æ‹©å›¾ç‰‡å¤±è´¥',
        icon: 'none'
      });
    }
  });
},

/**
 * ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨
 */
uploadToServer(filePath) {
  wx.showLoading({
    title: 'ä¸Šä¼ å°é¢ä¸­...',
    mask: true
  });
  
  wx.uploadFile({
    url: 'https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/upload/image',
    filePath: filePath,
    name: 'file',  // å¿…é¡»æ˜¯ 'file'
    header: {
      'Authorization': `Bearer ${wx.getStorageSync('cooktip_token')}`
    },
    success: (res) => {
      wx.hideLoading();
      
      try {
        const data = JSON.parse(res.data);
        
        if (data.code === 200) {
          // ä¸Šä¼ æˆåŠŸï¼Œä¿å­˜å°é¢URL
          const coverImageUrl = data.data.url;
          
          this.setData({
            coverImage: coverImageUrl
          });
          
          wx.showToast({
            title: 'å°é¢ä¸Šä¼ æˆåŠŸ',
            icon: 'success'
          });
          
          console.log('å°é¢URL:', coverImageUrl);
        } else {
          wx.showToast({
            title: data.message || 'ä¸Šä¼ å¤±è´¥',
            icon: 'none'
          });
        }
      } catch (error) {
        console.error('è§£æå“åº”å¤±è´¥:', error);
        wx.showToast({
          title: 'ä¸Šä¼ å¤±è´¥',
          icon: 'none'
        });
      }
    },
    fail: (err) => {
      wx.hideLoading();
      console.error('ä¸Šä¼ å¤±è´¥:', err);
      wx.showToast({
        title: 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•',
        icon: 'none'
      });
    }
  });
}
```

---

## 3. åˆ›å»ºé£Ÿè°±æ—¶è®¾ç½®å°é¢

### 3.1 æ¥å£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ¥å£åœ°å€** | `POST /recipes` |
| **å®Œæ•´URL** | `https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/recipes` |
| **è¯·æ±‚æ–¹å¼** | `POST` |
| **Content-Type** | `application/json` |
| **æ˜¯å¦éœ€è¦è®¤è¯** | âœ… æ˜¯ï¼ˆéœ€è¦ Tokenï¼‰ |

### 3.2 è¯·æ±‚å‚æ•°

```json
{
  "title": "çº¢çƒ§è‚‰",
  "cover_image": "https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/cover-123.jpg",
  "description": "ç¾å‘³çš„çº¢çƒ§è‚‰ï¼Œè‚¥è€Œä¸è…»",
  "difficulty": "ç®€å•",
  "cook_time": 60,
  "servings": 4,
  "ingredients": [
    { "name": "äº”èŠ±è‚‰", "amount": "500g" },
    { "name": "å†°ç³–", "amount": "30g" }
  ],
  "steps": [
    { "order": 1, "content": "å°†äº”èŠ±è‚‰åˆ‡å—", "image": null },
    { "order": 2, "content": "ç„¯æ°´å»è…¥", "image": null }
  ],
  "category_id": 1
}
```

**å…³é”®å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `title` | string | âœ… æ˜¯ | é£Ÿè°±æ ‡é¢˜ | "çº¢çƒ§è‚‰" |
| `cover_image` | string | â­ æ¨è | å°é¢å›¾ç‰‡URL | "https://..." |
| `description` | string | å¦ | é£Ÿè°±ç®€ä»‹ | "ç¾å‘³çš„çº¢çƒ§è‚‰" |
| `difficulty` | string | å¦ | éš¾åº¦ï¼ˆè¶…ç®€å•/ç®€å•/ä¸­ç­‰/å›°éš¾ï¼‰ | "ç®€å•" |
| `cook_time` | number | å¦ | çƒ¹é¥ªæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ | 60 |
| `servings` | number | å¦ | ä»½é‡ | 4 |
| `ingredients` | array | å¦ | é£Ÿæåˆ—è¡¨ | [...] |
| `steps` | array | å¦ | æ­¥éª¤åˆ—è¡¨ | [...] |
| `category_id` | number | å¦ | åˆ†ç±»ID | 1 |

### 3.3 å“åº”æ•°æ®

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "title": "çº¢çƒ§è‚‰",
    "cover_image": "https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/cover-123.jpg",
    "description": "ç¾å‘³çš„çº¢çƒ§è‚‰ï¼Œè‚¥è€Œä¸è…»",
    "difficulty": "ç®€å•",
    "cook_time": 60,
    "servings": 4,
    "likeCount": 0,
    "commentCount": 0,
    "viewCount": 0,
    "createdAt": "2025-10-08T12:00:00.000Z"
  }
}
```

### 3.4 å°ç¨‹åºç¤ºä¾‹ä»£ç 

```javascript
const request = require('../../utils/request');

/**
 * å‘å¸ƒé£Ÿè°±ï¼ˆåŒ…å«å°é¢ï¼‰
 */
async publishRecipe() {
  // 1. éªŒè¯å°é¢æ˜¯å¦å·²ä¸Šä¼ 
  if (!this.data.coverImage) {
    wx.showToast({
      title: 'è¯·å…ˆä¸Šä¼ å°é¢å›¾ç‰‡',
      icon: 'none'
    });
    return;
  }
  
  // 2. éªŒè¯æ ‡é¢˜
  if (!this.data.title || !this.data.title.trim()) {
    wx.showToast({
      title: 'è¯·è¾“å…¥é£Ÿè°±æ ‡é¢˜',
      icon: 'none'
    });
    return;
  }
  
  wx.showLoading({
    title: 'å‘å¸ƒä¸­...',
    mask: true
  });
  
  try {
    // 3. å‘é€è¯·æ±‚
    const recipe = await request({
      url: '/recipes',
      method: 'POST',
      data: {
        title: this.data.title,
        cover_image: this.data.coverImage,  // â† ä¼ å…¥å°é¢URL
        description: this.data.description,
        difficulty: this.data.difficulty,
        cook_time: this.data.cookTime,
        servings: this.data.servings,
        ingredients: this.data.ingredients,
        steps: this.data.steps,
        category_id: this.data.categoryId
      }
    });
    
    wx.hideLoading();
    
    wx.showToast({
      title: 'å‘å¸ƒæˆåŠŸ',
      icon: 'success',
      duration: 2000
    });
    
    // 4. è·³è½¬åˆ°è¯¦æƒ…é¡µ
    setTimeout(() => {
      wx.redirectTo({
        url: `/pages/recipe-detail/recipe-detail?id=${recipe.id}`
      });
    }, 2000);
    
  } catch (error) {
    wx.hideLoading();
    console.error('å‘å¸ƒé£Ÿè°±å¤±è´¥:', error);
    
    wx.showModal({
      title: 'å‘å¸ƒå¤±è´¥',
      content: error.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•',
      showCancel: false
    });
  }
}
```

---

## 4. æ›´æ–°é£Ÿè°±å°é¢

### 4.1 æ¥å£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ¥å£åœ°å€** | `PUT /recipes/:id` |
| **å®Œæ•´URL** | `https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/recipes/{id}` |
| **è¯·æ±‚æ–¹å¼** | `PUT` |
| **Content-Type** | `application/json` |
| **æ˜¯å¦éœ€è¦è®¤è¯** | âœ… æ˜¯ï¼ˆéœ€è¦ Tokenï¼Œä¸”å¿…é¡»æ˜¯ä½œè€…æœ¬äººï¼‰ |

### 4.2 è¯·æ±‚å‚æ•°

```json
{
  "cover_image": "https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/new-cover.jpg"
}
```

**è¯´æ˜**ï¼šåªéœ€è¦ä¼ å…¥è¦æ›´æ–°çš„å­—æ®µï¼Œå…¶ä»–å­—æ®µä¿æŒä¸å˜ã€‚

### 4.3 å°ç¨‹åºç¤ºä¾‹ä»£ç 

```javascript
/**
 * æ›´æ–°é£Ÿè°±å°é¢
 */
async updateCover(recipeId) {
  // 1. ä¸Šä¼ æ–°å°é¢
  wx.chooseImage({
    count: 1,
    sizeType: ['compressed'],
    sourceType: ['album', 'camera'],
    success: async (res) => {
      const tempFilePath = res.tempFilePaths[0];
      
      wx.showLoading({ title: 'ä¸Šä¼ ä¸­...' });
      
      // 2. ä¸Šä¼ å›¾ç‰‡
      wx.uploadFile({
        url: 'https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/upload/image',
        filePath: tempFilePath,
        name: 'file',
        header: {
          'Authorization': `Bearer ${wx.getStorageSync('cooktip_token')}`
        },
        success: async (uploadRes) => {
          const uploadData = JSON.parse(uploadRes.data);
          
          if (uploadData.code === 200) {
            const newCoverUrl = uploadData.data.url;
            
            try {
              // 3. æ›´æ–°é£Ÿè°±å°é¢
              await request({
                url: `/recipes/${recipeId}`,
                method: 'PUT',
                data: {
                  cover_image: newCoverUrl
                }
              });
              
              wx.hideLoading();
              
              wx.showToast({
                title: 'å°é¢æ›´æ–°æˆåŠŸ',
                icon: 'success'
              });
              
              // 4. æ›´æ–°é¡µé¢æ˜¾ç¤º
              this.setData({
                'recipe.cover_image': newCoverUrl
              });
              
            } catch (error) {
              wx.hideLoading();
              console.error('æ›´æ–°å°é¢å¤±è´¥:', error);
              wx.showToast({
                title: 'æ›´æ–°å¤±è´¥',
                icon: 'none'
              });
            }
          }
        }
      });
    }
  });
}
```

---

## 5. è·å–é£Ÿè°±å°é¢

### 5.1 è·å–é£Ÿè°±åˆ—è¡¨

**æ¥å£åœ°å€**ï¼š`GET /recipes`

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "çº¢çƒ§è‚‰",
        "cover_image": "https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/cover-123.jpg",
        "description": "ç¾å‘³çš„çº¢çƒ§è‚‰",
        "likeCount": 100,
        "viewCount": 500
      },
      {
        "id": 2,
        "title": "ç³–é†‹æ’éª¨",
        "cover_image": "https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/cover-456.jpg",
        "description": "é…¸ç”œå¯å£çš„æ’éª¨",
        "likeCount": 80,
        "viewCount": 300
      }
    ],
    "total": 50,
    "page": 1,
    "limit": 10
  }
}
```

### 5.2 è·å–é£Ÿè°±è¯¦æƒ…

**æ¥å£åœ°å€**ï¼š`GET /recipes/:id`

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "title": "çº¢çƒ§è‚‰",
    "cover_image": "https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/uploads/cover-123.jpg",
    "description": "ç¾å‘³çš„çº¢çƒ§è‚‰ï¼Œè‚¥è€Œä¸è…»",
    "difficulty": "ç®€å•",
    "cook_time": 60,
    "servings": 4,
    "ingredients": [...],
    "steps": [...]
  }
}
```

### 5.3 å°ç¨‹åºæ˜¾ç¤ºå°é¢

**WXML**ï¼š
```xml
<!-- é£Ÿè°±åˆ—è¡¨ -->
<view class="recipe-list">
  <view 
    class="recipe-item" 
    wx:for="{{recipes}}" 
    wx:key="id"
    bindtap="goToDetail"
    data-id="{{item.id}}"
  >
    <!-- å°é¢å›¾ç‰‡ -->
    <image 
      class="recipe-cover" 
      src="{{item.cover_image}}" 
      mode="aspectFill"
      lazy-load="{{true}}"
    />
    
    <view class="recipe-info">
      <text class="recipe-title">{{item.title}}</text>
      <text class="recipe-desc">{{item.description}}</text>
      
      <view class="recipe-stats">
        <text>ğŸ‘ {{item.likeCount}}</text>
        <text>ğŸ‘ {{item.viewCount}}</text>
      </view>
    </view>
  </view>
</view>
```

**WXSS**ï¼š
```css
.recipe-item {
  display: flex;
  margin-bottom: 20rpx;
  background: #fff;
  border-radius: 16rpx;
  overflow: hidden;
}

.recipe-cover {
  width: 240rpx;
  height: 180rpx;
  flex-shrink: 0;
}

.recipe-info {
  flex: 1;
  padding: 20rpx;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.recipe-title {
  font-size: 32rpx;
  font-weight: 600;
  color: #333;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.recipe-desc {
  font-size: 24rpx;
  color: #999;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.recipe-stats {
  display: flex;
  gap: 20rpx;
  font-size: 24rpx;
  color: #666;
}
```

---

## 6. å®Œæ•´ç¤ºä¾‹ä»£ç 

### 6.1 å‘å¸ƒé¡µé¢å®Œæ•´ä»£ç 

```javascript
// pages/publish/publish.js
const request = require('../../utils/request');

Page({
  data: {
    // è¡¨å•æ•°æ®
    coverImage: '',           // å°é¢URL
    title: '',                // æ ‡é¢˜
    description: '',          // ç®€ä»‹
    difficulty: 'ç®€å•',       // éš¾åº¦
    cookTime: 30,            // çƒ¹é¥ªæ—¶é—´
    servings: 2,             // ä»½é‡
    ingredients: [],         // é£Ÿæ
    steps: [],               // æ­¥éª¤
    categoryId: null,        // åˆ†ç±»
    
    // éš¾åº¦é€‰é¡¹
    difficultyOptions: ['è¶…ç®€å•', 'ç®€å•', 'ä¸­ç­‰', 'å›°éš¾']
  },
  
  /**
   * é€‰æ‹©å°é¢
   */
  chooseCover() {
    wx.chooseImage({
      count: 1,
      sizeType: ['compressed'],
      sourceType: ['album', 'camera'],
      success: (res) => {
        this.uploadCover(res.tempFilePaths[0]);
      }
    });
  },
  
  /**
   * ä¸Šä¼ å°é¢
   */
  uploadCover(filePath) {
    wx.showLoading({ title: 'ä¸Šä¼ å°é¢ä¸­...', mask: true });
    
    wx.uploadFile({
      url: 'https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/upload/image',
      filePath: filePath,
      name: 'file',
      header: {
        'Authorization': `Bearer ${wx.getStorageSync('cooktip_token')}`
      },
      success: (res) => {
        wx.hideLoading();
        
        try {
          const data = JSON.parse(res.data);
          
          if (data.code === 200) {
            this.setData({
              coverImage: data.data.url
            });
            
            wx.showToast({
              title: 'å°é¢ä¸Šä¼ æˆåŠŸ',
              icon: 'success'
            });
          } else {
            wx.showToast({
              title: data.message || 'ä¸Šä¼ å¤±è´¥',
              icon: 'none'
            });
          }
        } catch (error) {
          console.error('è§£æå¤±è´¥:', error);
          wx.showToast({
            title: 'ä¸Šä¼ å¤±è´¥',
            icon: 'none'
          });
        }
      },
      fail: (err) => {
        wx.hideLoading();
        console.error('ä¸Šä¼ å¤±è´¥:', err);
        wx.showToast({
          title: 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•',
          icon: 'none'
        });
      }
    });
  },
  
  /**
   * è¡¨å•è¾“å…¥
   */
  onTitleInput(e) {
    this.setData({ title: e.detail.value });
  },
  
  onDescInput(e) {
    this.setData({ description: e.detail.value });
  },
  
  onDifficultyChange(e) {
    this.setData({ 
      difficulty: this.data.difficultyOptions[e.detail.value] 
    });
  },
  
  onCookTimeChange(e) {
    this.setData({ cookTime: parseInt(e.detail.value) });
  },
  
  onServingsChange(e) {
    this.setData({ servings: parseInt(e.detail.value) });
  },
  
  /**
   * å‘å¸ƒé£Ÿè°±
   */
  async publishRecipe() {
    // éªŒè¯å¿…å¡«é¡¹
    if (!this.data.coverImage) {
      wx.showToast({
        title: 'è¯·ä¸Šä¼ å°é¢å›¾ç‰‡',
        icon: 'none'
      });
      return;
    }
    
    if (!this.data.title || !this.data.title.trim()) {
      wx.showToast({
        title: 'è¯·è¾“å…¥é£Ÿè°±æ ‡é¢˜',
        icon: 'none'
      });
      return;
    }
    
    wx.showLoading({ title: 'å‘å¸ƒä¸­...', mask: true });
    
    try {
      const recipe = await request({
        url: '/recipes',
        method: 'POST',
        data: {
          title: this.data.title,
          cover_image: this.data.coverImage,
          description: this.data.description,
          difficulty: this.data.difficulty,
          cook_time: this.data.cookTime,
          servings: this.data.servings,
          ingredients: this.data.ingredients,
          steps: this.data.steps,
          category_id: this.data.categoryId
        }
      });
      
      wx.hideLoading();
      
      wx.showToast({
        title: 'å‘å¸ƒæˆåŠŸ',
        icon: 'success',
        duration: 2000
      });
      
      // è·³è½¬åˆ°è¯¦æƒ…é¡µ
      setTimeout(() => {
        wx.redirectTo({
          url: `/pages/recipe-detail/recipe-detail?id=${recipe.id}`
        });
      }, 2000);
      
    } catch (error) {
      wx.hideLoading();
      console.error('å‘å¸ƒå¤±è´¥:', error);
      
      wx.showModal({
        title: 'å‘å¸ƒå¤±è´¥',
        content: error.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•',
        showCancel: false
      });
    }
  }
});
```

### 6.2 å‘å¸ƒé¡µé¢ WXML

```xml
<!-- pages/publish/publish.wxml -->
<view class="container">
  <view class="form">
    <!-- å°é¢ -->
    <view class="form-item">
      <text class="label">å°é¢å›¾ç‰‡ *</text>
      <view class="cover-upload" bindtap="chooseCover">
        <image 
          wx:if="{{coverImage}}" 
          class="cover-preview" 
          src="{{coverImage}}" 
          mode="aspectFill"
        />
        <view wx:else class="upload-placeholder">
          <text class="icon">ğŸ“·</text>
          <text class="text">ç‚¹å‡»ä¸Šä¼ å°é¢</text>
        </view>
      </view>
    </view>
    
    <!-- æ ‡é¢˜ -->
    <view class="form-item">
      <text class="label">æ ‡é¢˜ *</text>
      <input 
        class="input" 
        placeholder="è¯·è¾“å…¥é£Ÿè°±æ ‡é¢˜" 
        value="{{title}}"
        bindinput="onTitleInput"
        maxlength="50"
      />
    </view>
    
    <!-- ç®€ä»‹ -->
    <view class="form-item">
      <text class="label">ç®€ä»‹</text>
      <textarea 
        class="textarea" 
        placeholder="è¯·è¾“å…¥é£Ÿè°±ç®€ä»‹" 
        value="{{description}}"
        bindinput="onDescInput"
        maxlength="200"
      />
    </view>
    
    <!-- éš¾åº¦ -->
    <view class="form-item">
      <text class="label">éš¾åº¦</text>
      <picker 
        mode="selector" 
        range="{{difficultyOptions}}"
        bindchange="onDifficultyChange"
      >
        <view class="picker">{{difficulty}}</view>
      </picker>
    </view>
    
    <!-- çƒ¹é¥ªæ—¶é—´ -->
    <view class="form-item">
      <text class="label">çƒ¹é¥ªæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</text>
      <input 
        class="input" 
        type="number" 
        value="{{cookTime}}"
        bindinput="onCookTimeChange"
      />
    </view>
    
    <!-- ä»½é‡ -->
    <view class="form-item">
      <text class="label">ä»½é‡ï¼ˆäººï¼‰</text>
      <input 
        class="input" 
        type="number" 
        value="{{servings}}"
        bindinput="onServingsChange"
      />
    </view>
  </view>
  
  <!-- å‘å¸ƒæŒ‰é’® -->
  <button class="publish-btn" bindtap="publishRecipe">
    å‘å¸ƒé£Ÿè°±
  </button>
</view>
```

---

## 7. å¸¸è§é—®é¢˜

### Q1: å°é¢å¿…é¡»ä¸Šä¼ å—ï¼Ÿ

**A**: å°é¢ä¸æ˜¯å¿…å¡«å­—æ®µï¼Œä½†å¼ºçƒˆå»ºè®®ä¸Šä¼ ã€‚æœ‰å°é¢çš„é£Ÿè°±åœ¨åˆ—è¡¨ä¸­æ›´å¸å¼•ç”¨æˆ·ç‚¹å‡»ã€‚

### Q2: æ”¯æŒå“ªäº›å›¾ç‰‡æ ¼å¼ï¼Ÿ

**A**: æ”¯æŒ JPGã€JPEGã€PNGã€GIFã€WebP æ ¼å¼ã€‚

### Q3: å›¾ç‰‡å¤§å°æœ‰é™åˆ¶å—ï¼Ÿ

**A**: å•ä¸ªå›¾ç‰‡æœ€å¤§ 5MBã€‚å»ºè®®ä¸Šä¼ å‰è¿›è¡Œå‹ç¼©ï¼Œå°ç¨‹åºé€‰æ‹©å›¾ç‰‡æ—¶ä½¿ç”¨ `sizeType: ['compressed']`ã€‚

### Q4: æ¨èçš„å°é¢å°ºå¯¸æ˜¯å¤šå°‘ï¼Ÿ

**A**: 
- **å®½åº¦**ï¼š750px - 1200px
- **é«˜åº¦**ï¼š500px - 800px
- **æ¯”ä¾‹**ï¼š3:2 æˆ– 4:3
- **æ ¼å¼**ï¼šJPGï¼ˆå‹ç¼©åæ–‡ä»¶è¾ƒå°ï¼‰

### Q5: ä¸Šä¼ å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: å¸¸è§åŸå› ï¼š
1. æ–‡ä»¶å¤§å°è¶…è¿‡ 5MB â†’ å‹ç¼©å›¾ç‰‡
2. Token è¿‡æœŸ â†’ é‡æ–°ç™»å½•
3. ç½‘ç»œé—®é¢˜ â†’ æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ â†’ ä½¿ç”¨ JPG/PNG æ ¼å¼

### Q6: å¯ä»¥ä¸ä¸Šä¼ å°é¢ï¼Œåç»­å†è¡¥å……å—ï¼Ÿ

**A**: å¯ä»¥ã€‚åˆ›å»ºé£Ÿè°±æ—¶ä¸ä¼  `cover_image`ï¼Œåç»­é€šè¿‡ `PUT /recipes/:id` æ¥å£æ›´æ–°ã€‚

### Q7: å°é¢å¯ä»¥æ›´æ¢å—ï¼Ÿ

**A**: å¯ä»¥ã€‚ä½¿ç”¨ `PUT /recipes/:id` æ¥å£ï¼Œä¼ å…¥æ–°çš„ `cover_image` URLã€‚

### Q8: å¦‚ä½•å¤„ç†å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Ÿ

**A**: ä½¿ç”¨å°ç¨‹åº `image` ç»„ä»¶çš„ `binderror` äº‹ä»¶ï¼š

```xml
<image 
  src="{{item.cover_image}}" 
  binderror="onImageError"
  data-id="{{item.id}}"
/>
```

```javascript
onImageError(e) {
  const id = e.currentTarget.dataset.id;
  const index = this.data.recipes.findIndex(r => r.id === id);
  
  if (index !== -1) {
    // ä½¿ç”¨é»˜è®¤å›¾ç‰‡
    this.setData({
      [`recipes[${index}].cover_image`]: '/images/default-cover.png'
    });
  }
}
```

### Q9: å¦‚ä½•ä¼˜åŒ–å›¾ç‰‡åŠ è½½æ€§èƒ½ï¼Ÿ

**A**: 
1. ä½¿ç”¨ `lazy-load` å±æ€§æ‡’åŠ è½½
2. ä½¿ç”¨ `mode="aspectFill"` ä¿æŒæ¯”ä¾‹
3. åˆ—è¡¨ä¸­ä½¿ç”¨ç¼©ç•¥å›¾
4. å¯ç”¨ CDN åŠ é€Ÿ

```xml
<image 
  src="{{item.cover_image}}" 
  mode="aspectFill"
  lazy-load="{{true}}"
  show-menu-by-longpress="{{true}}"
/>
```

### Q10: å¾®ä¿¡æœåŠ¡å™¨åŸŸåå¦‚ä½•é…ç½®ï¼Ÿ

**A**: åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®ä»¥ä¸‹åŸŸåï¼š

**uploadFile åˆæ³•åŸŸå**ï¼š
```
https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com
```

**request åˆæ³•åŸŸå**ï¼š
```
https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com
```

**é…ç½®è·¯å¾„**ï¼š
`å¾®ä¿¡å…¬ä¼—å¹³å° â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ æœåŠ¡å™¨åŸŸå`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- **é‚®ç®±**ï¼š3509204288@qq.com
- **åœ¨çº¿æ–‡æ¡£**ï¼šhttps://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/docs
- **GitHub**ï¼šhttps://github.com/David07aa/CookTip-Backend

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0.0  
**æ›´æ–°æ—¶é—´**ï¼š2025-10-08

