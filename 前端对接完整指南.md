# ğŸ¯ å‰ç«¯å¯¹æ¥å®Œæ•´æŒ‡å—

## âœ… å·²å®Œæˆçš„åç«¯ä¼˜åŒ–

### 1. CORS é…ç½®å…¨é¢å‡çº§ âœ…

**æ›´æ–°å†…å®¹:**
- âœ… æ›´æ–° `vercel.json` æ·»åŠ å®Œæ•´çš„ CORS é…ç½®
- âœ… åˆ›å»ºç»Ÿä¸€çš„ CORS ä¸­é—´ä»¶ `middleware/cors.js`
- âœ… æ·»åŠ é¢„æ£€è¯·æ±‚ (OPTIONS) å¤„ç†
- âœ… æ”¯æŒæ‰€æœ‰å¿…è¦çš„è¯·æ±‚å¤´

**å…³é”®é…ç½®:**
```json
{
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "GET,OPTIONS,PATCH,DELETE,POST,PUT",
  "Access-Control-Allow-Headers": "X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"
}
```

### 2. ä»£ç å·²éƒ¨ç½² âœ…

- âœ… æ¨é€åˆ° GitHub: `c8f26ee`
- âœ… Vercel è‡ªåŠ¨éƒ¨ç½²ä¸­ (é€šå¸¸éœ€è¦ 2-3 åˆ†é’Ÿ)
- âœ… éƒ¨ç½²å®Œæˆå CORS é—®é¢˜åº”è¯¥è§£å†³

---

## ğŸ“± å‰ç«¯é…ç½®æ­¥éª¤

### æ­¥éª¤ 1: é…ç½®å¾®ä¿¡å°ç¨‹åºæœåŠ¡å™¨åŸŸå

**å¿…é¡»é…ç½®ï¼Œå¦åˆ™çº¿ä¸Šç‰ˆæœ¬æ— æ³•ä½¿ç”¨ï¼**

1. ç™»å½• [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
2. è¿›å…¥: å¼€å‘ -> å¼€å‘ç®¡ç† -> å¼€å‘è®¾ç½® -> æœåŠ¡å™¨åŸŸå
3. æ·»åŠ ä»¥ä¸‹åŸŸå:

```
requeståˆæ³•åŸŸå:
https://cooktip-backend.vercel.app
```

**æ³¨æ„äº‹é¡¹:**
- åŸŸåå¿…é¡»æ˜¯ HTTPS
- ä¸èƒ½åŒ…å«ç«¯å£å·
- ä¸èƒ½æ˜¯ IP åœ°å€
- éœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿç”Ÿæ•ˆ

### æ­¥éª¤ 2: å¼€å‘å·¥å…·ä¸´æ—¶é…ç½®ï¼ˆä»…å¼€å‘æ—¶ï¼‰

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­:

1. æ‰“å¼€é¡¹ç›®
2. ç‚¹å‡»å³ä¸Šè§’ "è¯¦æƒ…"
3. å‹¾é€‰: **"ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLS ç‰ˆæœ¬ä»¥åŠ HTTPS è¯ä¹¦"**

âš ï¸ **æ³¨æ„**: è¿™ä¸ªè®¾ç½®åªåœ¨å¼€å‘æ—¶æœ‰æ•ˆï¼Œæ­£å¼å‘å¸ƒå¿…é¡»é…ç½®æœåŠ¡å™¨åŸŸåï¼

### æ­¥éª¤ 3: æ£€æŸ¥å‰ç«¯ä»£ç é…ç½®

#### æ­£ç¡®çš„è¯·æ±‚æ–¹å¼ âœ…

```javascript
// utils/api.js æˆ– config.js
const BASE_URL = 'https://cooktip-backend.vercel.app'; // âœ… æ­£ç¡®

// è¯·æ±‚ç¤ºä¾‹
wx.request({
  url: `${BASE_URL}/api/categories`,  // âœ… æ­£ç¡®
  method: 'GET',
  success: (res) => {
    console.log(res.data);
  },
  fail: (err) => {
    console.error(err);
  }
});
```

#### å¸¸è§é”™è¯¯ âŒ

```javascript
// âŒ é”™è¯¯ 1: ä½¿ç”¨ç›¸å¯¹è·¯å¾„
url: '/api/categories'

// âŒ é”™è¯¯ 2: ç¼ºå°‘æ–œæ 
url: `${BASE_URL}api/categories`

// âŒ é”™è¯¯ 3: å¤šä½™çš„æ–œæ 
url: `${BASE_URL}//api/categories`

// âŒ é”™è¯¯ 4: æ²¡æœ‰ä½¿ç”¨ BASE_URL
url: 'api/categories'
```

---

## ğŸ§ª API æµ‹è¯•æ­¥éª¤

### æ–¹æ³• 1: æµè§ˆå™¨ç›´æ¥æµ‹è¯• (æ¨èï¼Œæœ€å¿«)

**ç­‰å¾… 5-10 åˆ†é’Ÿè®©é€Ÿç‡é™åˆ¶é‡ç½®**ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®:

1. **åˆ†ç±»åˆ—è¡¨**:  
   https://cooktip-backend.vercel.app/api/categories

2. **é£Ÿè°±åˆ—è¡¨**:  
   https://cooktip-backend.vercel.app/api/recipes?page=1&limit=5

3. **æœç´¢åŠŸèƒ½**:  
   https://cooktip-backend.vercel.app/api/search?keyword=é¸¡&page=1&pageSize=5

**é¢„æœŸç»“æœ:**
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "list": [...]
  }
}
```

### æ–¹æ³• 2: ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºæµ‹è¯•ä»£ç 

1. åœ¨å°ç¨‹åºä¸­åˆ›å»ºæµ‹è¯•é¡µé¢: `pages/test/test.js`
2. å¤åˆ¶ `å¾®ä¿¡å°ç¨‹åºæµ‹è¯•ä»£ç .js` ä¸­çš„ä»£ç 
3. è¿è¡Œå°ç¨‹åºå¹¶ç‚¹å‡»æµ‹è¯•æŒ‰é’®

**æµ‹è¯•ä»£ç ä½ç½®:**
```
é¡¹ç›®æ ¹ç›®å½•/å¾®ä¿¡å°ç¨‹åºæµ‹è¯•ä»£ç .js
```

### æ–¹æ³• 3: PowerShell æµ‹è¯•ï¼ˆWindowsï¼‰

ç­‰å¾… 10 åˆ†é’Ÿåè¿è¡Œ:

```powershell
# æµ‹è¯•åˆ†ç±»æ¥å£
Invoke-RestMethod -Uri "https://cooktip-backend.vercel.app/api/categories"

# æµ‹è¯•é£Ÿè°±åˆ—è¡¨
Invoke-RestMethod -Uri "https://cooktip-backend.vercel.app/api/recipes?page=1&limit=5"
```

---

## ğŸ” é—®é¢˜è¯Šæ–­

### é—®é¢˜ 1: `request:fail invalid url "/api/categories"`

**åŸå› **: ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„

**è§£å†³æ–¹æ¡ˆ:**
```javascript
// ä¿®æ”¹å‰ç«¯ä»£ç 
const BASE_URL = 'https://cooktip-backend.vercel.app';
url: `${BASE_URL}/api/categories`
```

### é—®é¢˜ 2: `request:fail url not in domain list`

**åŸå› **: æœªé…ç½®æœåŠ¡å™¨åŸŸåç™½åå•

**è§£å†³æ–¹æ¡ˆ:**
1. å¼€å‘æ—¶: å‹¾é€‰ "ä¸æ ¡éªŒåˆæ³•åŸŸå"
2. ç”Ÿäº§æ—¶: åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®åŸŸå

### é—®é¢˜ 3: `Failed to fetch` æˆ– CORS é”™è¯¯

**åŸå› **: CORS é…ç½®é—®é¢˜

**è§£å†³æ–¹æ¡ˆ:**
- âœ… å·²ä¿®å¤ï¼é‡æ–°éƒ¨ç½²ååº”è¯¥è§£å†³
- å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æä¾›å®Œæ•´é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 4: `429 Too Many Requests`

**åŸå› **: è¯·æ±‚è¿‡äºé¢‘ç¹

**è§£å†³æ–¹æ¡ˆ:**
- ç­‰å¾… 10-15 åˆ†é’Ÿ
- æ·»åŠ è¯·æ±‚é˜²æŠ–/èŠ‚æµ
- å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚

### é—®é¢˜ 5: æ•°æ®è¿”å›ä¸ºç©ºæˆ–ä¸æ­£ç¡®

**æ£€æŸ¥æ­¥éª¤:**
1. ç¡®è®¤ API URL æ­£ç¡®
2. æ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹å¾®ä¿¡å¼€å‘è€…å·¥å…· Network æ ‡ç­¾
4. æŸ¥çœ‹è¿”å›çš„ `code` å’Œ `message`

---

## ğŸ“‹ å®Œæ•´çš„ API æ¥å£åˆ—è¡¨

### 1. åˆ†ç±»ç›¸å…³

#### è·å–åˆ†ç±»åˆ—è¡¨
```
GET /api/categories
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "list": [
      {
        "categoryId": "cat_001",
        "name": "ç‚’èœ",
        "icon": "https://...",
        "recipeCount": 50
      }
    ]
  }
}
```

### 2. é£Ÿè°±ç›¸å…³

#### è·å–é£Ÿè°±åˆ—è¡¨
```
GET /api/recipes?page=1&limit=10&category=ç‚’èœ&difficulty=ç®€å•
```

**æŸ¥è¯¢å‚æ•°:**
- `page`: é¡µç  (é»˜è®¤ 1)
- `limit`: æ¯é¡µæ•°é‡ (é»˜è®¤ 10)
- `category`: åˆ†ç±»ç­›é€‰ (å¯é€‰)
- `difficulty`: éš¾åº¦ç­›é€‰ (å¯é€‰)
- `sortBy`: æ’åºå­—æ®µ (å¯é€‰: created_at, views, likes, collects)

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "list": [
      {
        "id": "uuid",
        "title": "å®«ä¿é¸¡ä¸",
        "coverImage": "https://...",
        "introduction": "ç»å…¸å·èœ...",
        "difficulty": "ä¸­ç­‰",
        "cookTime": 30,
        "category": "ç‚’èœ",
        "likes": 100,
        "collects": 50,
        "authorName": "å¤§å¨å¼ ä¸‰"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 198,
      "totalPages": 20
    }
  }
}
```

#### è·å–é£Ÿè°±è¯¦æƒ…
```
GET /api/recipes/{id}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "data": {
    "id": "uuid",
    "title": "å®«ä¿é¸¡ä¸",
    "coverImage": "https://...",
    "introduction": "ç»å…¸å·èœ...",
    "difficulty": "ä¸­ç­‰",
    "cookTime": 30,
    "servings": 2,
    "category": "ç‚’èœ",
    "ingredients": [
      {
        "name": "é¸¡èƒ¸è‚‰",
        "amount": "200g"
      }
    ],
    "steps": [
      {
        "order": 1,
        "content": "é¸¡èƒ¸è‚‰åˆ‡ä¸...",
        "image": "https://..."
      }
    ],
    "tips": "å°è´´å£«å†…å®¹",
    "nutrition": {
      "calories": "350kcal",
      "protein": "25g"
    },
    "likes": 100,
    "collects": 50,
    "views": 1000,
    "author": {
      "id": "uuid",
      "nickName": "å¤§å¨å¼ ä¸‰",
      "avatar": "https://..."
    }
  }
}
```

### 3. æœç´¢ç›¸å…³

#### æœç´¢é£Ÿè°±
```
GET /api/search?keyword=é¸¡&page=1&pageSize=10&category=ç‚’èœ
```

**æŸ¥è¯¢å‚æ•°:**
- `keyword`: æœç´¢å…³é”®è¯ (å¿…éœ€)
- `page`: é¡µç  (é»˜è®¤ 1)
- `pageSize`: æ¯é¡µæ•°é‡ (é»˜è®¤ 10)
- `category`: åˆ†ç±»ç­›é€‰ (å¯é€‰)
- `difficulty`: éš¾åº¦ç­›é€‰ (å¯é€‰)

### 4. ç”¨æˆ·è®¤è¯ (éœ€è¦ JWT Token)

#### å¾®ä¿¡ç™»å½•
```
POST /api/auth/login
Content-Type: application/json

{
  "code": "å¾®ä¿¡ç™»å½•code"
}
```

#### è·å–ç”¨æˆ·ä¿¡æ¯
```
GET /api/user/info
Authorization: Bearer {token}
```

#### è·å–æ”¶è—åˆ—è¡¨
```
GET /api/favorites?page=1&limit=10
Authorization: Bearer {token}
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### å½“å‰æ•°æ®åº“å†…å®¹

- âœ… **é£Ÿè°±æ€»æ•°**: 198 ä¸ª (è€ä¹¡é¸¡èœè°±)
- âœ… **åˆ†ç±»**: å¤šä¸ªåˆ†ç±» (ç‚’èœã€å‡‰èœã€è’¸èœã€ä¸»é£Ÿç­‰)
- âœ… **æ•°æ®åº“**: PostgreSQL (Neon)
- âœ… **éƒ¨ç½²çŠ¶æ€**: å·²éƒ¨ç½²åˆ° Vercel

---

## ğŸš¨ é‡è¦æé†’

### å¼€å‘é˜¶æ®µ (ç°åœ¨)

1. âœ… å‹¾é€‰ "ä¸æ ¡éªŒåˆæ³•åŸŸå"
2. âœ… ç­‰å¾… 10 åˆ†é’Ÿè®©é€Ÿç‡é™åˆ¶é‡ç½®
3. âœ… ä½¿ç”¨æµè§ˆå™¨æµ‹è¯• API æ˜¯å¦æ­£å¸¸
4. âœ… åœ¨å°ç¨‹åºä¸­æµ‹è¯•æ•°æ®è·å–

### å‘å¸ƒå‰å¿…åš

1. âš ï¸ **å¿…é¡»åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®æœåŠ¡å™¨åŸŸå**
2. âš ï¸ å–æ¶ˆå‹¾é€‰ "ä¸æ ¡éªŒåˆæ³•åŸŸå"
3. âš ï¸ å®Œæ•´æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
4. âš ï¸ æ£€æŸ¥æ‰€æœ‰è¯·æ±‚éƒ½ä½¿ç”¨å®Œæ•´ URL

---

## ğŸ“ å¦‚æœè¿˜æœ‰é—®é¢˜

### éœ€è¦æä¾›çš„ä¿¡æ¯

1. **å®Œæ•´çš„é”™è¯¯ä¿¡æ¯**
   - å¾®ä¿¡å¼€å‘è€…å·¥å…· Console æˆªå›¾
   - Network æ ‡ç­¾ä¸­çš„è¯·æ±‚è¯¦æƒ…

2. **å‰ç«¯è¯·æ±‚ä»£ç **
   - å®Œæ•´çš„ `wx.request` è°ƒç”¨ä»£ç 
   - `BASE_URL` é…ç½®

3. **æµ‹è¯•ç»“æœ**
   - æµè§ˆå™¨ç›´æ¥è®¿é—® API æ˜¯å¦æ­£å¸¸
   - å¾®ä¿¡å¼€å‘è€…å·¥å…· Network ä¸­çš„å“åº”

4. **é…ç½®æƒ…å†µ**
   - æ˜¯å¦å‹¾é€‰äº† "ä¸æ ¡éªŒåˆæ³•åŸŸå"
   - æ˜¯å¦é…ç½®äº†æœåŠ¡å™¨åŸŸåç™½åå•

---

## â° æ—¶é—´çº¿

| æ—¶é—´ | æ“ä½œ | çŠ¶æ€ |
|------|------|------|
| ç°åœ¨ | ç­‰å¾… Vercel éƒ¨ç½²å®Œæˆ | â³ è¿›è¡Œä¸­ (2-3åˆ†é’Ÿ) |
| +5åˆ†é’Ÿ | é€Ÿç‡é™åˆ¶é‡ç½® | â° ç­‰å¾…ä¸­ |
| +10åˆ†é’Ÿ | å¯ä»¥å¼€å§‹æµè§ˆå™¨æµ‹è¯• | âœ… å¯æ‰§è¡Œ |
| +15åˆ†é’Ÿ | å¯ä»¥å¼€å§‹å°ç¨‹åºæµ‹è¯• | âœ… å¯æ‰§è¡Œ |

---

## ğŸ‰ ä¸‹ä¸€æ­¥

1. â° **ç­‰å¾… 10 åˆ†é’Ÿ** (è®©éƒ¨ç½²å®Œæˆ + é€Ÿç‡é™åˆ¶é‡ç½®)
2. ğŸŒ **æµè§ˆå™¨æµ‹è¯•** API æ˜¯å¦æ­£å¸¸è¿”å›æ•°æ®
3. ğŸ“± **å°ç¨‹åºæµ‹è¯•** ä½¿ç”¨æä¾›çš„æµ‹è¯•ä»£ç 
4. âœ… **ç¡®è®¤æ•°æ®æ­£å¸¸** åå¼€å§‹å‰ç«¯å¼€å‘
5. ğŸš€ **å‘å¸ƒå‰** è®°å¾—é…ç½®æœåŠ¡å™¨åŸŸåç™½åå•

---

**åˆ›å»ºæ—¶é—´**: 2025-10-02  
**æ›´æ–°æ—¶é—´**: 2025-10-02  
**éƒ¨ç½²ç‰ˆæœ¬**: c8f26ee  
**çŠ¶æ€**: âœ… CORS å·²ä¼˜åŒ–ï¼Œç­‰å¾…æµ‹è¯•

