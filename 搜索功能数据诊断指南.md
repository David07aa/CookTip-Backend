# ğŸ” æœç´¢åŠŸèƒ½æ•°æ®è¯Šæ–­æŒ‡å—

**ç›®çš„**: æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰é£Ÿè°±æ•°æ®ï¼Œå¹¶è¯Šæ–­ä¸ºä»€ä¹ˆæœç´¢è¿”å›ç©ºç»“æœ

---

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šæœç´¢åŠŸèƒ½è¿”å›"æ²¡æœ‰æœç´¢åˆ°"ï¼Œè€Œä¸æ˜¯è¿”å›å®é™…çš„æœç´¢ç»“æœã€‚

**å¯èƒ½çš„åŸå› **:
1. æ•°æ®åº“ä¸­æ²¡æœ‰é£Ÿè°±æ•°æ®
2. æ‰€æœ‰é£Ÿè°±çš„çŠ¶æ€ä¸æ˜¯ `published`
3. æœç´¢å…³é”®è¯æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•é£Ÿè°±
4. æ•°æ®åº“æŸ¥è¯¢æ¡ä»¶è¿‡äºä¸¥æ ¼

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šç­‰å¾…éƒ¨ç½²ï¼ˆ3-5 åˆ†é’Ÿï¼‰

å·²æ·»åŠ çš„ä¼˜åŒ–ï¼ˆCommit: `539e40b`ï¼‰ï¼š

1. âœ… **è¯¦ç»†çš„æŸ¥è¯¢æ—¥å¿—**
   - è®°å½•æœç´¢å‚æ•°
   - è®°å½•æ•°æ®åº“æ€»æ•°
   - è®°å½•ç”Ÿæˆçš„ SQL
   - è®°å½•æŸ¥è¯¢ç»“æœ

2. âœ… **è°ƒè¯•ç«¯ç‚¹**
   - `GET /api/v1/search/debug/all-recipes`
   - ç›´æ¥è¿”å›æ•°æ®åº“ä¸­çš„å‰ 10 æ¡é£Ÿè°±
   - ä¸è¿›è¡Œä»»ä½•è¿‡æ»¤

3. âœ… **ä¼˜åŒ–æœç´¢é€»è¾‘**
   - å…³é”®è¯ä¸ºç©ºæ—¶è¿”å›æ‰€æœ‰é£Ÿè°±
   - æ›´çµæ´»çš„æŸ¥è¯¢æ¡ä»¶

---

## ğŸ§ª ç¬¬äºŒæ­¥ï¼šæµ‹è¯•è°ƒè¯•ç«¯ç‚¹

### æ–¹æ³• Aï¼šä½¿ç”¨æµè§ˆå™¨ï¼ˆæ¨èï¼‰

**ç›´æ¥è®¿é—®**:
```
https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/search/debug/all-recipes
```

**é¢„æœŸå“åº”**ï¼ˆå¦‚æœæœ‰æ•°æ®ï¼‰:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 10,
    "recipes": [
      {
        "id": 1,
        "title": "å®«ä¿é¸¡ä¸",
        "status": "published",
        "user": { "id": 1, "nickname": "ç¾é£Ÿè¾¾äºº" },
        "created_at": "2025-10-29T..."
      },
      ...
    ]
  }
}
```

**å¦‚æœæ²¡æœ‰æ•°æ®**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 0,
    "recipes": []
  }
}
```

### æ–¹æ³• Bï¼šä½¿ç”¨ curl

```bash
curl https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/search/debug/all-recipes
```

---

## ğŸ“Š ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹äº‘æ‰˜ç®¡æ—¥å¿—

### æœç´¢å…³é”®è¯

åœ¨äº‘æ‰˜ç®¡æ—¥å¿—ä¸­æœç´¢ï¼š

```
[SearchService] Total recipes in database
[SearchService] Building query
[SearchService] Generated SQL
[SearchService] Query result
```

### é¢„æœŸæ—¥å¿—

**å¦‚æœæœ‰æ•°æ®**:
```
[SearchService] Debug: Found recipes: 10
[SearchService] Total recipes in database: 50
[SearchService] Building query: {keyword: "é¸¡", pageNum: 1, ...}
[SearchService] Generated SQL: SELECT recipe.id, recipe.title, ... FROM recipes ...
[SearchService] Query result: {itemsCount: 5, total: 5, firstItem: {id: 1, title: "å®«ä¿é¸¡ä¸"}}
```

**å¦‚æœæ²¡æœ‰æ•°æ®**:
```
[SearchService] Debug: Found recipes: 0
[SearchService] Total recipes in database: 0
[SearchService] Query result: {itemsCount: 0, total: 0, firstItem: null}
```

---

## ğŸ” ç¬¬å››æ­¥ï¼šè¯Šæ–­é—®é¢˜

### æƒ…å†µ 1: æ•°æ®åº“å®Œå…¨æ²¡æœ‰æ•°æ®

**æ—¥å¿—æ˜¾ç¤º**:
```
[SearchService] Total recipes in database: 0
[SearchService] Debug: Found recipes: 0
```

**åŸå› **: æ•°æ®åº“æ˜¯ç©ºçš„

**è§£å†³æ–¹æ¡ˆ**: éœ€è¦å¯¼å…¥é£Ÿè°±æ•°æ®

```sql
-- æŸ¥çœ‹æ•°æ®åº“ä¸­çš„é£Ÿè°±æ•°é‡
SELECT COUNT(*) FROM recipes;

-- æŸ¥çœ‹é£Ÿè°±çŠ¶æ€åˆ†å¸ƒ
SELECT status, COUNT(*) FROM recipes GROUP BY status;
```

---

### æƒ…å†µ 2: æœ‰æ•°æ®ä½†éƒ½ä¸æ˜¯ published çŠ¶æ€

**æ—¥å¿—æ˜¾ç¤º**:
```
[SearchService] Total recipes in database: 50
[SearchService] Debug: Found recipes: 10
[SearchService] Query result: {itemsCount: 0, total: 0}  // æœç´¢ç»“æœä¸º0
```

**åŸå› **: æ‰€æœ‰é£Ÿè°±çš„çŠ¶æ€ä¸æ˜¯ `published`

**è§£å†³æ–¹æ¡ˆ**: æ›´æ–°é£Ÿè°±çŠ¶æ€

```sql
-- æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€
SELECT status, COUNT(*) FROM recipes GROUP BY status;

-- å¦‚æœéœ€è¦ï¼Œå°†æ‰€æœ‰é£Ÿè°±æ”¹ä¸º published
UPDATE recipes SET status = 'published' WHERE status != 'published';
```

---

### æƒ…å†µ 3: æœ‰ published æ•°æ®ä½†æœç´¢ä¸åˆ°

**æ—¥å¿—æ˜¾ç¤º**:
```
[SearchService] Total recipes in database: 50
[SearchService] Debug: Found recipes: 10 (æœ‰ published çŠ¶æ€çš„)
[SearchService] Query result: {itemsCount: 0, total: 0, firstItem: null}
[SearchService] Generated SQL: ... WHERE recipe.title LIKE '%é¸¡%' OR recipe.description LIKE '%é¸¡%'
```

**åŸå› **: å…³é”®è¯æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•é£Ÿè°±

**è§£å†³æ–¹æ¡ˆ**: 
1. å°è¯•æœç´¢å…¶ä»–å…³é”®è¯
2. æ£€æŸ¥æ•°æ®åº“ä¸­é£Ÿè°±çš„æ ‡é¢˜

```sql
-- æŸ¥çœ‹æ‰€æœ‰é£Ÿè°±æ ‡é¢˜
SELECT id, title, description FROM recipes WHERE status = 'published' LIMIT 10;

-- æœç´¢åŒ…å«"é¸¡"çš„é£Ÿè°±
SELECT id, title FROM recipes WHERE (title LIKE '%é¸¡%' OR description LIKE '%é¸¡%') AND status = 'published';
```

---

### æƒ…å†µ 4: MySQL å­—ç¬¦é›†é—®é¢˜ï¼ˆä¸­æ–‡æœç´¢ï¼‰

**ç—‡çŠ¶**: è‹±æ–‡å¯ä»¥æœç´¢ï¼Œä¸­æ–‡æœç´¢ä¸åˆ°

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æ•°æ®åº“å­—ç¬¦é›†

```sql
-- æ£€æŸ¥æ•°æ®åº“å­—ç¬¦é›†
SHOW VARIABLES LIKE 'character_set%';

-- æ£€æŸ¥è¡¨å­—ç¬¦é›†
SHOW CREATE TABLE recipes;

-- å¦‚æœéœ€è¦ï¼Œä¿®æ”¹å­—ç¬¦é›†
ALTER TABLE recipes CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE recipes MODIFY title VARCHAR(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE recipes MODIFY description TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

---

## ğŸ› ï¸ ç¬¬äº”æ­¥ï¼šä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: å¯¼å…¥æµ‹è¯•æ•°æ®ï¼ˆå¦‚æœæ•°æ®åº“ä¸ºç©ºï¼‰

```sql
INSERT INTO recipes (user_id, title, cover_image, description, difficulty, cook_time, status, created_at, updated_at) VALUES
(1, 'å®«ä¿é¸¡ä¸', 'https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/laoxiangji/LXJLOGO/LxjAd.jpg', 'ç»å…¸å·èœï¼Œé¸¡è‚‰é²œå«©ï¼ŒèŠ±ç”Ÿé…¥è„†', 'ä¸­ç­‰', 30, 'published', NOW(), NOW()),
(1, 'çº¢çƒ§è‚‰', 'https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/laoxiangji/LXJLOGO/LxjAd.jpg', 'è‚¥è€Œä¸è…»ï¼Œå…¥å£å³åŒ–', 'ç®€å•', 60, 'published', NOW(), NOW()),
(1, 'éº»å©†è±†è…', 'https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/laoxiangji/LXJLOGO/LxjAd.jpg', 'éº»è¾£é²œé¦™ï¼Œè±†è…å«©æ»‘', 'ç®€å•', 20, 'published', NOW(), NOW()),
(1, 'é…¸èœé±¼', 'https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/laoxiangji/LXJLOGO/LxjAd.jpg', 'é±¼è‚‰é²œå«©ï¼Œé…¸è¾£å¼€èƒƒ', 'ä¸­ç­‰', 40, 'published', NOW(), NOW()),
(1, 'è¥¿çº¢æŸ¿ç‚’é¸¡è›‹', 'https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com/laoxiangji/LXJLOGO/LxjAd.jpg', 'å®¶å¸¸èœï¼Œè¥å…»ä¸°å¯Œ', 'ç®€å•', 10, 'published', NOW(), NOW());
```

### æ–¹æ¡ˆ B: æ›´æ–°ç°æœ‰é£Ÿè°±çŠ¶æ€

```sql
-- å°†æ‰€æœ‰é£Ÿè°±æ”¹ä¸º published
UPDATE recipes SET status = 'published';
```

### æ–¹æ¡ˆ C: ä¿®æ”¹æœç´¢é€»è¾‘ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

å¦‚æœæ•°æ®åº“ä¸­ç¡®å®æœ‰æ•°æ®ï¼Œä½†æœç´¢é€»è¾‘æœ‰é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶ç§»é™¤ `status` è¿‡æ»¤ï¼š

```typescript
// ä¸´æ—¶ï¼šä¸è¿‡æ»¤çŠ¶æ€ï¼Œæœç´¢æ‰€æœ‰é£Ÿè°±
// queryBuilder.andWhere('recipe.status = :status', { status: 'published' });
```

---

## ğŸ“‹ æ“ä½œæ¸…å•

- [ ] 1. ç­‰å¾…äº‘æ‰˜ç®¡éƒ¨ç½²å®Œæˆï¼ˆ3-5 åˆ†é’Ÿï¼‰
- [ ] 2. è®¿é—®è°ƒè¯•ç«¯ç‚¹ï¼š`/api/v1/search/debug/all-recipes`
- [ ] 3. æŸ¥çœ‹è¿”å›ç»“æœ
- [ ] 4. æŸ¥çœ‹äº‘æ‰˜ç®¡æ—¥å¿—
- [ ] 5. æ ¹æ®è¯Šæ–­ç»“æœé€‰æ‹©ä¿®å¤æ–¹æ¡ˆ
- [ ] 6. æµ‹è¯•æœç´¢åŠŸèƒ½
- [ ] 7. åé¦ˆç»“æœ

---

## ğŸ“ åé¦ˆæ¨¡æ¿

```
è°ƒè¯•ç«¯ç‚¹å“åº”:
```json
[ç²˜è´´å“åº”JSON]
```

äº‘æ‰˜ç®¡æ—¥å¿—:
```
[ç²˜è´´ç›¸å…³æ—¥å¿—]
```

æ•°æ®åº“çŠ¶æ€:
- æ€»é£Ÿè°±æ•°: ___
- Published é£Ÿè°±æ•°: ___
- æœç´¢å…³é”®è¯: ___
- æœç´¢ç»“æœæ•°: ___

éœ€è¦å¸®åŠ©: æ˜¯ / å¦
```

---

**ç­‰å¾… 3-5 åˆ†é’Ÿåï¼Œè¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤è¿›è¡Œè¯Šæ–­ï¼** ğŸ”

