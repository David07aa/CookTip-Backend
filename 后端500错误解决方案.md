# 后端 500 错误解决方案

## 📋 问题分析

前端请求报错：
```
GET https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/recipes?page=1&limit=10&sort=recommended
500 (Internal Server Error)
```

## ✅ 数据库状态检查结果

✓ 数据库连接正常
✓ 所有表都存在（categories, recipes, users, comments, favorites, likes, shopping_list）
✓ categories 表有 10 条数据
✓ recipes 表有 3 条测试数据
✓ 表结构与后端代码完全一致

## 🔍 问题原因

**云托管服务还在运行旧代码！**

我们已经修复了后端代码，添加了：
1. ✅ `sort` 和 `sortBy` 参数支持
2. ✅ `recommended` 排序逻辑
3. ✅ 数据库表结构正确

但是，**你还没有重新部署云托管服务**，所以线上还在运行修复前的旧代码。

## 🚀 解决步骤

### 1. 推送最新代码到 GitHub

```bash
git add .
git commit -m "fix: 修复食谱排序和数据库结构问题"
git push origin main
```

### 2. 在微信云托管控制台重新部署

1. 打开微信云托管控制台
2. 找到你的服务 `yjsp-ytg`
3. 点击「新建版本」或「重新部署」
4. 选择从 GitHub 拉取代码
5. 选择 `main` 分支
6. 等待构建和部署完成（大约 2-3 分钟）

### 3. 验证部署

部署完成后，测试以下接口：

```bash
# 测试分类列表
curl https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/categories

# 测试食谱列表 - latest 排序
curl "https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/recipes?page=1&limit=10&sort=latest"

# 测试食谱列表 - recommended 排序
curl "https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/recipes?page=1&limit=10&sort=recommended"

# 测试食谱列表 - popular 排序
curl "https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/recipes?page=1&limit=10&sort=popular"

# 测试食谱列表 - hot 排序
curl "https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/recipes?page=1&limit=10&sort=hot"
```

## 📊 当前数据库数据

### 分类（10 个）
- 中餐、西餐、日韩料理、烘焙甜点、家常菜、快手菜、素食、汤羹、小吃、饮品

### 食谱（3 个）
1. **红烧排骨** - 中餐，简单，39 赞，52 收藏，375 浏览
2. **戚风蛋糕** - 烘焙甜点，中等，36 赞，33 收藏，421 浏览
3. **番茄炒蛋** - 中餐，简单，107 赞，43 收藏，187 浏览

### 用户（2 个）
测试用户数据

## 🎯 后端支持的排序方式

| 参数值 | 排序规则 | 说明 |
|--------|----------|------|
| `latest` | 按创建时间倒序 | 默认排序 |
| `hot` | 按点赞数倒序 | 最多赞 |
| `popular` | 按浏览量倒序 | 最多人看 |
| `recommended` | 综合算法 | 点赞×3 + 收藏×2 + 浏览×0.1 |

## 📝 注意事项

1. **必须重新部署**：代码更新后必须在云托管控制台重新部署才能生效
2. **部署时间**：通常需要 2-3 分钟
3. **环境变量**：确保云托管的环境变量配置正确（之前已配置好）
4. **健康检查**：端口设置为 3000

## 🔗 相关文档

- `部署指南.md` - 详细的云托管部署步骤
- `快速启动.md` - 本地开发指南
- `前端对接API文档.md` - 前端 API 使用说明

---

**问题已定位，请立即重新部署云托管服务即可解决！** 🚀

