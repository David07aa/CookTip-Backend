# å¾®ä¿¡ç™»å½•æ¥å£ 404 é”™è¯¯ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

å‰ç«¯è¯·æ±‚å¾®ä¿¡ç™»å½•æ¥å£æ—¶è¿”å› 404 é”™è¯¯ï¼š

```
POST https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/auth/wx-login
404 (Not Found)
```

## ğŸ” é—®é¢˜åŸå› 

**è·¯ç”±åç§°ä¸åŒ¹é…**ï¼š

- å‰ç«¯è¯·æ±‚çš„è·¯ç”±ï¼š`/api/v1/auth/wx-login`
- åç«¯å®é™…è·¯ç”±ï¼š`/api/v1/auth/wechat-login`

å‰ç«¯ä½¿ç”¨çš„æ˜¯ç®€å†™ `wx-login`ï¼Œè€Œåç«¯ä½¿ç”¨çš„æ˜¯å®Œæ•´åç§° `wechat-login`ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

åœ¨ `src/modules/auth/auth.controller.ts` ä¸­æ·»åŠ äº† `wx-login` è·¯ç”±åˆ«åï¼Œå…¼å®¹å‰ç«¯è¯·æ±‚ï¼š

```typescript
// å…¼å®¹å‰ç«¯çš„ wx-login è·¯ç”±
@Public()
@Post('wx-login')
@HttpCode(200)
@ApiOperation({ summary: 'å¾®ä¿¡ç™»å½•ï¼ˆå…¼å®¹è·¯ç”±ï¼‰' })
@ApiResponse({ status: 200, description: 'ç™»å½•æˆåŠŸ' })
@ApiResponse({ status: 401, description: 'ç™»å½•å¤±è´¥' })
async wxLogin(@Body() wechatLoginDto: WechatLoginDto) {
  return this.authService.wechatLogin(wechatLoginDto);
}
```

## ğŸ“ æ”¯æŒçš„ç™»å½•æ¥å£

ç°åœ¨åç«¯åŒæ—¶æ”¯æŒä¸¤ä¸ªç™»å½•è·¯ç”±ï¼š

### 1ï¸âƒ£ å®Œæ•´è·¯ç”±ï¼ˆæ¨èï¼‰
```
POST /api/v1/auth/wechat-login
```

### 2ï¸âƒ£ ç®€å†™è·¯ç”±ï¼ˆå…¼å®¹å‰ç«¯ï¼‰
```
POST /api/v1/auth/wx-login
```

**ä¸¤ä¸ªè·¯ç”±åŠŸèƒ½å®Œå…¨ç›¸åŒ**ï¼Œéƒ½è°ƒç”¨åŒä¸€ä¸ª `wechatLogin` æœåŠ¡æ–¹æ³•ã€‚

## ğŸ“‹ æ¥å£è¯¦æƒ…

### è¯·æ±‚æ–¹å¼
`POST /api/v1/auth/wx-login`

### è¯·æ±‚å‚æ•°

```json
{
  "code": "å¾®ä¿¡ç™»å½•å‡­è¯code"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| code | string | æ˜¯ | é€šè¿‡ wx.login() è·å–çš„ä¸´æ—¶ç™»å½•å‡­è¯ |

### å“åº”ç¤ºä¾‹

#### æˆåŠŸå“åº” (200)

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "openid": "oXXXXXXXXXXXXXXXXXXXX",
      "nickname": "å¾®ä¿¡ç”¨æˆ·",
      "avatar": "https://...",
      "phone": null,
      "created_at": "2025-10-09T08:00:00.000Z"
    }
  }
}
```

#### å¤±è´¥å“åº” (401)

```json
{
  "code": 401,
  "message": "å¾®ä¿¡ç™»å½•å¤±è´¥",
  "error": "Unauthorized"
}
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨ curl æµ‹è¯•

```bash
curl -X POST "https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/auth/wx-login" \
  -H "Content-Type: application/json" \
  -d '{"code":"æµ‹è¯•code"}'
```

### æ–¹æ³• 2: åœ¨å°ç¨‹åºä¸­æµ‹è¯•

```javascript
// å¾®ä¿¡å°ç¨‹åºç™»å½•
wx.login({
  success: async (res) => {
    if (res.code) {
      try {
        const loginRes = await wx.request({
          url: 'https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/auth/wx-login',
          method: 'POST',
          data: {
            code: res.code
          }
        });
        
        if (loginRes.data.code === 200) {
          console.log('ç™»å½•æˆåŠŸ:', loginRes.data.data);
          
          // ä¿å­˜ token
          wx.setStorageSync('token', loginRes.data.data.access_token);
          
          // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
          wx.setStorageSync('userInfo', loginRes.data.data.user);
          
          wx.showToast({
            title: 'ç™»å½•æˆåŠŸ',
            icon: 'success'
          });
        } else {
          console.error('ç™»å½•å¤±è´¥:', loginRes.data);
          wx.showToast({
            title: 'ç™»å½•å¤±è´¥',
            icon: 'none'
          });
        }
      } catch (error) {
        console.error('è¯·æ±‚é”™è¯¯:', error);
        wx.showToast({
          title: 'ç½‘ç»œé”™è¯¯',
          icon: 'none'
        });
      }
    }
  }
});
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1ï¸âƒ£ ä»£ç å·²æ¨é€ âœ…
ä¿®å¤ä»£ç å·²æ¨é€åˆ° GitHub `main` åˆ†æ”¯ã€‚

### 2ï¸âƒ£ é‡æ–°éƒ¨ç½²äº‘æ‰˜ç®¡ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰

1. æ‰“å¼€ [å¾®ä¿¡äº‘æ‰˜ç®¡æ§åˆ¶å°](https://console.cloud.tencent.com/tcb)
2. æ‰¾åˆ°æœåŠ¡ `yjsp-ytg`
3. ç‚¹å‡»ã€Œæ–°å»ºç‰ˆæœ¬ã€
4. é€‰æ‹©ä» GitHub æ‹‰å–ä»£ç ï¼ˆ`main` åˆ†æ”¯ï¼‰
5. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

### 3ï¸âƒ£ éªŒè¯ä¿®å¤

éƒ¨ç½²å®Œæˆåï¼Œæµ‹è¯•ç™»å½•æ¥å£ï¼š

```bash
# æµ‹è¯• wx-login è·¯ç”±ï¼ˆå‰ç«¯ä½¿ç”¨çš„ï¼‰
curl -X POST "https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/auth/wx-login" \
  -H "Content-Type: application/json" \
  -d '{"code":"test"}'

# æµ‹è¯• wechat-login è·¯ç”±ï¼ˆåŸè·¯ç”±ï¼‰
curl -X POST "https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/auth/wechat-login" \
  -H "Content-Type: application/json" \
  -d '{"code":"test"}'
```

**æœŸæœ›ç»“æœ**ï¼š
- çŠ¶æ€ç åº”è¯¥æ˜¯ `200` æˆ– `401`ï¼ˆå–å†³äº code æ˜¯å¦æœ‰æ•ˆï¼‰
- **ä¸åº”è¯¥æ˜¯ 404**

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å¾®ä¿¡é…ç½®

ç¡®ä¿åœ¨ `.env` ä¸­é…ç½®äº†æ­£ç¡®çš„å¾®ä¿¡å°ç¨‹åºä¿¡æ¯ï¼š

```env
WX_APPID=wx8486e57500ac0a55
WX_SECRET=bd4c652097608bb064350cc7e3b5801c
```

### 2. Token ä½¿ç”¨

ç™»å½•æˆåŠŸåï¼Œå°†è¿”å›çš„ `access_token` ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œåç»­è¯·æ±‚éœ€è¦æºå¸¦ tokenï¼š

```javascript
// ä¿å­˜ token
wx.setStorageSync('token', access_token);

// å‘èµ·éœ€è¦è®¤è¯çš„è¯·æ±‚
wx.request({
  url: 'https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com/api/v1/user/profile',
  method: 'GET',
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  }
});
```

### 3. æµ‹è¯•ç¯å¢ƒ

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¾®ä¿¡å°ç¨‹åºæ¨¡æ‹Ÿå™¨å¯èƒ½æ— æ³•è·å–çœŸå®çš„ `code`ï¼Œå»ºè®®åœ¨çœŸæœºä¸Šæµ‹è¯•ç™»å½•åŠŸèƒ½ã€‚

## ğŸ”— ç›¸å…³æ¥å£

### åˆ·æ–° Token
```
POST /api/v1/auth/refresh
Authorization: Bearer {token}
```

### é€€å‡ºç™»å½•
```
POST /api/v1/auth/logout
Authorization: Bearer {token}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `åç«¯APIå¼€å‘æ–‡æ¡£.md` - å®Œæ•´çš„ API æ–‡æ¡£
- `éƒ¨ç½²æŒ‡å—.md` - äº‘æ‰˜ç®¡éƒ¨ç½²æ­¥éª¤

## ğŸ¯ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç™»å½•è·¯ç”±ï¼Ÿ
**A**: ä¸ºäº†å…¼å®¹å‰ç«¯ä»£ç ã€‚å‰ç«¯å·²ç»ä½¿ç”¨ `wx-login`ï¼Œä¿®æ”¹å‰ç«¯éœ€è¦æ›´å¤šæ—¶é—´ï¼Œæ‰€ä»¥åç«¯æ·»åŠ åˆ«åæ”¯æŒã€‚

### Q2: ä¸¤ä¸ªè·¯ç”±æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
**A**: æ²¡æœ‰åŒºåˆ«ï¼ŒåŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œéƒ½è°ƒç”¨åŒä¸€ä¸ªæœåŠ¡æ–¹æ³•ã€‚

### Q3: ç™»å½•æ¥å£è¿”å› 401 æ€ä¹ˆåŠï¼Ÿ
**A**: 401 æ˜¯å¾®ä¿¡ç™»å½•å¤±è´¥ï¼Œå¯èƒ½çš„åŸå› ï¼š
- å¾®ä¿¡ code å·²è¿‡æœŸï¼ˆæœ‰æ•ˆæœŸ 5 åˆ†é’Ÿï¼‰
- å¾®ä¿¡ AppID æˆ– Secret é…ç½®é”™è¯¯
- ç½‘ç»œé—®é¢˜å¯¼è‡´æ— æ³•è®¿é—®å¾®ä¿¡æœåŠ¡å™¨

### Q4: å¦‚ä½•åœ¨æœ¬åœ°æµ‹è¯•ç™»å½•ï¼Ÿ
**A**: 
1. ç¡®ä¿ `.env` é…ç½®æ­£ç¡®
2. è¿è¡Œ `npm run start:dev`
3. ä½¿ç”¨å°ç¨‹åºå¼€å‘è€…å·¥å…·æˆ–çœŸæœºæµ‹è¯•
4. æŸ¥çœ‹åç«¯æ§åˆ¶å°æ—¥å¿—æ’æŸ¥é—®é¢˜

---

**ä¿®å¤å·²å®Œæˆï¼Œè¯·é‡æ–°éƒ¨ç½²äº‘æ‰˜ç®¡æœåŠ¡åæµ‹è¯•ï¼** ğŸš€

