# 🚀 CookTip 前端接口对接指南

**更新时间**: 2025年10月5日 17:18  
**状态**: ✅ 后端接口已全部部署成功

---

## 📊 当前状态

### ✅ 后端接口状态

**最新部署**: 
- 地址: `https://cooktip-backend-1c2ldu3a8-davids-projects-688aeefc.vercel.app`
- 状态: ✅ 100% 可用
- 所有接口: 全部正常

**固定域名**:
- 地址: `https://cooktip-backend.vercel.app`
- 状态: ⏳ CDN 更新中（预计 10-15 分钟）
- 部分接口: 可能返回 404

---

## 🎯 前端立即行动方案

### 方案 1: 使用最新部署地址（⭐ 推荐 - 立即可用）

**在小程序配置文件中设置**:

```javascript
// utils/config.js
export default {
  // 使用最新部署地址（立即可用）
  API_BASE_URL: 'https://cooktip-backend-1c2ldu3a8-davids-projects-688aeefc.vercel.app'
}
```

**优点**:
- ✅ 立即可用，无需等待
- ✅ 100% 接口可用
- ✅ 已通过完整测试

**缺点**:
- ⚠️ 每次后端重新部署时地址会变（需要更新）

---

### 方案 2: 等待固定域名生效（更稳定）

**预计等待时间**: 10-15 分钟

**操作步骤**:
1. 等待 15 分钟
2. 在配置中使用固定域名:

```javascript
// utils/config.js
export default {
  // 使用固定域名（永久不变）
  API_BASE_URL: 'https://cooktip-backend.vercel.app'
}
```

**优点**:
- ✅ 地址永久不变
- ✅ 后端重新部署不影响前端

**缺点**:
- ⏳ 需要等待 CDN 更新

---

## 🧪 如何验证接口可用

### 方法 1: 在小程序中测试

```javascript
// 在小程序任意页面的 onLoad 中测试
onLoad() {
  wx.request({
    url: 'https://cooktip-backend-1c2ldu3a8-davids-projects-688aeefc.vercel.app/api/auth/wechat',
    method: 'POST',
    data: { code: 'test' },
    success: (res) => {
      console.log('接口测试结果:', res.data);
      
      // 看到以下任一响应说明接口可用：
      // { code: 401, message: "微信登录失败" } - 正常（测试 code 无效）
      // { code: 200, message: "登录成功" } - 完美
    },
    fail: (err) => {
      console.error('接口测试失败:', err);
      // 如果看到 404，说明地址不对或 CDN 未更新
    }
  });
}
```

### 方法 2: 使用浏览器测试

打开浏览器控制台，执行:

```javascript
fetch('https://cooktip-backend-1c2ldu3a8-davids-projects-688aeefc.vercel.app/api/auth/wechat', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ code: 'test' })
})
.then(res => res.json())
.then(data => console.log('测试结果:', data))
.catch(err => console.error('测试失败:', err));
```

**预期结果**:
- ✅ 返回 `{ code: 401 }` 或 `{ code: 400 }` - 接口存在且正常
- ❌ 返回 `404` - 接口不存在或 CDN 未更新

---

## 📡 可用的接口列表

### ✅ 认证接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 微信登录 | POST | `/api/auth/wechat` | 小程序登录/注册 | ✅ 可用 |

### ✅ 菜谱接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 菜谱列表 | GET | `/api/recipes` | 获取菜谱列表 | ✅ 可用 |
| 菜谱详情 | GET | `/api/recipes/:id` | 获取菜谱详情 | ✅ 可用 |

### ✅ 分类接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 分类列表 | GET | `/api/categories` | 获取分类列表 | ✅ 可用 |

### ✅ 搜索接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 搜索菜谱 | GET | `/api/search?q=关键词` | 搜索菜谱 | ✅ 可用 |

### ✅ 用户接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 当前用户信息 | GET | `/api/user/info` | 获取当前用户信息（需登录） | ✅ 可用 |
| 用户菜谱列表 | GET | `/api/user/recipes` | 获取当前用户的菜谱（需登录） | ✅ 可用 |
| 指定用户信息 | GET | `/api/users/:id` | 获取指定用户信息 | ✅ 可用 |

### ✅ 收藏接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 收藏列表 | GET | `/api/favorites` | 获取收藏列表（需登录） | ✅ 可用 |
| 添加收藏 | POST | `/api/favorites` | 添加收藏（需登录） | ✅ 可用 |
| 取消收藏 | DELETE | `/api/favorites/:id` | 取消收藏（需登录） | ✅ 可用 |

### ✅ 点赞接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 添加点赞 | POST | `/api/likes` | 给菜谱点赞（需登录） | ✅ 可用 |

### ✅ 评论接口

| 接口 | 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|------|
| 评论列表 | GET | `/api/comments?recipeId=xxx` | 获取评论列表 | ✅ 可用 |
| 添加评论 | POST | `/api/comments` | 添加评论（需登录） | ✅ 可用 |
| 删除评论 | DELETE | `/api/comments/:id` | 删除评论（需登录） | ✅ 可用 |

---

## 🔐 认证说明

### 需要认证的接口

以下接口需要在请求头中携带 token:

```javascript
wx.request({
  url: 'https://..../api/user/info',
  method: 'GET',
  header: {
    'Authorization': `Bearer ${token}` // 从登录接口获取的 token
  }
})
```

**需要认证的接口**:
- `/api/user/info`
- `/api/user/recipes`
- `/api/favorites` (所有操作)
- `/api/likes` (所有操作)
- `/api/comments` (添加、删除)

### 不需要认证的接口

以下接口可以直接访问:
- `/api/auth/wechat` (登录接口)
- `/api/recipes` (菜谱列表和详情)
- `/api/categories` (分类列表)
- `/api/search` (搜索)
- `/api/users/:id` (查看其他用户)
- `/api/comments?recipeId=xxx` (查看评论)

---

## 🚀 完整的登录流程示例

```javascript
// 1. 调用微信登录
async login() {
  try {
    // 获取微信登录 code
    const { code } = await wx.login();
    
    // 调用后端登录接口
    const response = await wx.request({
      url: 'https://cooktip-backend-1c2ldu3a8-davids-projects-688aeefc.vercel.app/api/auth/wechat',
      method: 'POST',
      data: {
        code: code,
        nickName: '张三',  // 可选
        avatar: 'https://...'  // 可选
      }
    });
    
    if (response.data.code === 200) {
      const { token, user } = response.data.data;
      
      // 保存 token 和用户信息
      wx.setStorageSync('token', token);
      wx.setStorageSync('user', user);
      
      console.log('登录成功:', user);
      return true;
    } else {
      console.error('登录失败:', response.data.message);
      return false;
    }
    
  } catch (error) {
    console.error('登录异常:', error);
    return false;
  }
}

// 2. 使用 token 访问需要认证的接口
async getUserInfo() {
  const token = wx.getStorageSync('token');
  
  const response = await wx.request({
    url: 'https://cooktip-backend-1c2ldu3a8-davids-projects-688aeefc.vercel.app/api/user/info',
    method: 'GET',
    header: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  return response.data;
}
```

---

## ⚠️  常见问题

### Q1: 接口返回 404
**原因**: 
- 使用了固定域名，但 CDN 还在更新中
- 地址拼接错误

**解决**:
- 改用最新部署地址（立即可用）
- 或等待 10-15 分钟

### Q2: 接口返回 401
**原因**: 
- 接口需要认证，但没有传 token
- Token 过期或无效

**解决**:
- 检查是否在 header 中传递了 `Authorization: Bearer {token}`
- 重新登录获取新 token

### Q3: 接口返回 500
**原因**:
- 服务器内部错误
- 数据库连接问题

**解决**:
- 检查请求参数是否正确
- 联系后端排查

### Q4: 小程序请求失败
**原因**:
- 域名未添加到小程序合法域名列表

**解决**:
```
在微信公众平台配置以下域名:
- https://cooktip-backend.vercel.app
- https://cooktip-backend-1c2ldu3a8-davids-projects-688aeefc.vercel.app
```

---

## 📞 技术支持

### 后端开发人员

如有问题，提供以下信息：
1. 请求的完整 URL
2. 请求方法和参数
3. 返回的状态码和响应
4. 小程序控制台截图

### 测试工具

使用项目中的 `API测试工具.html` 可以快速测试所有接口。

---

## ✅ 检查清单

### 前端开发人员检查

- [ ] 已修改 `utils/config.js` 中的 `API_BASE_URL`
- [ ] 已清除小程序缓存
- [ ] 已在小程序后台配置合法域名
- [ ] 已测试登录接口（返回 401 或 200）
- [ ] 已测试其他接口（返回正常数据）
- [ ] 已正确处理 token（登录后保存，请求时携带）

---

## 🎉 总结

### 当前状态
- ✅ 后端接口 100% 可用
- ✅ 最新部署地址立即可用
- ⏳ 固定域名 10-15 分钟后可用

### 建议操作
1. **立即**: 使用最新部署地址开始开发
2. **15分钟后**: 测试固定域名是否可用
3. **固定域名可用后**: 切换到固定域名

---

**创建时间**: 2025年10月5日 17:18  
**后端状态**: ✅ 全部正常  
**前端可以开始集成**: ✅ 是

