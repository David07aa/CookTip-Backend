# 图片视频资源配置总览 📋

> **您的COS对象存储域名**：`https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com`

---

## 🚀 快速开始

根据您的情况选择对应的文档：

### 1️⃣ 我想立即修复图片加载问题
👉 **阅读**：[图片加载问题快速修复指南.md](./图片加载问题快速修复指南.md)

**适用场景**：
- 前端报错：`no such file or directory: E:\...\no-search.png`
- 视频封面无法显示
- 想快速解决问题（15分钟内完成）

---

### 2️⃣ 我想了解完整的技术方案
👉 **阅读**：[对象存储图片修复完整方案.md](./对象存储图片修复完整方案.md)

**包含内容**：
- 详细的问题分析
- 完整的配置步骤
- 多种解决方案对比
- 常见问题解答

---

### 3️⃣ 我想深入排查图片加载问题
👉 **阅读**：
- [图片加载问题深度排查指南.md](./图片加载问题深度排查指南.md)
- [对象存储图片配置排查指南.md](./对象存储图片配置排查指南.md)

**适用场景**：
- 按照快速指南操作后仍有问题
- 需要详细的调试步骤
- 想了解底层原理

---

## 📁 核心文件

### 配置文件（必须使用）
```
miniprogram-utils/
├── cdn.js              # CDN配置文件（复制到前端项目）
├── cloudRequest.js     # 云函数请求工具
└── api.js              # API封装
```

### 使用方法
```javascript
// 1. 复制 cdn.js 到前端项目的 utils/ 目录

// 2. 在页面中引入
import { getCdnUrl, getPlaceholder, processRecipeList } from '@/utils/cdn';

// 3. 使用
const placeholderImage = getPlaceholder('noSearch');
const recipes = processRecipeList(apiResponse.data);
```

---

## ⚡ 3步快速修复

### 步骤1：配置小程序合法域名
在微信小程序后台添加 downloadFile 合法域名：
```
https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com
```

### 步骤2：复制配置文件
将 `miniprogram-utils/cdn.js` 复制到前端项目的 `utils/` 目录

### 步骤3：修改前端代码
```javascript
// ❌ 修改前
const placeholderImage = 'E:\\...\\no-search.png';

// ✅ 修改后
import { getPlaceholder } from '@/utils/cdn';
const placeholderImage = getPlaceholder('noSearch');
```

---

## 📚 完整文档索引

### 问题修复类
| 文档 | 用途 | 阅读时间 |
|------|------|----------|
| [图片加载问题快速修复指南.md](./图片加载问题快速修复指南.md) | 快速解决图片加载问题 | 5分钟 |
| [对象存储图片修复完整方案.md](./对象存储图片修复完整方案.md) | 完整的技术方案和步骤 | 15分钟 |
| [前端资源文件修复指南.md](./前端资源文件修复指南.md) | 资源文件通用修复方案 | 10分钟 |

### 深度排查类
| 文档 | 用途 | 阅读时间 |
|------|------|----------|
| [图片加载问题深度排查指南.md](./图片加载问题深度排查指南.md) | 深度调试和排查 | 20分钟 |
| [对象存储图片配置排查指南.md](./对象存储图片配置排查指南.md) | COS配置相关排查 | 15分钟 |

### API相关
| 文档 | 用途 | 阅读时间 |
|------|------|----------|
| [云函数部署完整指南.md](./云函数部署完整指南.md) | 部署API网关云函数 | 20分钟 |
| [前端紧急修复指南-搜索功能.md](./前端紧急修复指南-搜索功能.md) | 修复搜索API问题 | 10分钟 |
| [前端对接文档-新版.md](./前端对接文档-新版.md) | API接口文档 | 30分钟 |

---

## 🔍 常见问题速查

### Q1: 图片显示本地路径错误
```
❌ 错误：no such file or directory: E:\前端项目文档\...
✅ 解决：使用 getPlaceholder() 或 getCdnUrl()
📄 参考：图片加载问题快速修复指南.md
```

### Q2: 视频封面无法显示
```
❌ 原因：未处理后端返回的图片URL
✅ 解决：使用 processRecipeList(data)
📄 参考：对象存储图片修复完整方案.md
```

### Q3: 配置了域名但仍无法加载
```
❌ 原因：域名配置未生效或图片不存在
✅ 解决：等待5分钟 + 检查图片是否已上传到COS
📄 参考：图片加载问题深度排查指南.md
```

### Q4: API请求失败 404
```
❌ 原因：未使用云函数代理
✅ 解决：使用 api.searchRecipes() 而不是直接请求
📄 参考：前端紧急修复指南-搜索功能.md
```

---

## 📋 必须完成的配置清单

- [ ] **小程序后台**：配置 downloadFile 合法域名
  ```
  https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com
  ```

- [ ] **前端项目**：复制 `cdn.js` 到 `utils/` 目录

- [ ] **前端代码**：替换所有本地绝对路径为 CDN 配置

- [ ] **图片加载**：添加 `binderror` 错误处理

- [ ] **数据处理**：使用 `processRecipeList()` 处理API返回数据

- [ ] **测试验证**：重启开发者工具并测试所有页面

---

## 🛠️ 核心配置信息

### COS对象存储
```javascript
域名：https://yjsp-1367462091.cos.ap-nanjing.myqcloud.com
区域：ap-nanjing（南京）
用途：存储所有图片、视频等静态资源
```

### 云托管服务
```javascript
公网域名：https://yjsp-ytg-191595-4-1367462091.sh.run.tcloudbase.com
内网域名：rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com
用途：后端API服务（仅通过云函数访问）
```

### 云函数（API网关）
```javascript
函数名：api-proxy
用途：转发小程序API请求到云托管后端
调用方式：wx.cloud.callFunction()
```

---

## 🎯 下一步行动

1. ✅ **立即修复**：按照 [图片加载问题快速修复指南.md](./图片加载问题快速修复指南.md) 操作

2. 📤 **上传资源**：将占位图和默认图上传到COS
   - 占位图：`/images/empty/no-search.png` 等
   - 默认图：`/images/default/avatar.png` 等

3. 🧪 **测试验证**：
   - 搜索功能是否正常
   - 食谱列表图片是否显示
   - 视频封面是否加载
   - 用户头像是否显示

4. 📱 **真机测试**：在真机上测试所有功能

---

## 📞 获取帮助

如果遇到问题：

1. 先查看对应的文档
2. 检查是否完成所有配置清单
3. 查看常见问题速查
4. 提供详细的错误信息和日志

---

## 📝 版本历史

- **2024-10-16**：创建图片视频资源配置文档
  - 添加COS配置支持
  - 创建CDN工具函数
  - 提供完整修复方案

---

**祝您修复顺利！** 🎉

