# æ•°æ®åº“è¿ç§»åˆ°äº‘æ‰˜ç®¡ - å¿«é€Ÿå¼€å§‹

## ğŸ“¦ äº‘æ‰˜ç®¡æ•°æ®åº“ä¿¡æ¯

- **å¤–ç½‘åœ°å€**ï¼š`sh-cynosdbmysql-grp-qksrb4s2.sql.tencentcdb.com:23831`
- **å†…ç½‘åœ°å€**ï¼š`10.32.104.73:3306`
- **æ•°æ®åº“å**ï¼š`cooktip`

---

## ğŸš€ å¿«é€Ÿæ‰§è¡Œï¼ˆ3æ­¥å®Œæˆï¼‰

### ç¬¬1æ­¥ï¼šé…ç½®æ•°æ®åº“è´¦å·å¯†ç 

**ç¼–è¾‘ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¡«å†™ç›¸åŒçš„è´¦å·å¯†ç **ï¼š

#### æ–‡ä»¶1ï¼š`init-cloudbase-db.js`ï¼ˆåˆå§‹åŒ–è„šæœ¬ï¼‰

```javascript
const DB_CONFIG = {
  host: 'sh-cynosdbmysql-grp-qksrb4s2.sql.tencentcdb.com',
  port: 23831,
  user: 'æ‚¨çš„è´¦å·',      // âš ï¸ è¿™é‡Œ
  password: 'æ‚¨çš„å¯†ç ',   // âš ï¸ è¿™é‡Œ
  database: 'cooktip',
  charset: 'utf8mb4',
  multipleStatements: true
};
```

#### æ–‡ä»¶2ï¼š`migrate-to-cloudbase.js`ï¼ˆè¿ç§»è„šæœ¬ï¼‰

```javascript
const TARGET_DB = {
  host: 'sh-cynosdbmysql-grp-qksrb4s2.sql.tencentcdb.com',
  port: 23831,
  user: 'æ‚¨çš„è´¦å·',      // âš ï¸ è¿™é‡Œ
  password: 'æ‚¨çš„å¯†ç ',   // âš ï¸ è¿™é‡Œ
  database: 'cooktip',
  charset: 'utf8mb4'
};
```

---

### ç¬¬2æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„

```bash
node init-cloudbase-db.js
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸš€ å¼€å§‹åˆå§‹åŒ–å¾®ä¿¡äº‘æ‰˜ç®¡æ•°æ®åº“...
ğŸ”— è¿æ¥äº‘æ‰˜ç®¡æ•°æ®åº“...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼
ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šè¯»å–åˆå§‹åŒ–SQLè„šæœ¬...
âœ… SQLè„šæœ¬è¯»å–æˆåŠŸ
ğŸ”¨ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„...
âœ… è¡¨ç»“æ„åˆ›å»ºæˆåŠŸï¼
ğŸ” ç¬¬ä¸‰æ­¥ï¼šéªŒè¯è¡¨ç»“æ„...
å·²åˆ›å»ºçš„è¡¨ï¼š
  1. categories
  2. comments
  3. favorites
  4. likes
  5. recipes
  6. shopping_list
  7. users
âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼
```

---

### ç¬¬3æ­¥ï¼šè¿ç§»æ•°æ®

```bash
node migrate-to-cloudbase.js
```

**åŠŸèƒ½**ï¼š
- âœ… ä» SQLPub å¯¼å‡ºæ‰€æœ‰æ•°æ®
- âœ… å¯¼å…¥åˆ°äº‘æ‰˜ç®¡æ•°æ®åº“
- âœ… è‡ªåŠ¨éªŒè¯æ•°æ®å®Œæ•´æ€§
- âœ… è‡ªåŠ¨æ›´æ–°å›¾ç‰‡URLåˆ°å¯¹è±¡å­˜å‚¨

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šå¯¼å‡ºæ•°æ®
ğŸ“¤ å¯¼å‡ºè¡¨: users
   æ‰¾åˆ° 10 æ¡è®°å½•
ğŸ“¤ å¯¼å‡ºè¡¨: categories
   æ‰¾åˆ° 10 æ¡è®°å½•
ğŸ“¤ å¯¼å‡ºè¡¨: recipes
   æ‰¾åˆ° 198 æ¡è®°å½•
...

ğŸ“¥ ç¬¬äºŒæ­¥ï¼šå¯¼å…¥æ•°æ®
ğŸ“¥ å¯¼å…¥è¡¨: users
   âœ… å·²å¯¼å…¥ 10/10
   âœ… users å¯¼å…¥å®Œæˆ
...

ğŸ” ç¬¬ä¸‰æ­¥ï¼šéªŒè¯è¿ç§»ç»“æœ
âœ… users               æº: 10   ç›®æ ‡: 10
âœ… categories          æº: 10   ç›®æ ‡: 10
âœ… recipes             æº: 198  ç›®æ ‡: 198
...

âœ… æ•°æ®åº“è¿ç§»å®Œæˆï¼
```

---

## âœ… å®Œæˆï¼æ¥ä¸‹æ¥åšä»€ä¹ˆï¼Ÿ

### 1. æ›´æ–°åç«¯ç¯å¢ƒé…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®ï¼ˆå¾®ä¿¡äº‘æ‰˜ç®¡ï¼‰
DB_TYPE=mysql

# ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å†…ç½‘åœ°å€ï¼ˆæ¨èï¼‰
DB_HOST=10.32.104.73
DB_PORT=3306

# æœ¬åœ°å¼€å‘ä½¿ç”¨å¤–ç½‘åœ°å€ï¼ˆéœ€é…ç½®IPç™½åå•ï¼‰
# DB_HOST=sh-cynosdbmysql-grp-qksrb4s2.sql.tencentcdb.com
# DB_PORT=23831

DB_USERNAME=æ‚¨çš„æ•°æ®åº“è´¦å·
DB_PASSWORD=æ‚¨çš„æ•°æ®åº“å¯†ç 
DB_DATABASE=cooktip
DB_CHARSET=utf8mb4
DB_SYNCHRONIZE=false
```

### 2. é‡å¯åç«¯æœåŠ¡

**æœ¬åœ°å¼€å‘**ï¼š
```bash
npm run start:dev
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆäº‘æ‰˜ç®¡ï¼‰**ï¼š
```bash
# æäº¤ä»£ç 
git add .
git commit -m "chore: è¿ç§»åˆ°äº‘æ‰˜ç®¡æ•°æ®åº“"
git push origin main

# ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²
```

### 3. æµ‹è¯• API

```bash
# æµ‹è¯•åˆ†ç±»æ¥å£
curl https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/categories

# æµ‹è¯•é£Ÿè°±æ¥å£
curl https://rnvvjhwh.yjsp-ytg.0er4gbxk.1tj8lj27.com/api/v1/recipes?limit=5
```

---

## ğŸ è¿ç§»ä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| ğŸš€ **æ€§èƒ½** | å†…ç½‘è®¿é—®å»¶è¿Ÿ < 1msï¼ˆvs å¤–ç½‘ 50-100msï¼‰|
| âœ… **ç¨³å®š** | é¿å…é”è¶…æ—¶ï¼Œä¸å†æœ‰è¿æ¥é—®é¢˜ |
| ğŸ’° **æˆæœ¬** | èŠ‚çœçº¦ Â¥10/æœˆ |
| ğŸ” **å®‰å…¨** | VPCå†…ç½‘è®¿é—®æ›´å®‰å…¨ |
| ğŸ“Š **ç®¡ç†** | ç»Ÿä¸€åœ¨äº‘æ‰˜ç®¡æ§åˆ¶å°ç®¡ç† |

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: è¿æ¥æ•°æ®åº“å¤±è´¥

**é”™è¯¯**ï¼š`ENOTFOUND` æˆ– `ETIMEDOUT`

**è§£å†³**ï¼š
1. æ£€æŸ¥æ•°æ®åº“åœ°å€æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æœ¬åœ°å¼€å‘éœ€è¦é…ç½®IPç™½åå•

**é…ç½®IPç™½åå•**ï¼š
1. ç™»å½•å¾®ä¿¡äº‘æ‰˜ç®¡æ§åˆ¶å°
2. äº‘æ•°æ®åº“ â†’ å®‰å…¨è®¾ç½® â†’ IPç™½åå•
3. æ·»åŠ æ‚¨çš„å…¬ç½‘IP

### Q2: æƒé™ä¸è¶³

**é”™è¯¯**ï¼š`ER_ACCESS_DENIED_ERROR`

**è§£å†³**ï¼š
1. æ£€æŸ¥è´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿è´¦å·æœ‰åˆ›å»ºè¡¨çš„æƒé™

### Q3: æ•°æ®åº“ä¸å­˜åœ¨

**é”™è¯¯**ï¼š`ER_BAD_DB_ERROR`

**è§£å†³**ï¼š
1. ç™»å½•äº‘æ•°æ®åº“æ§åˆ¶å°
2. åˆ›å»ºæ•°æ®åº“ `cooktip`
3. é‡æ–°è¿è¡Œåˆå§‹åŒ–è„šæœ¬

---

## ğŸ“Š æ•°æ®åº“çŠ¶æ€æ£€æŸ¥

è¿ç§»å®Œæˆåï¼Œå¯ä»¥ç™»å½•äº‘æ•°æ®åº“æ§åˆ¶å°æŸ¥çœ‹ï¼š

1. **è¡¨æ•°é‡**ï¼š7ä¸ªè¡¨
2. **æ•°æ®é‡**ï¼š
   - users: ~10 æ¡
   - categories: 10 æ¡
   - recipes: 198 æ¡
   - comments: ~50 æ¡
   - favorites: ~30 æ¡
   - likes: ~100 æ¡
   - shopping_list: ~20 æ¡

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»šåˆ° SQLPubï¼š

```env
# .env æ–‡ä»¶
DB_HOST=mysql3.sqlpub.com
DB_PORT=3308
DB_USERNAME=david_x
DB_DATABASE=onefoodlibrary
```

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹è¿ç§»å§ï¼** ğŸš€

1. é…ç½®è´¦å·å¯†ç 
2. è¿è¡Œ `node init-cloudbase-db.js`
3. è¿è¡Œ `node migrate-to-cloudbase.js`
4. æ›´æ–° .env é…ç½®
5. é‡å¯æœåŠ¡

**é¢„è®¡æ—¶é—´**ï¼š15-20åˆ†é’Ÿ  
**é£é™©ç­‰çº§**ï¼šä½ï¼ˆæœ‰å›æ»šæ–¹æ¡ˆï¼‰

