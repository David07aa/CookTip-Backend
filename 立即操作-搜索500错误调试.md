# ⚡ 立即操作 - 搜索 500 错误调试

**目标**: 通过详细日志定位搜索功能 500 错误的根本原因

---

## 📋 操作清单（按顺序执行）

### ☑️ 步骤 1: 等待部署（3-5 分钟）

- [x] 代码已推送到 GitHub（Commit: `ed9231e`）
- [ ] 等待云托管自动部署

**如何确认部署完成**:
1. 打开腾讯云控制台: https://console.cloud.tencent.com/
2. 进入: 云产品 → Serverless → 云托管
3. 查看 `CookTip-Backend` 服务状态
4. ✅ 显示"运行中" = 部署完成

⏱️ **预计等待**: 3-5 分钟

---

### ☑️ 步骤 2: 测试搜索功能

1. **打开小程序**
2. **进入搜索页面**
3. **输入关键词**: "鸡"
4. **观察结果**

**两种情况**:

#### A. 成功 ✅
```
显示搜索结果
不再出现 500 错误
```
→ **恭喜！问题已解决！** 🎉

#### B. 失败 ❌
```
云函数响应: {statusCode: 500}
[Search] Perform search failed: Error: Internal server error
```
→ **继续步骤 3**

---

### ☑️ 步骤 3: 查看云托管日志

#### 3.1 打开日志页面

1. **腾讯云控制台**: https://console.cloud.tencent.com/
2. **进入**: 云产品 → Serverless → 云托管
3. **点击**: `CookTip-Backend` 服务
4. **点击**: 顶部"日志"标签页

#### 3.2 筛选错误日志

**设置筛选条件**:
- ⏰ **时间范围**: 最近 1 小时
- 📊 **日志级别**: ERROR
- 🔍 **关键词**: `SearchService` 或 `error`

#### 3.3 查找关键信息

**需要找的日志**:

```
[AllExceptionsFilter] [GET] /api/v1/search/recipes - Status: 500
TypeError: ...（这里是具体的错误）
Stack trace:
  at SearchService.searchRecipes (/app/dist/modules/search/search.service.js:XX:YY)
  at SearchController.searchRecipes (/app/dist/modules/search/search.controller.js:XX:YY)
  ...（完整的调用堆栈）
```

#### 3.4 截图

**需要截图的内容**:
1. ✅ 完整的错误消息
2. ✅ Stack trace（堆栈跟踪）
3. ✅ 请求参数（如果有显示）

---

### ☑️ 步骤 4: 反馈错误信息

如果步骤 3 找到了错误日志，请提供：

1. **📸 云托管日志截图**
   - 包含完整的错误堆栈

2. **🖥️ 浏览器控制台截图**
   - 云函数响应的详细信息

3. **📝 测试信息**:
   - 搜索关键词: ________
   - 测试时间: ________
   - 部署状态: 运行中 / 部署中 / 失败

---

## 🎯 快速诊断

### 常见错误及解决方案

#### 错误 1: `QueryFailedError: ER_BAD_FIELD_ERROR`

```
QueryFailedError: ER_BAD_FIELD_ERROR: Unknown column 'recipe.tags' in 'field list'
```

**原因**: 数据库表缺少某个字段  
**解决**: 需要同步数据库表结构

---

#### 错误 2: `TypeError: Cannot read property 'xxx' of undefined`

```
TypeError: Cannot read property 'nickname' of null
  at SearchService.searchRecipes
```

**原因**: 空值引用  
**解决**: 需要添加更多空值检查

---

#### 错误 3: `Error: connect ETIMEDOUT`

```
Error: connect ETIMEDOUT
  at TCPConnectWrap.afterConnect
```

**原因**: 数据库连接超时  
**解决**: 检查数据库网络配置

---

## 🆘 需要帮助？

如果：
- ❓ 找不到日志
- ❓ 看不懂错误信息
- ❓ 不知道如何截图

**请直接告诉我遇到的问题，我会一步步指导你！**

---

## 📞 反馈模板

```
测试结果: 成功 / 失败

[如果失败，请填写以下信息]

1. 云托管日志截图: [粘贴或上传]

2. 错误信息:
   ```
   [粘贴错误日志]
   ```

3. 搜索关键词: ________

4. 测试时间: ________

5. 部署状态: 运行中 / 部署中 / 失败
```

---

## ⏰ 时间线

| 时间 | 操作 | 预计用时 |
|------|------|----------|
| 现在 | 等待部署 | 3-5 分钟 |
| +5 分钟 | 测试搜索 | 1 分钟 |
| +6 分钟 | 查看日志 | 2-3 分钟 |
| +9 分钟 | 截图反馈 | 1 分钟 |

**总计**: 约 10 分钟

---

**开始吧！请按照上述步骤操作！** 🚀

**有任何问题随时告诉我！** 💬

